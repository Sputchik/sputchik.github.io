<!DOCTYPE html><html lang="en"><meta charset="UTF-8"><script>if (!new URLSearchParams(window.location.search).get('id')) window.location.replace('https://archive.org/details/@sputchik?sort=-date');</script><meta name="viewport" content="width=device-width,initial-scale=1"><title>Stream Replayer</title><style>:root{--theme-color:#FFFFFF;--theme-opposite-color:#000000;--theme-color-1:#F3F3F3;--theme-color-2:#EFEFEF;--theme-color-3:#E3E3E3;--tint-blue-1:#efeff1;--tint-blue-2:#e6e6ec;--bg-color:#f8f8f8;--hover-color:#ccc;--scrollbar-bg:#f0f0f0;--scrollbar-thumb:#c1c1c1;--scrollbar-thumb-hover:#a1a1a1;--text-color:#333;--panel-bg:#fff;--panel-border:#ddd;--popout-header-bg:#e1e1e1;--timestamp-color:#999;--reply-color:#777;--game-name-color:#555;--resize-handle:#ddd;--resize-handle-hover:#6441a5;--chat-border:#eee;--chat-header-bg:#f4f4f4;--viewer-icon-color:#971311;--accent-color:#6a44a9;--link-color:#7f52c9;--sub-color:#b95cde;--cheer-gradient-left:#0000001d;--cheer-gradient-right:#00000030;--cheer-clicked-bg:#0000007f;--shadow-size-1:0 1px 2px rgba(0, 0, 0, 0.16),0 0px 2px rgba(0, 0, 0, 0.05);--shadow-size-2:0 4px 8px rgba(0, 0, 0, 0.16),0 0px 4px rgba(0, 0, 0, 0.05);--btn-hover-bg:#00000020;--choice-sweep-bg:#00000020;--sub-bg:#fbfbfb;--prediction-blue:#387AFF;--prediction-blue2:#1f69ff;--prediction-pink:#f5009b;--prediction-pink2:#e0008e}[data-theme=dark]{--theme-color:#000000;--theme-opposite-color:#FFFFFF;--theme-color-1:#030303;--theme-color-2:#1F1F1F;--theme-color-3:#131313;--tint-blue-1:#26262D;--tint-blue-2:#3B3C43;--bg-color:#000000;--hover-color:#333;--scrollbar-bg:#000000;--scrollbar-thumb:#222222;--scrollbar-thumb-hover:#6441a5;--text-color:#e5e5e5;--panel-bg:#0f0f0f;--panel-border:#3f3f3f;--popout-header-bg:#222;--chat-border:#1f1f1f;--timestamp-color:#888;--reply-color:#aaa;--game-name-color:#aaa;--resize-handle:#333333;--chat-header-bg:#000000;--viewer-icon-color:#ff6b68;--cheer-gradient-left:#00000039;--cheer-gradient-right:#00000050;--cheer-clicked-bg:#0000009c;--btn-hover-bg:#FFFFFF30;--choice-sweep-bg:#FFFFFF20;--sub-bg:#191919}*{scrollbar-width:thin;scrollbar-color:var(--scrollbar-thumb) var(--scrollbar-bg);box-sizing:border-box}div,span{position:relative}video{touch-action:manipulation}a{color:var(--link-color);text-decoration:none}a:hover{text-decoration:underline}body{overflow-y:hidden;margin:0;padding:0;background:var(--bg-color);color:var(--text-color);font-family:Arial,sans-serif;font-size:15px}.container{display:flex;flex-direction:row;height:100dvh}.left-panel{display:flex;flex:1;flex-direction:column;overflow-y:auto;min-width:min-content;height:100%;padding:0 15px}.video-container{position:relative;width:100%;padding-top:56.25%;background:#000}#video-player{position:absolute;top:0;left:0;width:100%;height:100%}.stream-info{padding:8px;padding-top:8px;margin-top:12px;margin-bottom:16px;background:var(--panel-bg);border-radius:4px;box-shadow:var(--shadow-size-1)}.stream-info-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2px}.stream-info-left-container{display:flex;flex-direction:column;gap:7px}.stream-game{display:flex;align-items:center;gap:5px}.stream-title{margin:0;font-size:1rem;cursor:pointer}.game-name{color:var(--game-name-color);cursor:pointer;font-size:.8rem;margin-top:1px}.viewers-count{display:flex;align-items:center;margin-right:55px;font-weight:700}.chat-panel{display:flex;position:relative;flex-direction:column;resize:horizontal;min-width:min-content;width:444px;background:var(--panel-bg);padding-bottom:env(safe-area-inset-bottom)}.chat-header{display:flex;justify-content:space-between;align-items:center;padding:5px 9px;font-weight:700;background:var(--chat-header-bg)}.chat-header-btn{padding:4px;cursor:pointer;color:var(--text-color);background:0 0;border:none;border-radius:4px}.chat-messages{flex:1;overflow-y:scroll;padding:8px 0}.chat-messages-container{display:flex;flex-direction:column;position:relative;overflow:hidden;height:100%;padding-left:1px}.chat-username{font-weight:700;word-break:break-all}.chat-text{word-break:break-word;line-height:1.4rem}.chat-message{padding:4px 12px}.timestamp{margin-right:5px;font-size:.75rem;color:var(--timestamp-color)}.chat-msg-bordered{margin:6px 0}.monet{padding:2px 5px 5px 10px;margin:6px 0;background-color:var(--sub-bg);border-left:4px solid var(--sub-color);line-height:1.2rem}.inraid{margin:6px 0;background-color:#ffad000f;border-left:4px solid #ff9e27}.mod{margin:6px 0;background-color:#ff00000a;border-left:4px solid red;font-style:italic}.misc{margin:6px 0;padding:5px 4px 6px 11px;border-left:4px solid #999}@media (orientation:portrait){.container{display:grid;position:relative;grid-template-areas:"video" "info" "chat";grid-template-rows:auto auto 1fr;height:100dvh}.left-panel{display:contents;padding:10px}.video-container{grid-area:video}.stream-info{grid-area:info;margin-bottom:0;margin-top:8px}.stream-info-left-container{gap:3px}.stream-game{gap:4px}#chat-panel{grid-area:chat;position:relative;padding-bottom:env(safe-area-inset-bottom);overflow-y:auto;width:100%!important;border-left:none}.description{position:absolute;top:100dvh;left:0;right:0}#resize-handle{display:none}.viewers-count{margin-right:5px}.settings-panel{min-width:66vw;width:66vw}}.modal{display:flex;position:fixed;justify-content:center;align-items:center;z-index:100;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5)}.settings-panel{padding:20px;overflow-y:auto;z-index:3;min-width:300px;max-width:80vw;width:40vw;max-height:80vh;height:75%;background:var(--panel-bg);border:1px solid var(--panel-border);border-radius:4px;color:var(--text-color);box-shadow:0 1px 3px rgba(0,0,0,.1)}.progress-bar{display:none;text-align:center;padding:2px;margin-top:5px;width:100%;font-size:12px;background:var(--panel-border);border-radius:4px;color:var(--bg-color)}.popout{display:flex;flex-direction:column;position:absolute;resize:both;overflow:auto;z-index:3;top:100px;left:100px;width:300px;height:350px;min-width:10vw;min-height:10vw;max-width:92vw;max-height:92vh;background-color:var(--bg-color);border:1px solid var(--panel-border);border-radius:3px}.popout-header{display:flex;justify-content:space-between;position:sticky;top:0;z-index:1;align-items:center;padding:5px 7px;cursor:move;background-color:var(--popout-header-bg);color:var(--text-color);border-bottom:1px solid var(--panel-border)}.popout-close-btn{background:0 0;border:none;color:var(--text-color);padding:2px 6px!important;font-weight:700}.scroll-bottom-btn{display:none;position:absolute;left:50%;bottom:20px;transform:translateX(-50%);z-index:1;padding:6px 14px;min-height:34px;width:max(44%,180px);border:1px solid var(--panel-border);border-radius:8px;background:linear-gradient(var(--panel-bg),var(--panel-bg)) padding-box,linear-gradient(135deg,var(--accent-color),transparent 70%) border-box;color:var(--text-color);text-transform:uppercase;cursor:pointer;box-shadow:var(--shadow-size-1);transition:opacity .18s ease,background-color .2s,box-shadow .2s,transform .25s cubic-bezier(.33,.9,.25,1.2);user-select:none}.scroll-bottom-btn.show{display:block;opacity:1}.scroll-bottom-btn:hover{box-shadow:var(--shadow-size-2);transform:translateX(-50%) translateY(-2px)}.scroll-bottom-btn:active{transform:translateX(-50%) translateY(0);box-shadow:var(--shadow-size-1)}.scroll-bottom-btn:focus-visible{outline:2px solid var(--accent-color);outline-offset:2px}@media (any-hover:none){.scroll-bottom-btn:hover{transform:translateX(-50%);box-shadow:var(--shadow-size-1)}}.event-container{display:flex;flex-direction:column;position:absolute;pointer-events:none;gap:6px;top:0;left:0;right:0;padding:8px 20px 0 10px;z-index:1;max-height:100%}.pin-placeholder{pointer-events:all;display:flex;flex-direction:column;padding:4px 10px 12px 12px;gap:5px;border-radius:3px;background:var(--panel-bg);border:1px solid var(--panel-border);box-shadow:var(--shadow-size-2)}.pin-top-container{display:flex;justify-content:space-between;gap:6px;word-break:break-word}.pinned-bits-container{display:flex;flex-direction:column;gap:8px}.pinned-bits-placeholder{pointer-events:all;display:flex;overflow-x:auto;overflow-y:hidden;max-width:100%;gap:6px;white-space:nowrap;scrollbar-width:none;touch-action:pan-x;-ms-overflow-style:none}.pinned-bits-placeholder::-webkit-scrollbar{display:none;width:0;height:0}.pinned-cheer{pointer-events:all;display:inline-flex;align-items:center;justify-content:center;height:41px;padding:2px;box-sizing:border-box;min-width:90px;width:max-content;border-radius:5px;flex-shrink:0;position:relative;overflow:hidden;cursor:pointer;background-size:200%!important;background-position:100%!important}.pinned-cheer-inner{display:inline-flex;align-items:center;justify-content:center;position:relative;height:92%;width:96%;padding:0 8px;box-sizing:border-box;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;border-radius:3px;background:linear-gradient(to right,var(--cheer-gradient-left),var(--cheer-gradient-right));z-index:0;transition:background 75ms linear}.pinned-cheer-inner-placeholder{display:flex;position:relative;align-items:center;padding:0 4px;z-index:1;white-space:nowrap;gap:1px;color:#fff;font-weight:700}.pinned-bits-details{pointer-events:all;display:flex;flex-direction:column;border-radius:6px;box-shadow:var(--shadow-size-2);background-size:200%!important;animation:backgroundPosition 30s linear infinite!important}.event-window-container{pointer-events:all;display:flex;flex-direction:column;border-radius:5px;gap:10px;padding:8px 8px 10px 8px;box-shadow:var(--shadow-size-2);background:var(--panel-bg);border:1px solid var(--panel-border)}.poll-header-container{display:flex;align-items:center;justify-content:space-between;cursor:pointer}.poll-choice-container{display:flex;flex-direction:column;gap:8px}.poll-choice{display:flex;justify-content:space-between;align-items:center;border-radius:4px;background:var(--chat-border);padding:4px 6px 4px 10px;position:relative;overflow:hidden}.marquee-container{pointer-events:all;min-width:0;overflow:hidden;white-space:nowrap;color:#fff;border-radius:6px;background:var(--accent-color);padding:15px;cursor:pointer}.marquee-content{display:flex;align-items:center;top:50%;gap:10px;font-size:1.5rem;font-weight:700;transform:translateX(-100%)}.animated-border-container{position:relative;overflow:hidden}.animated-border{position:absolute;bottom:0;right:0;width:100%;height:5px;overflow:hidden;background:var(--accent-color)}.prediction-details-container{display:flex;position:absolute;flex-direction:column;width:calc(100% - 25px);z-index:2;left:0;right:0;bottom:5%;margin-left:auto;margin-right:auto;border:1px solid var(--panel-border);height:auto;padding:10px;border-radius:4px;background:var(--panel-bg);box-shadow:var(--shadow-size-1);gap:10px}.prediction-details-title{display:flex;flex-direction:column;align-items:center;font-weight:700;padding:6px 8px 4px 8px;border-radius:4px;background:var(--theme-color-2);color:var(--text-color);font-size:1.1rem;margin-bottom:6px;gap:4px}@keyframes marqueeFromRight{0%{transform:translateX(130%)}100%{transform:translateX(-130%)}}@keyframes translateLeftToRight{0%{transform:translateX(-100%)}100%{transform:translateX(0)}}@keyframes translateRightToLeft{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}@keyframes widthLeftToRight{0%{width:0}100%{width:100%}}@keyframes widthRightToLeft{0%{width:100%}100%{width:0}}@keyframes backgroundPosition{0%{background-position:0 0}100%{background-position:200% 0}}.sweep{position:absolute;top:0;left:0;height:100%;width:100%;background:var(--cheer-gradient-right);z-index:0}.pinned-cheer-colors-level-one{background:linear-gradient(90deg,#8205b4,#9146ff,#8205b4)}.pinned-cheer-colors-level-two{background:linear-gradient(90deg,#1e69ff,#578fff,#1e69ff)}.pinned-cheer-colors-level-three{background:linear-gradient(90deg,#009919,#00bba4,#009919)}.pinned-cheer-colors-level-four{background:linear-gradient(90deg,#ff6905,#fdb210,#ffff75,#fdb210,#ff6905)}.pinned-cheer-colors-level-five{background:linear-gradient(90deg,#f7262c,#fa1ed2,#f093f9,#fa1ed2,#f7262c)}.pinned-cheer-colors-level-six{background:linear-gradient(90deg,#00c8af,#1e69ff,#9146ff,#fa1ed2,#9146ff,#1e69ff,#00c8af)}.pinned-cheer-colors-level-seven{background:linear-gradient(90deg,#1e69ff,#9146ff,#fa1ed2,#ea7078,#fdb210,#fafa19,#fdb210,#ea7078,#fa1ed2,#9146ff,#1e69ff)}.pinned-cheer-colors-level-eight{background:linear-gradient(90deg,#fa1ed2,#9146ff,#00fafa,#beff00,#ffb800,#beff00,#00fafa,#9146ff,#fa1ed2)}.announcement-line{border-image-slice:1;border-inline-end:8px solid #9146ff;border-inline-start:8px solid #9146ff}.announcement-line--primary,.announcement-line--purple{border-image-source:linear-gradient(#9146ff,#ff75e6)}.announcement-line--blue{border-image-source:linear-gradient(#00d6d6,#9146ff)}.announcement-line--green{border-image-source:linear-gradient(#00db84,#57bee6)}.announcement-line--orange{border-image-source:linear-gradient(#ffb31a,#e0e000)}.btn,.btn-2x{cursor:pointer;display:inline-flex;align-items:center;justify-content:center;border-radius:4px;padding:5px;box-sizing:content-box;transition:background .12s,transform .12s;user-select:none;-webkit-user-select:none;-webkit-touch-callout:none;-webkit-tap-highlight-color:transparent;touch-action:manipulation}@media (any-hover:none){.btn.active,.btn:active{background:var(--btn-hover-bg);transform:scale(1.2)}.btn-2x.active,.btn-2x:active{background:var(--btn-hover-bg);transform:scale(1.15)}}@media (hover:hover) and (pointer:fine){.btn:hover{background:var(--btn-hover-bg);transform:scale(1.15)}.btn:active{background:var(--btn-hover-bg);transform:scale(.95)}.btn-2x:hover{background:var(--btn-hover-bg);transform:scale(1.075)}.btn-2x:active{background:var(--btn-hover-bg);transform:scale(.95)}.resize-handle:hover{transition:background-color .2s;background-color:var(--resize-handle-hover)}.pinned-cheer:hover .pinned-cheer-inner{background-color:#00000050}}.resize-handle{width:6px;background-color:var(--resize-handle);cursor:col-resize}.resize-handle.active,.resize-handle:active{transition:background-color .2s;background-color:var(--resize-handle-hover)}</style><div class="container"><div class="left-panel"><div class="video-container"><video id="video-player" webkit-playsinline="true" playsinline="true" controls preload="metadata">Your browser does not support the video tag.</video></div><div class="stream-info"><div class="stream-info-header"><div class="stream-info-left-container"><h1 class="stream-title" id="stream-title">Loading...</h1><div class="stream-game" id="stream-game"><svg color="var(--game-name-color)" width="20" height="20" viewBox="0 0 20 20" style="min-height:20px;min-width:20px"><path d="M13 4a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v2l3 3 3-3V4zM4 7a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2l3-3-3-3H4zm14 4a2 2 0 0 1-2 2h-2l-3-3 3-3h2a2 2 0 0 1 2 2v2zM7 16a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2l-3-3-3 3v2z" fill="currentColor"></path></svg><span class="game-name" id="game-name">Loading...</span></div></div><div style="display:flex;align-items:center"><span class="viewers-count" style="gap:3px;display:flex;align-items:center;color:var(--viewer-icon-color)"><svg width="20" height="20" viewBox="0 0 20 20" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M5 7a5 5 0 1 1 6.192 4.857A2 2 0 0 0 13 13h1a3 3 0 0 1 3 3v2h-2v-2a1 1 0 0 0-1-1h-1a3.99 3.99 0 0 1-3-1.354A3.99 3.99 0 0 1 7 15H6a1 1 0 0 0-1 1v2H3v-2a3 3 0 0 1 3-3h1a2 2 0 0 0 1.808-1.143A5.002 5.002 0 0 1 5 7zm5 3a3 3 0 1 1 0-6 3 3 0 0 1 0 6z" clip-rule="evenodd"></path></svg><span id="viewer-count">0</span></span><button class="theme-toggle" id="theme-toggle-btn" style="margin-left:8px;background:var(--panel-bg);color:var(--text-color);border:1px solid var(--panel-border);border-radius:4px;padding:8px 15px;cursor:pointer"><svg id="theme-icon" width="16" height="16" viewBox="0 0 24 24" style="vertical-align:text-bottom"><path id="moon-icon" fill="currentColor" d="M21.53 15.93c-.16-.27-.61-.69-1.73-.49a8.46 8.46 0 01-1.88.13 8.409 8.409 0 01-5.91-2.82 8.068 8.068 0 01-1.44-8.66c.44-1.01.13-1.54-.09-1.76s-.77-.55-1.83-.11a10.318 10.318 0 00-6.32 10.21 10.475 10.475 0 007.04 8.99 10 10 0 002.89.55c.16.01.32.02.48.02a10.5 10.5 0 008.47-4.27c.67-.93.49-1.519.32-1.79z" style="display:none"/><path id="sun-icon" fill="currentColor" d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 000-1.41l-1.06-1.06zm1.06-10.96a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/></svg></button></div></div></div><div class="description" id="description-container" style="display:none"><details><summary></summary><div id="description-content">Loading...</div></details></div></div><div class="resize-handle" id="resize-handle"></div><div class="chat-panel" id="chat-panel"><div class="chat-header"><span>Chat Replay</span><div style="display:flex;gap:5px" id="chat-header-buttons"><button class="chat-header-btn btn" title="Found Issue? Report here" id="report-btn"><svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M17.416 2.62412C17.7607 2.39435 17.8538 1.9287 17.624 1.58405C17.3943 1.23941 16.9286 1.14628 16.584 1.37604L13.6687 3.31955C13.1527 3.11343 12.5897 3.00006 12.0001 3.00006C11.4105 3.00006 10.8474 3.11345 10.3314 3.31962L7.41603 1.37604C7.07138 1.14628 6.60573 1.23941 6.37596 1.58405C6.1462 1.9287 6.23933 2.39435 6.58397 2.62412L8.9437 4.19727C8.24831 4.84109 7.75664 5.70181 7.57617 6.6719C8.01128 6.55973 8.46749 6.50006 8.93763 6.50006H15.0626C15.5328 6.50006 15.989 6.55973 16.4241 6.6719C16.2436 5.70176 15.7519 4.841 15.0564 4.19717L17.416 2.62412Z"/><path fill="currentColor" d="M1.25 14.0001C1.25 13.5859 1.58579 13.2501 2 13.2501H5V11.9376C5 11.1019 5.26034 10.327 5.70435 9.68959L3.22141 8.69624C2.83684 8.54238 2.6498 8.10589 2.80366 7.72131C2.95752 7.33673 3.39401 7.1497 3.77859 7.30356L6.91514 8.55841C7.50624 8.20388 8.19807 8.00006 8.9375 8.00006H15.0625C15.8019 8.00006 16.4938 8.20388 17.0849 8.55841L20.2214 7.30356C20.606 7.1497 21.0425 7.33673 21.1963 7.72131C21.3502 8.10589 21.1632 8.54238 20.7786 8.69624L18.2957 9.68959C18.7397 10.327 19 11.1019 19 11.9376V13.2501H22C22.4142 13.2501 22.75 13.5859 22.75 14.0001C22.75 14.4143 22.4142 14.7501 22 14.7501H19V15.0001C19 16.1808 18.7077 17.2932 18.1915 18.2689L20.7786 19.3039C21.1632 19.4578 21.3502 19.8943 21.1963 20.2789C21.0425 20.6634 20.606 20.8505 20.2214 20.6966L17.3288 19.5394C16.1974 20.8664 14.5789 21.7655 12.75 21.9604V15.0001C12.75 14.5858 12.4142 14.2501 12 14.2501C11.5858 14.2501 11.25 14.5858 11.25 15.0001V21.9604C9.42109 21.7655 7.80265 20.8664 6.67115 19.5394L3.77859 20.6966C3.39401 20.8505 2.95752 20.6634 2.80366 20.2789C2.6498 19.8943 2.83684 19.4578 3.22141 19.3039L5.80852 18.2689C5.29231 17.2932 5 16.1808 5 15.0001V14.7501H2C1.58579 14.7501 1.25 14.4143 1.25 14.0001Z"/></svg></button><button class="chat-header-btn btn" title="Open user ChatLog by username" id="chatlog-btn"><svg width="20" height="20" viewBox="0 0 24 24"><path fill="none" d="M18.5 19.5L20 21M11 14C7.13401 14 4 17.134 4 21H11M19 17.5C19 18.8807 17.8807 20 16.5 20C15.1193 20 14 18.8807 14 17.5C14 16.1193 15.1193 15 16.5 15C17.8807 15 19 16.1193 19 17.5ZM15 7C15 9.20914 13.2091 11 11 11C8.79086 11 7 9.20914 7 7C7 4.79086 8.79086 3 11 3C13.2091 3 15 4.79086 15 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button><button class="chat-header-btn btn" title="Open Settings" id="settings-btn"><svg width="20" height="20" viewBox="0 0 20 20" style="color:var(--text-color)"><path fill="currentColor" d="M10 8a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"></path><path fill="currentColor" fill-rule="evenodd" d="M9 2h2a2.01 2.01 0 0 0 1.235 1.855l.53.22a2.01 2.01 0 0 0 2.185-.439l1.414 1.414a2.01 2.01 0 0 0-.439 2.185l.22.53A2.01 2.01 0 0 0 18 9v2a2.01 2.01 0 0 0-1.855 1.235l-.22.53a2.01 2.01 0 0 0 .44 2.185l-1.415 1.414a2.01 2.01 0 0 0-2.184-.439l-.531.22A2.01 2.01 0 0 0 11 18H9a2.01 2.01 0 0 0-1.235-1.854l-.53-.22a2.009 2.009 0 0 0-2.185.438L3.636 14.95a2.009 2.009 0 0 0 .438-2.184l-.22-.531A2.01 2.01 0 0 0 2 11V9c.809 0 1.545-.487 1.854-1.235l.22-.53a2.009 2.009 0 0 0-.438-2.185L5.05 3.636a2.01 2.01 0 0 0 2.185.438l.53-.22A2.01 2.01 0 0 0 9 2zm-4 8 1.464 3.536L10 15l3.535-1.464L15 10l-1.465-3.536L10 5 6.464 6.464 5 10z" clip-rule="evenodd"></path></svg></button></div></div><div class="chat-messages-container" id="chat-messages-container"><div class="event-container" id="event-container"><div class="pinned-bits-container" id="pinned-bits-container"><div class="pinned-bits-placeholder" id="pinned-bits-placeholder"></div></div><div class="pin-container" id="pin-container"></div></div><div class="chat-messages" id="chat-messages"></div></div></div></div><script>var e=new URLSearchParams(window.location.search);let i=e.get("id");e="true"==e.get("local");i||window.location.replace("https://archive.org/details/@sputchik?sort=-date");let[r,,y]=i.split("-");var t=`https://archive.org/download/${i}/`;let s,d,c,w,P=(w=e?(e=window.location.origin+("/"+y),s=e+`/${y}.json`,d=e+`/${y}-metadata.json`,c=e+`/${y}.mp4`,e+`/${y}.tar.gz`):(s=t+y+".json",d=t+y+"-metadata.json",c=t+y+".mp4",null),document.getElementById("video-player")),C=document.getElementById("chat-panel"),$=document.getElementById("chat-header-buttons"),be=document.getElementById("chat-messages"),A=document.getElementById("chat-messages-container"),L=document.getElementById("viewer-count"),I=document.getElementById("pinned-bits-container"),T=document.getElementById("pinned-bits-placeholder"),V=document.getElementById("pin-container"),D=document.getElementById("event-container"),F=document.getElementById("stream-title");document.getElementById("stream-game");let B=document.getElementById("game-name"),H=(T.addEventListener("wheel",e=>{e.preventDefault(),T.scrollLeft+=.3*e.deltaY}),"ontouchstart"in window||0<navigator.maxTouchPoints),O=(P.src=c,e=window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("theme"),Ct(e||!t?e?"dark":"light":t),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{Ct(e.matches?"dark":"light")}),null),a={t:null,viewers:null,o:null},M=null,xe=0,R=null,z=1;let h=[],u=0,N=!1,l=0,j=null,_=new Set,U=new Map,G=new Map,q=null,J=null,p=300,Z=e=>{p=e,K=p/2},K=p/2,m=250,Q=5,v=4,W=`image${v}x`,we=!1,Se=!0,ye=!0,Te=!0,X=!0,f=!1,Me=!0,ke=!0,Ce=!0,g=3,b=4,x=new Map,Y=new Map,ee=new Map,te=new Map,ne=new Set,oe=new Set;new Set(["msg","monet","inraid","mod","misc"]);let ie=new Map;let ae=["#FF0000","#0000FF","#008000","#B22222","#FF7F50","#9ACD32","#FF4500","#2E8B57","#DAA520","#D2691E","#5F9EA0","#1E90FF","#FF69B4","#8A2BE2","#00FF7F"],re=/(https?:\/\/[^\s]+|www\.[^\s]+)(?![^<]*>)/gi,Pe={i:'<path fill="currentColor" fill-rule="evenodd" d="M16 6h2v6h-1v6H3v-6H2V6h2V4.793c0-2.507 3.03-3.762 4.803-1.99.131.131.249.275.352.429L10 4.5l.845-1.268a2.81 2.81 0 0 1 .352-.429C12.969 1.031 16 2.286 16 4.793V6zM6 4.793V6h2.596L7.49 4.341A.814.814 0 0 0 6 4.793zm8 0V6h-2.596l1.106-1.659a.814.814 0 0 1 1.49.451zM16 8v2h-5V8h5zm-1 8v-4h-4v4h4zM9 8v2H4V8h5zm0 4H5v4h4v-4z" clip-rule="evenodd"></path>',reply:'<path fill="currentColor" d="M11 8h2v2h-2V8zM9 8H7v2h2V8z"></path><path fill="currentColor" fill-rule="evenodd" d="m10 18-3-3H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2l-3 3zm-2.172-5L10 15.172 12.172 13H15V5H5v8h2.828z" clip-rule="evenodd"></path>',sub:'<path fill="currentColor" d="M8.944 2.654c.406-.872 1.706-.872 2.112 0l1.754 3.77 4.2.583c.932.13 1.318 1.209.664 1.853l-3.128 3.083.755 4.272c.163.92-.876 1.603-1.722 1.132L10 15.354l-3.579 1.993c-.846.47-1.885-.212-1.722-1.132l.755-4.272L2.326 8.86c-.654-.644-.268-1.723.664-1.853l4.2-.583 1.754-3.77z"></path>',l:'<path fill="currentColor" d="M18 5v8a2 2 0 0 1-2 2H4a2.002 2.002 0 0 1-2-2V5l4 3 4-4 4 4 4-3z" fill-rule="evenodd"></path>',h:'<path d="m11 14 7 4V2l-7 4H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h2v4h2v-4h3zm1-6.268 4-2.286v9.108l-4-2.286V7.732zM10 12H4V8h6v4z" fill-rule="evenodd" clip-rule="evenodd" fill="currentColor"></path>',bits:'<path fill="currentColor" fill-rule="evenodd" d="m3 12 7-10 7 10-7 6-7-6zm2.678-.338L10 5.487l4.322 6.173-.85.728L10 11l-3.473 1.39-.849-.729z" clip-rule="evenodd"></path>',u:'<path fill="currentColor" fill-rule="evenodd" d="M4.941 2h10v2H13v3a3 3 0 0 1 3 3v3H4v-3a3 3 0 0 1 3-3V4H4.941V2zM9 9H7a1 1 0 0 0-1 1v1h8v-1a1 1 0 0 0-1-1h-2V4H9v5z" clip-rule="evenodd"></path><path fill="currentColor" d="M10.999 15h-2v3h2v-3z"></path>',hide:'<path fill="currentColor" d="m16.5 18 1.5-1.5-2.876-2.876a9.99 9.99 0 0 0 1.051-1.191L18 10l-1.825-2.433a9.992 9.992 0 0 0-2.855-2.575 35.993 35.993 0 0 1-.232-.14 6 6 0 0 0-6.175 0 35.993 35.993 0 0 1-.35.211L3.5 2 2 3.5 16.5 18zm-2.79-5.79a8 8 0 0 0 .865-.977L15.5 10l-.924-1.233a7.996 7.996 0 0 0-2.281-2.058 37.22 37.22 0 0 1-.24-.144 4 4 0 0 0-4.034-.044l1.53 1.53a2 2 0 0 1 2.397 2.397l1.762 1.762z" fill-rule="evenodd"></path><path fill="currentColor" d="m11.35 15.85-1.883-1.883a3.996 3.996 0 0 1-1.522-.532 38.552 38.552 0 0 0-.239-.144 7.994 7.994 0 0 1-2.28-2.058L4.5 10l.428-.571L3.5 8 2 10l1.825 2.433a9.992 9.992 0 0 0 2.855 2.575c.077.045.155.092.233.14a6 6 0 0 0 4.437.702z"></path>',expand:'<path fill="currentColor" d="M14.5 6.5 10 11 5.5 6.5 4 8l6 6 6-6-1.5-1.5z"></path>',collapse:'<path fill="currentColor" d="M5.5 13.5 10 9l4.5 4.5L16 12l-6-6-6 6 1.5 1.5z"></path>',p:'<path fill="currentColor" d="M3 9c0-.621.08-1.223.233-1.796l1.122.441.654 1.663a5 5 0 1 0 5.3-5.299l-1.664-.654-.441-1.122a7 7 0 0 1 5.014 12.985L14 16a2 2 0 0 1 2 2H4a2 2 0 0 1 2-2l.782-.782A7 7 0 0 1 3 9z"></path><path fill="currentColor" d="M7.489 4.511 10 5.5l-2.511.989L6.5 9l-.989-2.511L3 5.5l2.511-.989L6.5 2l.989 2.511zM12 9l-1.435-.565L10 7l-.565 1.435L8 9l1.435.565L10 11l.565-1.435L12 9z"></path>',m:'<path fill="currentColor" d="M10 6a4 4 0 0 1 4 4h-2a2 2 0 0 0-2-2V6z"></path><path fill="currentColor" fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0zm-2 0a6 6 0 1 1-12 0 6 6 0 0 1 12 0z" clip-rule="evenodd"></path>',poll:'<path d="M2 9V3h16v6H2zm14-4h-4v2h4V5zM2 17v-6h16v6H2zm4-4h10v2H6v-2z" fill-rule="evenodd" clip-rule="evenodd" fill="currentColor"></path>',v:'<path d="M5 10h.1A5.006 5.006 0 0 0 9 13.9V16H7v2h6v-2h-2v-2.1a5.006 5.006 0 0 0 3.9-3.9h.1a3 3 0 0 0 3-3V4h-3V2H5v2H2v3a3 3 0 0 0 3 3zm2-6h6v5a3 3 0 1 1-6 0V4zm8 2v2a1 1 0 0 0 1-1V6h-1zM4 6h1v2a1 1 0 0 1-1-1V6z" fill-rule="evenodd" clip-rule="evenodd" fill="currentColor"></path>',g:'<path clip-rule="evenodd" d="M7 2a4 4 0 0 0-1.015 7.87A1.334 1.334 0 0 1 4.667 11 2.667 2.667 0 0 0 2 13.667V18h2v-4.333c0-.368.298-.667.667-.667A3.32 3.32 0 0 0 7 12.047 3.32 3.32 0 0 0 9.333 13c.369 0 .667.299.667.667V18h2v-4.333A2.667 2.667 0 0 0 9.333 11c-.667 0-1.22-.49-1.318-1.13A4.002 4.002 0 0 0 7 2zM5 6a2 2 0 1 0 4 0 2 2 0 0 0-4 0z" fill="currentColor" fill-rule="evenodd"></path><path d="M14 11.83V18h4v-3.75c0-.69-.56-1.25-1.25-1.25a.75.75 0 0 1-.75-.75v-.42a3.001 3.001 0 1 0-2 0z" fill="currentColor"></path>',M:'<path d="M9 2h2v3H9V2zm6.884 1.309 1.732 1-1.5 2.598-1.732-1 1.5-2.598zm-13.5 1 1.732-1 1.5 2.598-1.732 1-1.5-2.598z" fill="currentColor"></path><path clip-rule="evenodd" d="M14 8v2h4v8H2v-6h4V8h8zm-2 2v2h4v4H4v-2h4v-4h4z" fill="currentColor" fill-rule="evenodd"></path>',user:'<path d="M5 7a5 5 0 1 1 6.192 4.857A2 2 0 0 0 13 13h1a3 3 0 0 1 3 3v2h-2v-2a1 1 0 0 0-1-1h-1a3.99 3.99 0 0 1-3-1.354A3.99 3.99 0 0 1 7 15H6a1 1 0 0 0-1 1v2H3v-2a3 3 0 0 1 3-3h1a2 2 0 0 0 1.808-1.143A5.002 5.002 0 0 1 5 7zm5 3a3 3 0 1 1 0-6 3 3 0 0 1 0 6z" fill-rule="evenodd" clip-rule="evenodd" fill="currentColor"></path>',reverse:'<path d="m12 4 1 1H5a3 3 0 0 0-3 3v4l2-2V8a1 1 0 0 1 1-1h8l-1 1 1.5 1.5L17 6l-3.5-3.5L12 4Z" fill="currentColor"></path><path d="m7 15 1 1-1.5 1.5L3 14l3.5-3.5L8 12l-1 1h8a1 1 0 0 0 1-1v-2l2-2v4a3 3 0 0 1-3 3H7Z" fill="currentColor"></path>',k:'<path d="M11 4.5 9 2 4.8 6.9A7.48 7.48 0 0 0 3 11.77C3 15.2 5.8 18 9.23 18h1.65A6.12 6.12 0 0 0 17 11.88c0-1.86-.65-3.66-1.84-5.1L12 3l-1 1.5ZM6.32 8.2 9 5l2 2.5L12 6l1.62 2.07A5.96 5.96 0 0 1 15 11.88c0 2.08-1.55 3.8-3.56 4.08.36-.47.56-1.05.56-1.66 0-.52-.18-1.02-.5-1.43L10 11l-1.5 1.87c-.32.4-.5.91-.5 1.43 0 .6.2 1.18.54 1.64A4.23 4.23 0 0 1 5 11.77c0-1.31.47-2.58 1.32-3.57Z" fill-rule="evenodd" clip-rule="evenodd" fill="currentColor"></path>',play:'<path d="M7 20.528V3.472c0-.38.405-.603.703-.388L20 12 7.703 20.916c-.298.215-.703-.008-.703-.388Z" fill="currentColor"></path>',C:'<path d="M12 4h2.586L9.293 9.293l1.414 1.414L16 5.414V8h2V2h-6v2z" fill="currentColor"></path><path d="M4 4h6v2H4v10h10v-6h2v6a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" fill="currentColor"></path>',P:'<path d="M10 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16zm3 5 1.5 1.5L9 14l-3.5-3.5L7 9l2 2 4-4z" fill-rule="evenodd" clip-rule="evenodd" fill="currentColor"></path>',$:'<path d="M4.793 4.073 13 10l-8.207 5.928A.5.5 0 0 1 4 15.521V4.478a.5.5 0 0 1 .793-.405ZM16 4h-2v12h2V4Z" fill="currentColor"></path>',A:'<path d="M12 2H8v1H3v2h14V3h-5V2zM4 7v9a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7h-2v9H6V7H4z" fill="currentColor"></path><path d="M11 7H9v7h2V7z" fill="currentColor"></path>'},Ve=new Image,ze=(Ve.src="https://static-cdn.jtvnw.net/subs-image-assets/gift-illus.png",null),De=null;let le="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=null,o=document.createElement("button");function $e(e,t=20,n=20,o=20,i=20){var a=document.createElementNS("http://www.w3.org/2000/svg","svg");return a.setAttribute("width",t),a.setAttribute("height",n),a.setAttribute("viewBox",`0 0 ${o} `+i),a.style.minHeight=a.style.maxHeight=n+"px",a.style.minWidth=a.style.maxWidth=t+"px",a.innerHTML=e,a}function Ae(e,t=!1,n=0){var o=e<0,i=o?-e:e,a=Math.floor(i/3600),r=Math.floor(i%3600/60),i=Math.floor(i%60),o=o?"-":"",t=0<a||t?o+a.toString().padStart(2,"0")+`:${r.toString().padStart(2,"0")}:`+i.toString().padStart(2,"0"):o+r.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0");return n?t+"."+(e%1).toFixed(n).substring(2):t}function Fe(e){let t=Math.floor(e/3600);var n,o=Math.floor(e%3600/60),e=Math.floor(e%60),i=[];return 23<t&&(n=Math.floor(t/24),i.push(n+" day"+(1!==n?"s":"")),t%=24),0<t&&i.push(t+" hour"+(1!==t?"s":"")),0<o&&i.push(o+" minute"+(1!==o?"s":"")),0<e&&i.length<2&&i.push(e+" second"+(1!==e?"s":"")),i.join(" ")||"0 seconds"}function se(e){e=new Date(1e3*e);return e.toLocaleString(void 0,{month:"short"})+` ${e.getDate()} ${e.getFullYear()}, `+new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(e)}function de(e){e.offsetHeight}o.textContent="▼ Scroll to Bottom",o.className="scroll-bottom-btn",o.addEventListener("click",()=>{be.scrollTop=be.scrollHeight}),C.appendChild(o),be.addEventListener("scroll",Tt);class ce{constructor(e,t){this.operationName=e,this.sha256Hash=t,this.extensions={persistedQuery:{version:1,sha256Hash:this.sha256Hash}}}L(e={}){return{operationName:this.operationName,extensions:this.extensions,variables:e}}}class he extends ce{constructor(){super("BitsConfigContext_Global","6a265b86f3be1c8d11bdcf32c183e106028c6171e985cc2584d15f7840f5fee6")}}class ue extends ce{constructor(){super("StreamMetadata","b57f9b910f8cd1a4659d894fe7550ccc81ec9052c01e438b290fd66a040b9b93")}}class pe extends ce{constructor(){super("ChatList_Badges","838a7e0b47c09cac05f93ff081a9ff4f876b68f7624f0fc465fe30031e372fc2")}}class me extends ce{constructor(){super("GlobalBadges","9db27e18d61ee393ccfdec8c7d90f14f9a11266298c2e5eb808550b77d7bcdf6")}}class ve extends ce{constructor(){super("getUserLoginInfo","324dbc4e29626d9db7a013bed894b0745f2104c279386a00e17f637e6e2d0fe0")}}class fe extends ce{constructor(){super("ChannelPointsContext","374314de591e69925fce3ddc2bcf085796f56ebb8cad67a0daa3165c03adc345")}}let ge=new class{I=new he;S=new pe;T=new me;V=new ue;D=new ve;F=new fe};class Be extends Error{constructor(e){super("string"==typeof e?e:JSON.stringify(e)),this.name="RequestError",this.B=e}}let E=new class{constructor(e=30,t=35,n=3e3){this.H=e,this.O=t,this.R=n,this.N=[],this.total=0,this.j=0,this._=null,this.endpoint="https://gql.twitch.tv/gql",this.headers={"Client-ID":"kimne78kx3ncx6brgo4mv6wki5h1ko","Device-Id":Array(32).fill(0).map(()=>le.charAt(Math.floor(Math.random()*le.length))).join(""),"Accept-Language":"en-US"}}async add(t,i=10){for(;0<=i;){let n,o;var e=new Promise((e,t)=>{n=e,o=t}),a=(this.N.push({U:t,resolve:n,reject:o}),this.N.length),r=Date.now();1===a?(this.j=r,this._=setTimeout(()=>this.G(),this.H)):(a>=this.O||r-this.j>=this.H)&&(this._&&(clearTimeout(this._),this._=null),await this.G());try{return await e}catch(e){if(--i<0)throw a=t.operationName||"unknown",new Error(`Failed to execute operation "${a}" after retries: `+e.message)}}}async G(){if(this.N.length){var n=this.N,t=(this.N=[],this._&&(clearTimeout(this._),this._=null),n.length);this.total+=t;try{console.debug(`Collecting ${t} promises...`);var o=JSON.stringify(n.map(e=>e.U)),i=this.q(o.length),a=Date.now();let e=new AbortController;var r=setTimeout(()=>e.abort(),this.R),l=await fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json",...this.headers},body:o,signal:e.signal});if(clearTimeout(r),!l.ok)throw new Error(`Invalid response status (${l.status})`);var s=await l.text(),d=this.q(s.length),c=JSON.parse(s),h=((Date.now()-a)/1e3).toFixed(2);console.debug(`Collected ${t} promise(s) (${i}) in ${h}s (${d}). Total: `+this.total);for(let e=0;e<n.length;e++){var u,p,m=n[e],v=c[e];v.errors?(u=new Be(v.errors),p=m.U.operationName||"Unknown",console.warn(`[${p}] Operation error: `+JSON.stringify(v.errors)),m.reject(u)):m.resolve(v.data||v)}}catch(t){console.error(`Error collecting ${n.length} promises: `+t.message);for(let e=0;e<n.length;e++)n[e].reject(new Be(t))}}}q(e){return e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB"}},He=new class{constructor(e,t,n=1){this.J=e,this.Z=t,this.version=n,this.K=null}async init(){return this.K||new Promise((t,n)=>{if(window.indexedDB){let e=indexedDB.open(this.J,this.version);e.onerror=()=>n(e.error),e.onsuccess=()=>{this.K=e.result,t(this.K)},e.onupgradeneeded=e=>{e=e.target.result;e.objectStoreNames.contains(this.Z)||e.createObjectStore(this.Z,{keyPath:"id"})}}else n(new Error("IndexedDB not supported"))})}async set(o,i){try{return this.K||await this.init(),new Promise((e,t)=>{let n=this.K.transaction([this.Z],"readwrite").objectStore(this.Z).put({id:o,data:i,timestamp:Date.now()});n.onerror=()=>t(n.error),n.onsuccess=()=>e(!0)})}catch(e){return console.warn("IndexedDB set failed:",e),!1}}async get(o){return this.K||await this.init(),new Promise((t,e)=>{let n=this.K.transaction([this.Z],"readonly").objectStore(this.Z).get(o);n.onerror=()=>e(n.error),n.onsuccess=()=>{var e=n.result;t(e?e.data:null)}})}async delete(o){try{return this.K||await this.init(),new Promise((e,t)=>{let n=this.K.transaction([this.Z],"readwrite").objectStore(this.Z).delete(o);n.onerror=()=>t(n.error),n.onsuccess=()=>e(!0)})}catch(e){return console.warn("IndexedDB delete failed:",e),!1}}async W(){try{return this.K||await this.init(),new Promise((e,t)=>{let n=this.K.transaction([this.Z],"readwrite").objectStore(this.Z).clear();n.onerror=()=>t(n.error),n.onsuccess=()=>e(!0)})}catch(e){return console.warn("IndexedDB deleteAll failed:",e),!1}}async totalSize(){try{return this.K||await this.init(),new Promise((n,e)=>{let t=this.K.transaction([this.Z],"readonly").objectStore(this.Z).openCursor(),o=0;t.onerror=()=>e(t.error),t.onsuccess=e=>{var t,e=e.target.result;e?(t=e.value,o+=this.X(t),e.continue()):n(o)}})}catch(e){return console.warn("IndexedDB totalSize failed:",e),0}}X(t){if(Array.isArray(t))return t.reduce((e,t)=>e+this.X(t),0);if("object"!=typeof t)return null==t?0:t instanceof Blob?t.size:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:"string"==typeof t?2*t.length:"number"==typeof t?8:"boolean"==typeof t?4:0;{let e=0;for(var n in t)t.hasOwnProperty(n)&&(e=(e+=2*n.length)+this.X(t[n]));return e}}},Le=new class{constructor(){this.Y=new Map,this.ee=new Map,this.u=null,this.te=null,this.ne=[],this.oe=[],this.ie=new Map,this.ae=new Map,this.re=null,this.poll=null,this.p=null,this.le=null,this.se=60}de(){var t=new Set;for(let e=0;e<u;e++){var n=h[e],o=e=>{var t=Date.parse(e.created_at)/1e3,t={ce:t,he:t+e.prediction_window_seconds,ue:e};return this.ee.set(e.id,t),t};switch(n.type){case"pin":"pin-message"===n.data.type&&("CHEER"===(i=n.data.data.message.type)?this.ne.push(n.data.data):"MOD"===i&&this.oe.push(n.data.data));break;case"poll":var i=n.data.type,a=n.data.data.poll,r=a.poll_id;"POLL_CREATE"===i?this.ie.set(r,a):"POLL_COMPLETE"!==i&&"POLL_ARCHIVE"!==i||t.has(r)||(this.ae.set(r,a),t.add(r)),"POLL_CREATE"===i||this.ie.get(r)||this.ie.set(r,a);break;case"prediction":var r=n.data.type,l=n.data.data.event;if(!(2<l.outcomes.length)){var a=l.status,s=l.id;if("event-created"===r)o(l);else if("event-updated"===r){var d=this.ee.get(s)||o(l);switch(a){case"RESOLVED":d.pe=l;case"RESOLVE_PENDING":if(!d.me){d.me=Date.parse(n.data.data.timestamp)/1e3;let e;var c=(d.pe=l).outcomes;e=l.winning_outcome_id?l.winning_outcome_id===c[0].id?0:1:"WIN"===c[0].top_predictors[0].result.type?0:1,d.ve=e}break;case"LOCKED":d.he=Date.parse(l.locked_at)/1e3,d.fe=l}}}}}}ge(){var e,t,n,o=S();if(this.p&&(this.p.ce>o||this.p.me+this.se<o))return this.be(this.p.id);if(this.p)this.p.xe&&(e=o-this.p.ce,(t=this.p.xe).style.animation="none",de(this.p.xe),t.style.animation=`translateRightToLeft ${this.p.duration*z}s linear both`,t.style.animationPlayState=P.paused?"paused":"running",t.style.animationDelay=`-${e*z}s`),this.p.details&&(this.p.me>o&&this.p.resolved?this.we(this.p.id):o>this.p.me&&!this.p.resolved&&this.ye(this.ee.get(this.p.id).pe));else for(var[i,a]of this.ee)if(a.ce<=o&&o<a.me+this.se)return n=o>a.me?a.pe:o>a.he?a.fe:a.ue,this.Me(n),void(o>this.me&&this.ye(a.pe))}Me(i){if(this.p){if(this.p.id===i.id)return;this.be(this.p.id)}i||console.log(i);var a=i.outcomes,r=a.length;if(!(2<r)){var r=i.id,l=this.ee.get(r),s=i.title,d=i.created_by.user_display_name,c=l.ce,h=l.he,l=l.me,u=h-c,p=S();if(!(p<c||p>l+this.se)){p=["RESOLVED","RESOLVE_PENDING"].includes(i.status);let e=document.createElement("div");e.className="event-window-container",e.style.padding="10px 10px 13px";var m=document.createElement("div"),v=(m.style="display: flex; align-items: center; justify-content: space-between;",document.createElement("div")),f=(v.style="display: flex; flex-direction: column; gap: 9px; flex: 1 1 auto; min-width: 0;",document.createElement("div")),g=(f.style="color: var(--timestamp-color); font-size: 0.75rem; overflow: hidden; text-overflow: ellipsis;",f.textContent="Current Prediction by "+d,document.createElement("div")),f=(g.style="font-weight: bold; font-size: 0.95rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",g.textContent=s,v.appendChild(f),v.appendChild(g),document.createElement("button"));f.style="font-weight: bold; border-radius: 4px; background: var(--accent-color); margin: 4px 8px 0 8px; color: white; height: auto; border: none; padding: 8px 12px; min-height: min-content; cursor: pointer; white-space: nowrap;",f.className="btn-2x",f.textContent="See Details",f.onclick=this.ke.bind(this),m.appendChild(v),m.appendChild(f),e.appendChild(m);let t=document.createElement("div"),n=(t.className="animated-border",e.classList.add("animated-border-container"),document.createElement("div"));n.className="marquee-container";g=document.createElement("div");g.className="marquee-content",g.appendChild($e(Pe.p,36,36,20,20)),g.appendChild(document.createTextNode(p?"Prediction Ended":"Prediction Started!")),n.appendChild(g),D.appendChild(n),g.style.animation="marqueeFromRight 3s linear";let o=setTimeout(b,3e3);function b(){n.replaceWith(e),Le.p.xe=t,Le.ge(),e.appendChild(t)}n.onclick=()=>{clearTimeout(o),b()},this.p={id:r,title:s,outcomes:a,duration:u,ce:c,he:h,me:l,Ce:d,Pe:n,ze:o,xe:null,element:e,details:null,resolved:!1},p&&this.ye(i)}}}ke(){if(this.p&&!this.p.details){var n=document.createElement("div"),o=(n.className="prediction-details-container",A.appendChild(n),this.p.$e=n,document.createElement("div")),i=(o.style="display: flex; align-items: center; justify-content: space-between;",zt.Ae());o.appendChild(document.createTextNode("Prediction")),o.appendChild(i),n.appendChild(o);let e=document.createElement("div");e.className="prediction-details-title";o=document.createElement("span");o.style="letter-spacing: 0.5px;",o.textContent=this.p.title;let t=document.createElement("span");t.style="font-size: 0.9rem; font-weight: normal; color: var(--text-color);";var a=()=>{var e=S();e>this.p.me?t.textContent="Prediction resolved "+Fe(e-this.p.me)+" ago":t.textContent=e>=this.p.he?"Submissions Locked":"Submissions Open"+` (${Ae(this.p.he-e)} left)`},r=(a(),setInterval(a,1e3)),l=(e.appendChild(o),e.appendChild(t),n.appendChild(e),document.createElement("div")),s=(l.style=` display: flex; width: 100%; `,"display: inline-flex; align-items: center; vertical-align: middle; gap: 3px;"),d=[];for(let o=0;o<2;o++){var c=o?"left":"right",h=`var(--prediction-${o?"pink":"blue"})`,u=this.p.outcomes[o],{Le:p,ratio:m,Ie:v,Ee:f,Se:g}=$(u,this.p.outcomes[1^o]),b=document.createElement("div"),c=o?"":`border-${c}: 1px solid var(--panel-border);`,x=o?"0 0 0 8px":"0 8px 0 0",x=(b.style=` display: flex; flex-direction: column; vertical-align: middle; justify-content: space-between; width: 50%; max-width: 50%; padding: ${x}; background: none; ${c} `,o?"":"text-align: right;"),c=document.createElement("div"),w=o?"align-items: flex-end;":"",x=(c.style=` display: flex; flex-direction: column; vertical-align: middle; gap: 2px; font-size: 0.75rem; font-weight: bold; ${x} ${w} `,(e,t,n)=>{o?(e.appendChild(n),e.appendChild(t)):(e.appendChild(t),e.appendChild(n))}),w=document.createElement("span"),y=(w.title="Total Points Bet",w.style=s,$e(Pe.m,18,18,20,20)),M=(y.style.color=h,document.createTextNode("")),w=(x(w,y,M),c.appendChild(w),(y=document.createElement("span")).title="How many points you get per 1-risked",y.style=s,$e(Pe.v,18,18,20,20)),k=(w.style.color=h,document.createElement("span")),C=(k.appendChild(document.createTextNode("1:")),document.createTextNode("")),k=(k.appendChild(C),x(y,w,k),c.appendChild(y),(w=document.createElement("span")).style=s,w.title="Participants Amount",$e(Pe.g,18,18,20,20)),y=(k.style.color=h,document.createTextNode("")),w=(x(w,k,y),c.appendChild(w),(k=document.createElement("span")).title="Highest bet payout amount",k.style=s,$e(Pe.M,18,18,20,20)),P=(w.style.color=h,document.createTextNode(""));x(k,w,P),c.appendChild(k);let e=document.createElement("span");var w=o?"align-self: flex-start;":"align-self: flex-end;",k=o?"flex-direction: row-reverse;":"",k=(e.style=`display: inline-flex; ${k}${w}align-items: center; gap: 4px; font-weight: bold; font-size: 1.25rem; margin-bottom: 8px; color: ${h};`,document.createTextNode(u.title)),w=(k.textContent=u.title,e.appendChild(k),b.appendChild(e),o?"":"align-items: flex-end"),u=document.createElement("div"),k=(u.style="display: flex; flex-direction: column; width: 100%; gap: 2px; min-width: 0; padding-block-end: 5%; "+w,document.createElement("span")),w=(k.style=`font-size: 1.4rem; font-weight: bold; color: ${h};`,document.createTextNode("")),z=(k.appendChild(w),k.appendChild(document.createTextNode("%")),document.createElement("div")),k=(z.style=`background: ${h}; border-radius: 4px; height: 10px; min-width: 10px; transition: width 1.0s; transition-timing-function: cubic-beizer(0.33, 0, 0.1, 1);`,u.appendChild(k),u.appendChild(z),document.createElement("div"));k.style="display: flex; justify-content: space-between; align-items: flex-end;",x(k,c,u),b.appendChild(k),l.appendChild(b),d.push({Le:p,Te:M,ratio:m,Ve:C,Ie:v,De:y,Ee:f,Fe:P,Se:g,Be:w,He:z,Oe:e,Re:h,Ne:null})}function $(e,t){var n=e.total_points;let o=0,i=0,a=0;return n&&(t=t.total_points)&&(o=t/n,i=Math.round(n/(t+n)*100),t=e.top_predictors)&&t.length&&(t=t[0].points,a=t*o),{Le:n,ratio:o,Ie:e.total_users,Ee:a,Se:i}}n.appendChild(l),this.p.details={je:d,_e:t,Ue:r,Ge:a,qe:n,Je:null,update:function(){if(Le.p.details){var t=Le.p.outcomes;for(let e=0;e<2;e++){var n=Le.p.details.je[e],o=$(t[e],t[1^e]),{Le:i,ratio:a,Ie:r,Ee:l,Se:s}=o;n.He.style.width=s.toFixed(2)+"%",it(n.Te,n.Le,i,600),((n,o,i,a,e=2,r=nt.Ze)=>{let l=null,s=new Intl.NumberFormat(void 0,{minimumFractionDigits:e,maximumFractionDigits:e}),d=e=>{null===l&&(l=e);var e=Math.min((e-l)/a,1),t=r(e),t=o+(i-o)*t;n.textContent=s.format(t),e<1&&window.requestAnimationFrame(d)};window.requestAnimationFrame(d)})(n.Ve,n.ratio,a,600),it(n.De,n.Ie,r,600),tt(n.Be,n.Se,s,600),it(n.Fe,n.Ee,l,600),Object.assign(n,o)}}},close:function(){var e=Le.p.details;clearInterval(e.Ue),e.qe.remove(),Le.p.details=null},resolve:function(){var e=Le.ee.get(Le.p.id),e=Le.p.details.je[e.ve],t=$e(Pe.P,20,20,20,20),e=(t.style.alignSelf="flex-start",t.style.color=e.Re,e.Oe.appendChild(t),e.Ne=t,Le.p.details.Ge(),document.createElement("div")),t=(e.className="btn-2x",e.style="display: flex; align-items: center; align-self: flex-end; border: none; padding: 6px; border-radius: 5px; gap: 5px; color: var(--text-color); margin: 2px 0;",$e(Pe.C,20,20,20,20));t.style.color="var(--theme-opposite-color)",e.appendChild(t),e.appendChild(document.createTextNode("Summary")),e.onclick=e=>Le.Ke(Le.p.id,e),Le.p.details.qe.appendChild(e),Le.p.details.Je=e},Qe:function(){var e=Le.ee.get(Le.p.id).ve,e=Le.p.details.je[e];e.Ne.remove(),e.Ne=null,Le.p.details.Ge(),Le.p.details.Je.remove()}},i.onclick=i.ontouchend=this.p.details.close,this.p.details.update(),this.p.resolved&&this.p.details.resolve()}}Ke(e,t){var n="summary-"+e;if(!document.body.querySelector("#"+n)){var e=this.ee.get(e),o=e.pe;let y=o.outcomes,M=e.ve;var i=y[M],a=y[1^M],r=i.total_points+a.total_points,l=[y[0].total_points/r*100,y[1].total_points/r*100],r=zt.We(n,"Prediction Summary",t,{width:"30vw","min-width":"fit-content",height:"92vh","max-height":"max-content"}),n=o.outcomes[e.ve].badge,t=n.set_id+n.version,e=x.get(t).image4x,n=document.createElement("div"),t=(n.style="display: flex; gap: 4px;",new Image),e=(t.style="width: 50px; height: 50px;",t.src=e,n.appendChild(t),document.createElement("div")),t=(e.style="display: flex; flex-direction: column; align-self: flex-end; gap: 4px; color: var(--game-name-color); font-size: 0.8rem;",e.appendChild(document.createTextNode(o.title)),document.createElement("span")),a=(t.style="font-size: 1.1rem; font-weight: bold; color: var(--text-color);",t.textContent=`${ot(a.total_points)} Channel Points awarded to ${i.total_users} users`,e.appendChild(t),o.created_by.user_display_name===o.ended_by.user_display_name?"Created and resolved by "+o.created_by.user_display_name:`Created by ${o.created_by.user_display_name}, resolved by `+o.ended_by.user_display_name),i=(e.appendChild(document.createTextNode(a)),n.appendChild(e),document.createElement("div")),s=(i.style="display: flex; flex-direction: column; gap: 10px; padding: 10px; overflow-y: scroll;",document.createElement("div")),d=(s.style="display: flex; align-items: center; border-radius: 4px; background: var(--tint-blue-1); min-height: 40px; width: 100%; font-size: 0.9rem; font-weight: bold;",$e(Pe.v,24,24,20,20));let k=[];for(let e=0;e<2;e++){var c=document.createElement("div"),h=e?"0 4px 4px 0":"4px 0 0 4px",u=e?"":"border-right: 2px solid var(--panel-bg);",p=l[e];c.style=`display: inline-flex; align-items: center; border-radius: ${h}; padding: 0 6px; gap: 2px; ${u} height: -webkit-fill-available; width: ${p}%; min-width: 40px; cursor: pointer;`,e==M&&c.appendChild(d),c.appendChild(document.createTextNode(Math.round(l[e]).toString()+"%")),c.onclick=()=>m(e),s.appendChild(c),k.push(c)}let C=document.createElement("div"),P=(C.style="display: flex; flex-direction: column; background: var(--tint-blue-1);",null);function m(e){if(null===P||P!=e){var t,n=e===M,o=(C.innerHTML="",1^e),l=y[e],s=`var(--prediction-${e?"pink":"blue"})`,d=(k[e].style.background=s,k[e].style.color="var(--text-color)",k[o].style.background="var(--tint-blue-1)",k[o].style.color="var(--game-name-color)",P=e,l.top_predictors),c=new Intl.NumberFormat,s="padding: 10px; border-bottom: 1px solid var(--bg-color); border-right: 1px solid var(--bg-color);",e=document.createElement("span"),h=(e.style="display: block; font-size: 1.5rem; font-weight: bold;"+s,e.textContent=l.title,document.createElement("div")),s=(h.style="display: flex; gap: 4rem;"+s,[{name:"Users",value:l.total_users},{name:"Points Spent",value:l.total_points}]);n&&s.push({name:"Points Won",value:y[o].total_points});for(t of s){var u=document.createElement("div"),p=(u.style="display: flex; flex-direction: column; gap: 2px; color: var(--game-name-color); font-size: 0.9rem;",document.createElement("span"));p.style="font-size: 1.1rem; font-weight: bold; color: var(--text-color);",p.textContent=c.format(t.value),u.appendChild(p),u.appendChild(document.createTextNode(t.name)),h.appendChild(u),t.Xe=u}C.appendChild(e),C.appendChild(h);var l=document.createElement("div"),o=(l.style="display: flex; flex-direction: column; gap: 10px; padding: 14px;",document.createElement("span")),m=(o.style="font-size: 1.1rem; font-weight: bold;",o.textContent=n?"Biggest Winners & Payouts":"Biggest Voters",l.appendChild(o),"var(--tint-blue-1)");let a=`padding: 6px 8px; border-right: 1px solid ${m}; text-align: left;`;var s=document.createElement("table"),e=(s.style="width: 100%; border-collapse: collapse; font-size: 0.9rem; background: var(--tint-blue-2);",document.createElement("thead")),v=document.createElement("tbody");let i=["#","Username",n?"Points Spent":"Points Lost"],r=(n&&i.push("Points Won"),document.createElement("tr"));r.style=`border-bottom: 1px solid ${m};`,i.forEach((e,t)=>{var n=document.createElement("th");n.textContent=e;let o="";0===t?o="width: 2.5rem; white-space: nowrap;":1<t&&(o="width: 6rem; white-space: nowrap;");e=t===i.length-1?"border-right: none;":"";n.style=a+` ${o} ${e} opacity: 0.8;`,r.appendChild(n)}),e.appendChild(r);for(let e=0,t=d.length;e<t;e++){var f=d[e],g=f.points,b=f.user_display_name,x=f.user_id,f=n?f.result.points_won:0,w=e+1;let o=document.createElement("tr"),i=(o.style=`border-bottom: 1px solid ${m};`,[w,Ee({id:x,"display-name":b},"inherit"),c.format(g)]);n&&i.push(c.format(f)),i.forEach((e,t)=>{var n=document.createElement("td"),e=(e instanceof HTMLElement?n.appendChild(e):n.textContent=e,t===i.length-1?"border-right: none;":"");n.style=a+" "+e,o.appendChild(n)}),v.appendChild(o)}s.appendChild(e),s.appendChild(v),l.appendChild(s),C.appendChild(l)}}m(0),i.appendChild(n),i.appendChild(s),i.appendChild(C),r.appendChild(i),r.Ye()}}et(e){return this.p?this.p.id!==e.id?(this.be(this.p.id),this.Me(e)):(this.p.outcomes=e.outcomes,void(this.p&&this.p.details&&this.p.details.update())):this.Me(e)}tt(e){}we(e){this.p.id===e&&this.p.resolved&&(this.p.details&&(e=this.ee.get(e),this.p.details.Qe(e.ve)),this.p.resolved=!1)}ye(e){if(!this.p)return this.Me(e);this.p.resolved||this.p.id===e.id&&(e=this.ee.get(e.id),this.p.details&&this.p.details.resolve(e.ve),this.p.resolved=!0)}be(e){this.p&&this.p.id===e&&(clearTimeout(this.p.ze),this.p.Pe&&this.p.Pe.remove(),this.p.element.remove(),this.p.details&&this.p.details.close(),this.p=null)}nt(){var e,t,n,o,i=S();if(this.poll&&(this.poll.me+60<=i||this.poll.ce>i))this.ot(this.poll.id);else if(this.poll)return this.poll.xe?(e=i-this.poll.ce,(t=this.poll.xe).style.animation="none",de(this.poll.xe),t.style.animation=`translateRightToLeft ${this.poll.duration*z}s linear both`,t.style.animationDelay=`-${e*z}s`,void(t.style.animationPlayState=P.paused?"paused":"running")):void 0;for([n,o]of this.ie){var a=Date.parse(o.started_at)/1e3,r=this.ae.get(n),l=Date.parse(r.ended_at)/1e3;if(a<=i&&i<60+l&&(this.it(o),l<i)){this.rt(r);break}}}it(e){if(this.poll){if(this.poll.id===e.poll_id)return;this.ot(this.poll.id)}var t=e.poll_id,n=e.created_by,o=ee.get(n),i=e.title,a=Date.parse(e.started_at)/1e3,r=e.duration_seconds,l=S(),s=Date.parse(this.ae.get(t).ended_at)/1e3;if(l<=a||60+s<l)return;var l=s<l,d=e.choices,c=d.length,h=e.votes.total;let u=document.createElement("div");u.className="marquee-container";e=document.createElement("div");e.className="marquee-content",e.appendChild($e(Pe.poll,30,30,20,20)),e.appendChild(document.createTextNode(l?"Poll Ended":"Poll Started!")),u.appendChild(e),D.appendChild(u),e.style.animation="marqueeFromRight 3s linear";let p=document.createElement("div");p.className="event-window-container";l=document.createElement("div"),l.className="poll-header-container",e=document.createElement("div");e.style="display: flex; flex-direction: column; gap: 6px;";let m=document.createElement("span");m.style="color: var(--timestamp-color); font-size: 0.8rem;",o?m.textContent="Current Poll by "+o:(m.textContent="Current Poll",(async e=>{var t=await E.add(ge.D.L({id:e}));if(t=t&&t.user&&t.user.login||null)return ee.set(e,t),t})(n).then(e=>{this.poll&&(m.textContent="Current Poll by "+e,this.poll.Ce=e)}));n=document.createElement("span"),n.style="font-weight: bold; font-size: 0.9rem;",n.textContent=i,e.appendChild(m),e.appendChild(n),l.appendChild(e),n=document.createElement("div");n.style="color: var(--text-color); margin-right: 9px;";let v=$e(Pe.collapse,18,18,20,20);v.setAttribute("class","btn");function f(e){e.stopPropagation(),v.innerHTML=$e(Pe.collapse,18,18,20,20).innerHTML,v.onclick=g,b.style.display="flex",Le.poll&&(Le.poll.isCollapsed=!1)}function g(e){e.stopPropagation(),v.innerHTML=$e(Pe.expand,18,18,20,20).innerHTML,v.onclick=f,b.style.display="none",Le.poll&&(Le.poll.isCollapsed=!0)}v.onclick=e=>g(e),l.onclick=e=>{("none"===b.style.display?f:g)(e)},n.appendChild(v),l.appendChild(n),p.appendChild(l);let b=document.createElement("div");b.className="poll-choice-container";var x=new Map;for(let e=0;e<c;e++){var w=d[e],y=w.choice_id||e,M=w.title,w=w.votes.total,k=document.createElement("div"),C=(k.className="poll-choice",document.createElement("div")),P=(C.className="sweep",k.appendChild(C),document.createElement("span")),M=(P.id="poll-title",P.style="font-weight: bold; font-size: 0.9rem; z-index: 1;",P.textContent=M,k.appendChild(P),document.createElement("div")),P=(M.style="display: flex; align-items: center; gap: 5px; z-index: 1;",document.createElement("span")),z=(P.style="font-size: 0.85rem;",h?(w/h*100).toFixed(1):"0.0"),z=(C.style.width=z+"%",C.style.background="var(--choice-sweep-bg)",C.dataset.lastPct=z,document.createTextNode(z)),$=(P.appendChild(z),P.appendChild(document.createTextNode("%")),document.createElement("span")),w=($.style="font-size: 0.85rem;",document.createTextNode(""+w));$.appendChild(document.createTextNode("(")),$.appendChild(w),$.appendChild(document.createTextNode(")")),M.appendChild(P),M.appendChild($),k.appendChild(M),b.appendChild(k),x.set(y,[k,z,w,C])}p.appendChild(b);let A=document.createElement("div");function L(){u.replaceWith(p),Le.poll.xe=A,Le.nt(),p.appendChild(A)}A.className="animated-border",p.classList.add("animated-border-container");let I=setTimeout(L,3e3);u.onclick=()=>{clearTimeout(I),L()},this.poll={id:t,title:i,lt:d,st:Array.from(x.keys()),dt:x,duration:r,ce:a,me:s,Ce:o,ct:u,ze:I,isCollapsed:!1,ht:h,xe:null,element:p,finished:!1}}ut(e){var t=e.poll_id;if(this.poll){if(this.poll.id===t){if(this.poll.finished){if(!(S()<this.poll.me))return;this.vt(t)}var n=e.votes.total,o=e.choices,i=this.poll.ht,a=this.poll.isCollapsed;for(let e=0;e<o.length;e++){var r=o[e],l=r.choice_id||this.poll.st[e],r=r.votes.total,[,l,s,d]=this.poll.dt.get(l),c=this.poll.lt[e].votes.total,h=i?c/i*100:0,u=n?r/n*100:0;a?(d.style.width=u+"%",d.dataset.lastPct=u,l.textContent=u.toFixed(1),s.textContent=r.toString()):(((n,o,i,a)=>{if(r=n.parentElement)if(0===r.offsetWidth)n.style.width=o+"%",n.dataset.lastPct=o;else{var r=r.clientWidth||parseFloat(getComputedStyle(r).width)||1;let e=parseFloat(getComputedStyle(n).width),t=(e=Number.isFinite(e)?e:0)/r*100;(r<=1||0===e)&&n.dataset.lastPct&&0<(r=parseFloat(n.dataset.lastPct))&&(t=r),n.ft&&(n.ft.cancel(),n.ft=null),Math.abs(t-o)<.1?(n.style.width=o+"%",n.dataset.lastPct=o):(n.ft=n.animate([{width:t+"%"},{width:o+"%"}],{duration:i,easing:a,fill:"forwards"}),n.dataset.lastPct=o,n.ft.onfinish=()=>{n.style.width=o+"%",n.ft=null})}})(d,u,777,"cubic-bezier(0.165, 0.84, 0.44, 1)"),((n,o,i,a,e)=>{let r=null,l=new Intl.NumberFormat(void 0,{minimumFractionDigits:e,maximumFractionDigits:e}),s=e=>{r=r||e;var e=Math.min((e-r)/a,1),t=o+(i-o)*e;n.textContent=l.format(t),e<1&&window.requestAnimationFrame(s)};window.requestAnimationFrame(s)})(l,h,u,666,1),tt(s,c,r,666))}this.poll.ht=n,this.poll.lt=o}}else this.it(e)}vt(e){this.poll&&this.poll.id===e&&(this.poll.lt.forEach((e,t)=>{var n,[e]=this.poll.dt.get(e.choice_id||this.poll.st[t]),t=(e.style.order=t,e.style.background="",e.style.zIndex="",e.querySelector("#poll-title"));t&&((n=t.firstChild)&&"svg"===n.tagName&&n.remove(),t.style.display="",t.style.gap=""),e.style.transform=""}),this.poll.finished=!1,this.nt())}rt(e){var n=e.poll_id;if(this.poll&&this.poll.id===n&&!this.poll.finished){this.ut(e);let t=e.choices;n=t.findIndex(e=>e.votes.total===Math.max(...t.map(e=>e.votes.total))),e=t[n].choice_id||this.poll.st[n],n=this.poll.dt.get(e)[0],e=(n.style.background="#01f593bb",n.style.zIndex="1",n.querySelector("#poll-title"));e.style.display="flex",e.style.gap="3px",e.insertBefore($e(Pe.v,18,18),e.firstChild);n=Array.from(this.poll.dt.values()).map(([e])=>e);if(this.poll.isCollapsed)n.sort((t,n)=>{var e=this.poll.lt.find(e=>this.poll.dt.get(e.choice_id)[0]===t).votes.total;return this.poll.lt.find(e=>this.poll.dt.get(e.choice_id)[0]===n).votes.total-e}),n.forEach((e,t)=>e.style.order=t);else{let o=new Map;n.forEach(e=>o.set(e,e.getBoundingClientRect())),n.sort((t,n)=>{var e=this.poll.lt.find(e=>this.poll.dt.get(e.choice_id)[0]===t).votes.total;return this.poll.lt.find(e=>this.poll.dt.get(e.choice_id)[0]===n).votes.total-e}),n.forEach((e,t)=>{e.style.order=t}),de(this.poll.element),n.forEach(n=>{var e=o.get(n),t=n.getBoundingClientRect(),e=e.top-t.top;Math.abs(e)<1||(n.style.transform=`translateY(${e}px)`,n.style.transition="none",requestAnimationFrame(()=>{n.style.transition="transform 400ms ease",n.style.transform=""}),n.addEventListener("transitionend",function e(t){"transform"===t.propertyName&&(n.style.transition="",n.removeEventListener("transitionend",e))}))})}this.poll.finished=!0}}ot(e){this.poll&&this.poll.id===e&&(clearTimeout(this.poll.ze),this.poll.ct&&this.poll.ct.remove(),this.poll.element.remove(),this.poll=null)}gt(){this.bt();var e=S();let t=this.oe.length;for(;t--;){var n=this.oe[t];if(!(n.message.starts_at>e||e>n.message.ends_at))return this.u&&this.u.id===n.message.id?void 0:void this.xt(n)}}bt(){var e;this.u&&((e=S())<this.u.ce||e>this.u.me?this.wt(this.u.id):P.paused?this.u.yt&&(clearTimeout(this.u.yt),this.u.yt=null):this.u.yt||(this.u.yt=setTimeout(()=>{this.wt(this.u.id)},(this.u.me-e)/z*1e3)))}xt(e){var t=e.message;let n=t.id;var o=t.sender,e=e.pinned_by,i=o.user_id===e.user_id,a=S();if(this.u){if(this.u.id===n)return;this.wt(this.u.id)}o["display-name"]=o.display_name,o.badges=lt(o.badges);let r=Ee(o,o.chat_color,o.badges);var l=t.starts_at,s=t.ends_at,d=s-l;let c=document.createElement("div"),h=(c.className="pin-placeholder",document.createElement("div"));h.className="pin-top-container";var u=document.createElement("div"),p=(u.style="display: flex; align-items: center; gap: 5px; margin: 5px 0 2px 0;",document.createElement("span")),m=(p.style="font-weight: 500; font-size: 0.88rem;",ct(o.badges)),i=(m.style="margin: 0 2px 0 7px;",p.textContent="Pinned by",i&&p.appendChild(m),p.appendChild(document.createTextNode(e.display_name)),u.appendChild($e(Pe.u,18,18,20,20)),u.appendChild(p),document.createElement("div")),m=(i.style="display: flex; gap: 6px; margin: 6px 6px 4px 0px; align-items: center;",$e(Pe.hide,18,18,20,20)),e=(m.setAttribute("class","btn"),document.createElementNS("http://www.w3.org/2000/svg","title"));e.textContent="Hide Pinned message",m.insertBefore(e,m.firstChild),i.appendChild(m);let v=$e(Pe.collapse,18,18,20,20),f=(v.setAttribute("class","btn"),document.createElementNS("http://www.w3.org/2000/svg","title")),g=(f.textContent="Collapse",document.createElementNS("http://www.w3.org/2000/svg","title"));g.textContent="Expand",v.insertBefore(f,v.firstChild),i.appendChild(v),h.appendChild(u),h.appendChild(i);p=Ie(t.content.text,rt(t.content),!1);let b=document.createElement("span");b.appendChild(p);for(var x,e=b,w=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),y=[];w.nextNode();)y.push(w.currentNode);for(x of y){let r=x.nodeValue;if(re.test(r)){re.lastIndex=0;let i=document.createDocumentFragment(),a=0;r.replace(re,(e,t,n)=>{n>a&&i.appendChild(document.createTextNode(r.slice(a,n)));var o=document.createElement("a");return o.textContent=e,o.href=e.startsWith("http")?e:"https://"+e,o.target="_blank",o.rel="noopener noreferrer",i.appendChild(o),a=n+e.length,e}),a<r.length&&i.appendChild(document.createTextNode(r.slice(a))),x.replaceWith(i)}}function M(){c.style.display="none";let e=document.createElement("button");e.className="chat-header-btn btn",e.title="Show Pinned message",e.appendChild($e(Pe.u)),e.onclick=()=>{c.style.display="flex",e.remove(),Le.re=null},Le.re?Le.re.replaceWith(e):$.prepend(e),Le.re=e}function k(){v.innerHTML=$e(Pe.expand,18,18,20,20).innerHTML,b.style="word-break: break-word; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",r.style.display="none",v.onclick=C,v.insertBefore(g,v.firstChild)}function C(){h.style.overflow="visible",b.style="font-size: 1.1rem; word-break: break-word; max-height: 20vh; overflow: auto;",r.style.display="",v.innerHTML=$e(Pe.collapse,18,18,20,20).innerHTML,v.onclick=k,v.insertBefore(f,v.firstChild)}m.onclick=M,this.re&&M(),v.onclick=k,C(),c.appendChild(h),c.appendChild(b),r.style.marginTop="5px",c.appendChild(r),V.innerHTML="",V.appendChild(c);u=P.paused?null:setTimeout(()=>{this.wt(n)},(s-a)/z*1e3);this.u={id:n,ce:l,me:s,duration:d,sender:o,yt:u}}wt(e){this.u&&this.u.id===e&&(this.u=null,V.innerHTML="")}Mt(){var n=S();for(let e=0,t=this.ne.length;e<t;e++){var o=this.ne[e];o.message.starts_at>n||n>o.message.ends_at||this.Y.has(o.message.id)||this.kt(o)}}Ct(){var n,o,i,e=k(),a=M.createdUnix+e;for(let[e,t]of this.Y)t.Pt>a||t.me<a?this.zt(e):(n=t.duration,o=((i=t.me-a)<=0&&this.zt(e),n-i),n=n/z,o=o/z,i=i/z*1e3,t.$t.style.animation="none",de(t.$t),t.$t.style.animation=`widthLeftToRight ${n}s linear both`,t.$t.style.animationDelay=`-${o}s`,t.$t.style.animationPlayState=P.paused?"paused":"running",t.yt&&(clearTimeout(t.yt),t.yt=null),P.paused||(t.yt=setTimeout(()=>{this.zt(e)},i)))}kt(t){t=t.message;let n=t.id;if(!this.Y.has(n)){var o=t.sender,i=S(),a=t.starts_at,r=t.ends_at;if(!(r<i)){var l,s,d=r-a,r=r-i,i=d-r,c=d/z,i=i/z,r=r/z*1e3,h=t.metadata.bitsAmount,u=t.metadata.level,p=1e3<=h?Math.floor(h/1e3)+"K":h.toString(),m=o.display_name.slice(0,2),v=$e(Pe.bits,22,22),f=(v.style.color="white",document.createElement("div")),g=(f.className="pinned-cheer pinned-cheer-colors-level-"+u.toLowerCase(),document.createElement("div")),b=(g.className="pinned-cheer-inner",document.createElement("div")),c=(b.className="sweep",b.style.animation=`widthLeftToRight ${c}s linear both`,b.style.animationDelay=`-${i}s`,b.style.animationPlayState=P.paused?"paused":"running",g.appendChild(b),document.createElement("span")),i=(c.className="pinned-cheer-inner-placeholder",document.createElement("span"));i.style.marginRight="3px",i.textContent=m,c.appendChild(i),c.appendChild(v),c.appendChild(document.createTextNode(""+p)),g.appendChild(c),f.appendChild(g);let e=null;for([l,s]of this.Y)a>s.Pt&&(e=!(e&&s.Pt>e.Pt)&&e||s);e?T.insertBefore(f,e.element):T.appendChild(f);m=rt(t.content),i=Ie(t.content.text,m,!0),v=document.createElement("div"),p=(v.appendChild(i),v.innerHTML),c=(o.badges=lt(o.badges),o["display-name"]=o.display_name,f.onclick=()=>this.At(n),f.title=o["display-name"]+" "+h,P.paused?null:setTimeout(()=>{this.zt(n)},r));this.Y.set(n,{element:f,$t:b,Lt:h,level:u,Pt:a,me:t.ends_at,duration:d,yt:c,It:p,sender:o})}}}zt(e){var t=this.Y.get(e);t&&(t.element.remove(),t.yt&&(clearTimeout(t.yt),t.yt=null),this.Y.delete(e))}At(e){let t=this.Y.get(e);if(!t)return;if(this.te){if(this.te.id===e)return;this.te.close()}let n=document.createElement("div"),o=(n.className="pinned-bits-details pinned-cheer-colors-level-"+t.level.toLowerCase(),n.id=e,(18+24*Math.random()).toFixed(2));var i=["normal","reverse"];let a=i[Math.floor(Math.random()*i.length)],r=-(Math.random()*o);n.style.animation="none",requestAnimationFrame(()=>{n.style.setProperty("animation",`backgroundPosition ${o}s linear ${r}s infinite `+a,"important")});var i=Ee(t.sender,t.sender.chat_color,t.sender.badges),l=document.createElement("div"),s=document.createElement("div");s.style="display: flex; justify-content: space-between; align-items: center; gap: 10px;",s.appendChild(i);let d=document.createElement("span"),c=(d.style="font-size: 0.85rem; font-weight: 700; color: var(--text-color); margin-right: 3px;",s.appendChild(d),Ae(t.duration));function h(){var e=(t.me-S())/z;e<=0?(d.textContent="00:00",clearInterval(u)):(e=Ae(e),d.textContent=e,d.title=e+" / "+c)}h();let u=setInterval(h,1e3);l.appendChild(s),l.style="margin: 3px; display: flex; flex-direction: column; gap: 9px; background: var(--panel-bg); border-radius: 5px; padding: 12px 10px 7px 10px;";i=document.createElement("span"),i.className="chat-text",i.style.maxHeight="20vh",i.style.overflow="auto",i.innerHTML=t.It,l.appendChild(i),n.appendChild(l),s=document.createElement("div"),s.style="margin-left: 7px; gap: 1px; display: flex; align-items: center; vertical-align: middle; margin-bottom: 5px; color: black",s.appendChild($e(Pe.bits,22,22,20,20)),i=document.createElement("span");i.style="font-weight: 700;",i.textContent=t.Lt.toString(),s.appendChild(i),n.appendChild(s),I.appendChild(n);let p=t.element.firstChild,m=(p.dataset.oldBackground=p.style.background,p.style.background="var(--cheer-clicked-bg)",()=>{p.style.background=p.dataset.oldBackground,n.remove(),Le.te=null,t.element.onclick=()=>this.At(e)});n.onclick=e=>{m()},this.te={Xe:n,id:e,close:m},t.element.onclick=()=>m()}Et(){if(Me)for(var[e,t]of this.Y)t.$t.style.animationPlayState="paused",t.yt&&(clearTimeout(t.yt),t.yt=null);this.u&&this.u.yt&&(clearTimeout(this.u.yt),this.u.yt=null),Ce&&this.poll&&this.poll.xe&&(this.poll.xe.style.animationPlayState="paused"),this.p&&this.p.xe&&(this.p.xe.style.animationPlayState="paused")}St(){Me&&this.Ct(),Ce&&this.nt(),this.u&&this.bt(),ke&&this.ge()}Tt(){Me&&(this.Ct(),this.Mt()),this.gt(),Ce&&this.nt(),ke&&this.ge()}Vt(){Me&&this.Ct(),Ce&&this.nt(),ke&&this.ge()}};function Oe(e){J=e;var t=document.createElement("style");t.id="channel-color-style",t.textContent=`.chat-message.monet { border-left-color: ${e} !important; }`,t.parentNode||document.head.appendChild(t)}async function Re(t){try{var n=t.stream(),o=new DecompressionStream("gzip"),i=n.pipeThrough(o),a=await new Response(i).arrayBuffer(),r=new Uint8Array(a),l={};let e=0;for(;e+512<=r.byteLength;){var s=r.slice(e,e+512);if(s.every(e=>0===e))break;var d=s.slice(0,100);let t="";for(let e=0;e<d.length&&0!==d[e];e++)t+=String.fromCharCode(d[e]);var c=String.fromCharCode(s[156]),h=s.slice(124,136);let n="";for(let e=0;e<h.length&&0!==h[e];e++)n+=String.fromCharCode(h[e]);var u=parseInt(n.trim()||"0",8);if(console.log("TAR entry:",t,"type:",c,"size:",u),"0"!==c&&"\0"!==c||t.includes("PaxHeader")){var p=Math.ceil(u/512);e+=512+512*p}else{if(0<u&&(t.endsWith(".json")||t.endsWith("-metadata.json"))){var m=e+512,v=r.slice(m,m+u);try{var f=new TextDecoder("utf-8").decode(v),g=JSON.parse(f);l[t]=g,console.log("Extracted:",t,"size:",E.q(u))}catch(e){console.warn("Failed to parse JSON for",t,":",e)}}var b=Math.ceil(u/512);e+=512+512*b}}var x=y+"-metadata.json",w=y+".json";return(console.log("Available files:",Object.keys(l)),l[x]&&l[w])?(console.log("Successfully extracted both metadata and chat log"),[l[x],l[w]]):(console.warn("Target files not found"),null)}catch(e){return console.error("Failed to parse compressed chat log:",e),null}}function Ne(){R=M.owner,kt(),Mt(),M.accentColor&&Oe(M.accentColor),xe=M.videoOffset||0,B.addEventListener("click",r=>{{if(document.getElementById("games-popup"))return;let o="brightness(40%)",e=zt.We("games-popup","Select Game",r),t=document.createElement("div");function s(e){e.Dt.textContent=Fe(e.Ft-k())+" left"}function d(e){var t;s(e),e.Bt||(e.element.style.backgroundColor="var(--accent-color)",e.Bt=!0,e.Ht.querySelector("svg")||((t=$e(Pe.play,18,18,24,24)).style.cssText=a,e.Ht.appendChild(t)),e.Ot.style.color=e.Dt.style.color=e.Rt.firstChild.style.color="white",e.Nt.style.filter=o)}t.style.cssText=` flex-grow: 1; overflow-y: auto; background-color: var(--panel-bg); padding: 8px; `,e.appendChild(t);let i=!1,l=[],a=` position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; filter: drop-shadow(0 0 3px rgba(0,0,0,0.5)); pointer-events: none; `;for(let n=0,e=M.games.length;n<e;n++){var c=M.games[n][1],h=M.games[n][0],u=document.createElement("div"),p=(u.style="display: flex; align-items: center; padding: 8px 3px; gap: 10px; cursor: pointer; border-bottom: 1px solid var(--panel-border); transition: background ease .1s",`https://static-cdn.jtvnw.net/ttv-boxart/${c.id}-270x360.jpg`),m=`https://static-cdn.jtvnw.net/ttv-boxart/${c.id}_IGDB-270x360.jpg`,v=document.createElement("div"),f=(v.style.cssText=` position: relative; width: 48px; height: 64px; margin-left: 8px; `,new Image),p=(f.style.cssText=` display: block; width: 48px; height: 64px; object-fit: cover; `,v.appendChild(f),[p,m,"https://static-cdn.jtvnw.net/ttv-static/404_boxart-285x380.jpg"]),m=((async(t,n,o)=>{var e=te.get(o);if(e)n.src=e;else for(let e=0;e<t.length;e++){var i=t[e];try{var a=await fetch(i,{method:"GET"});if(console.log(`Checked ${i}: ${a.status}, redirected: `+a.redirected),!a.redirected&&200===a.status)return n.src=i,!te.set(o,i)}catch(e){continue}}})(p,f,c.id),document.createElement("div")),p=(m.style.cssText="display: flex; flex-direction: column; gap: 3px;",document.createElement("span")),c=(p.textContent=c.name,m.appendChild(p),n===e-1),p=c?M.duration-h:M.games[n+1][0]-h,g=c?M.duration+xe:M.games[n+1][0],b=document.createElement("span"),c=(b.style.color="var(--game-name-color)",!i&&(c||h<g)),x=(c&&(i=!0),m.appendChild(b),document.createElement("span"));x.style.cssText="font-size: 0.69rem; font-weight: bold; color: var(--game-name-color);",x.textContent=Ae(h)+" - "+Ae(g),m.appendChild(x),u.appendChild(v),u.appendChild(m),t.appendChild(u),u.onmouseenter=()=>{var e,t=n;(t=l[t]).Bt||(t.Dt.style.color="var(--theme-opposite-color)",t.Ot.style.color="var(--theme-opposite-color)",t.Nt.style.filter=o,t.element.style.backgroundColor="var(--btn-hover-bg)",(e=$e(Pe.play,18,18,24,24)).style.cssText=a,t.Ht.appendChild(e))},u.onmouseleave=()=>{var e=n;!(e=l[e]).Bt&&(e.Dt.style.color="var(--game-name-color)",e.Ot.style.color="var(--game-name-color)",e.Nt.style.filter="",e.element.style.backgroundColor="transparent",e=e.Ht.querySelector("svg"))&&e.remove()},u.onclick=()=>{var e=n;e=l[e],P.currentTime=e.offset-xe,w()},l.push({element:u,Rt:m,Dt:b,Nt:f,Ot:x,Ht:v,offset:h,duration:p,Ft:g,Bt:!1}),c&&d(l[n])}function w(){let n=!1;var o,i=k();for(let e=0,t=M.games.length;e<t;e++){var a=l[e],r=e===t-1;!n&&(r||i<a.Ft)?(n=!0,(a.Bt?s:d)(a)):a.Bt?(r=void 0,(o=a).element.style.backgroundColor="transparent",o.Bt=!1,(r=o.Ht.querySelector("svg"))&&r.remove(),o.Dt.textContent=Fe(o.duration),o.Ot.style.color=o.Dt.style.color="var(--game-name-color)",o.Rt.firstChild.style.color="var(--text-color)",o.Nt.style.filter=""):a.Dt.textContent=Fe(a.duration)}}let n=setInterval(w,1e3);e.addEventListener("remove",()=>{clearInterval(n)}),w(),e.Ye()}}),F.addEventListener("click",t=>{var n="titles-popup";if(!document.getElementById(n)){var n=zt.We(n,"Select Title",t),o=document.createElement("div");o.style.cssText=` flex-grow: 1; overflow-y: auto; background-color: var(--panel-bg); padding: 8px; gap: 5px; `,n.appendChild(o);let i=[];var a=k(),r=3600<=M.titles.at(-1)[0];for(let t=0,n=M.titles.length;t<n;t++){var[l,s]=M.titles[t],d=document.createElement("div"),c=t===n-1?M.duration+xe:M.titles[t+1][0],h=l<=a&&a<c;d.style="padding: 8px 3px; cursor: pointer; border-bottom: 1px solid var(--panel-border); transition: background .1s",d.textContent=`[${Ae(l,r)}] `+s,o.appendChild(d);let e={element:d,offset:l,Ft:c,Bt:!1,title:s};i.push(e),((i,a,r)=>{i&&(i.addEventListener("mouseenter",()=>{if(!r||r())for(var[e,t]of Object.entries(a)){var n="hoverOriginal"+e,o="hoverExpected"+e;i.dataset[n]=i.style[e],i.style[e]=t,i.dataset[o]=i.style[e]}}),i.addEventListener("mouseleave",()=>{for(var e of Object.keys(a)){var t="hoverOriginal"+e,n="hoverExpected"+e;void 0!==i.dataset[t]&&(i.style[e]===i.dataset[n]&&(i.style[e]=i.dataset[t]),delete i.dataset[t],delete i.dataset[n])}}))})(d,{background:"var(--hover-color)"},()=>!e.Bt),d.onclick=()=>{u(e),P.currentTime=e.offset,p()},h&&u(e)}p();let e=setInterval(p,1e3);function u(e){e.element.style.fontWeight="bold",e.element.style.background="var(--accent-color)",e.element.style.color="white",e.Bt=!0}function p(){var n=k();for(let e=0,t=i.length;e<t;e++){var o=i[e];n>=o.offset&&n<o.Ft?o.Bt||u(o):o.Bt&&((o=o).element.style.fontWeight="normal",o.element.style.background="transparent",o.element.style.color="var(--theme-opposite-color)",o.Bt=!1)}}n.addEventListener("remove",()=>{clearInterval(e)}),n.Ye()}}),F.addEventListener("mouseout",()=>{clearInterval(t),e&&(e.remove(),e=null)});let e=null,t=null;F.addEventListener("mouseover",()=>{(e=document.createElement("span")).textContent=se(S()),F.appendChild(e),e.style="font-size: 0.85rem; font-weight: 500; margin-left: 10px;",t=setInterval(()=>{e.textContent=se(S())},1e3)})}function je(){N=!0,u=h.length,Le.de(),Le.Tt(),xt(),document.getElementById("chatlog-btn").addEventListener("click",At),console.log("Chat loaded with",u,"entries")}async function _e(){if(!N){console.log("Looking for cached chat for stream:",y);var t=async()=>{console.log("Falling back to uncompressed chat log...");var e=fetch(d).then(e=>e.json()).then(e=>(M=e,Ne(),e)),t=fetch(s).then(e=>e.json()).then(e=>(h=e,je(),e));[M,h]=await Promise.all([e,t]);try{var n=await(async e=>{var n,o,i=[],a=new TextEncoder;for([n,o]of Object.entries(e)){var r=a.encode(JSON.stringify(o)),l=r.length,s=new Uint8Array(512),d=a.encode(n),d=(s.set(d.slice(0,100),0),s.set(a.encode("0000644\0"),100),s.set(a.encode("0000000\0"),108),s.set(a.encode("0000000\0"),116),l.toString(8).padStart(11,"0")+"\0"),d=(s.set(a.encode(d),124),Math.floor(Date.now()/1e3).toString(8).padStart(11,"0")+"\0");s.set(a.encode(d),136),s.set(a.encode(" "),148),s[156]=48;let t=0;for(let e=0;e<512;e++)t+=s[e];d=t.toString(8).padStart(6,"0")+"\0 ",d=(s.set(a.encode(d),148),i.push(s),i.push(r),512-l%512);d<512&&i.push(new Uint8Array(d))}i.push(new Uint8Array(1024));var t,ll=i.reduce((e,t)=>e+t.length,0),c=new Uint8Array(ll);let h=0;for(t of i)c.set(t,h),h+=t.length;return e=new Blob([c]).stream().pipeThrough(new CompressionStream("gzip")),new Response(e).blob()})({[y+"-metadata.json"]:M,[y+".json"]:h});await He.set(y,n),console.log("Chat compressed and cached in IndexedDB for future use")}catch(e){console.warn("Failed to compress and cache chat:",e)}},e=await He.get(y);if(e instanceof Blob)[M,h]=await Re(e),console.log("Chat loaded from IndexedDB cache"),Ne(),je();else if(w){console.log("No cached chat found, trying compressed chat log first...");try{var n,o,i=await fetch(w);200===i.status&&(o=await Re(n=await i.blob()))instanceof Array?([M,h]=o,await He.set(y,n),console.log("Chat cached in IndexedDB for future use")):await t()}catch(e){console.warn("Failed to fetch compressed chat log:",e),await t()}Array.isArray(h)||console.error("Failed to load chat log from any source")}else await t()}}let Ue=new class{constructor(){this.jt=!1,this._t=!1,this.Ut=0,this.Gt=1e3,this.qt=50,this.Jt=null,this.hits=[]}async fetch(o){if(!this.jt&&!this._t){this.jt=!0;let e=0,t=(e=this.Ut%this.qt==0?this.Ut/this.qt:Math.floor(this.Ut/this.qt)+1,console.log(e),{page_type:"account_details",page_target:"@sputchik",page_elements:'["uploads"]',filter_map:`{"creator":{"${r}":"inc"}}`,hits_per_page:o,page:e+1,sort:"date:desc",aggregations:"false"}),n=new URL("https://archive.org/services/search/beta/page_production/");Object.keys(t).forEach(e=>n.searchParams.append(e,t[e]));o=await(await fetch(n)).json(),o=(this.Jt||(this.Jt=o.response.body.page_elements.uploads.hits.total),o.response.body.page_elements.uploads.hits.hits);return this.hits.push(...o),this.jt=!1,this.Ut+=o.length,this.Ut>=this.Jt&&(this._t=!0),o}}async Zt(i,e=100){let a=null;var t=n=>{for(let e=0,t=n.length;e<t;e++){var o=n[e];if(o.fields.identifier==i)return a;a=o}};if(this.hits){var n=t(this.hits);if(n)return n}for(;;){var o=await this.fetch(e);if(console.log(o),!o||!o.length)return;o=t(o);if(o)return{id:o.fields.identifier,title:o.fields.title,date:o.fields.date}}}};function Ge(e){return`https://static-cdn.jtvnw.net/emoticons/v2/${e}/default/dark/${g}.0`}function qe(t){if(t&&t.length){let e=t.length;for(;e--;)(e=>{var t;ne.has(e)||(ne.add(e),(t=new Image).src=Ge(e),t.onerror=()=>{console.warn("Failed to load emote:",e),ne.delete(e)})})(t[e].id)}}function Je(t){if(t&&t.length){let e=t.length;for(;e--;){var n=t[e];(e=>{var t,n;oe.has(e)||((t=Y.get(e)||x.get(e))?((n=new Image).src=t[W],n.onerror=()=>{console.warn("Failed to load badge:",e)},n.onload=()=>{oe.add(e)}):console.warn("Unknown badge ID:",e))})(""+n.name+n.value)}}}function Ze(){if(u){var t=h[l].offset+Q;let e=l;for(;e<u&&h[e].offset<t;){var n=h[e];qe(n.data.emotes),Je(n.data.badges),n.data.user&&!n.data.color&&(n=n.data.user.login,ie.has(n)||dt(n)),e++}}}function Ke(e,t,n,o,i){let a={PREFIX:e.toLowerCase(),BACKGROUND:t,ANIMATION:n?"animated":"static",TIER:o,SCALE:i,EXTENSION:n?"gif":"png"};return j.replace(/\b(PREFIX|BACKGROUND|ANIMATION|TIER|SCALE|EXTENSION)\b/g,e=>a[e])}function Qe(i=null){if(null===j)console.warn("Bits template URL not set");else{let n=0,o=0;for(var[,e]of U.entries())n+=e.length;i&&i(o,n);for(var[a,r]of U.entries()){let t=r.length;for(;t--;){var l=r[t];let e=Ke(a,"dark",!0,l,b);l=new Image;l.onload=()=>{o++,i&&i(o,n)},l.onerror=()=>{console.warn("Failed to preload bits image:",e),o++,i&&i(o,n)},l.src=e}}}}function We(e=null){var n,t=Array.from(x.values()),o=Array.from(Y.values());let i=t.length+o.length,a=0,r=(e&&e(a,i),()=>{a++,e&&e(a,i)});for(n of[t,o]){let t=n.length;for(;t--;){var l=n[t];let e=""+l.setID+l.version;var s=new Image;s.onload=r,s.onerror=()=>{console.warn("Failed to preload badge:",e),r()},s.src=l[W]}}}function Xe(){var t=new Set;let e=h.length;for(;e--;){var n=h[e].data.emotes;if(n){let e=n.length;for(;e--;)t.add(n[e].id)}}return t}function Ye(t=null){var n=Xe();let o=n.size,i=0;t&&t(i,o);for(let e of n){var a=new Image;a.onload=()=>{i++,t&&t(i,o)},a.onerror=()=>{console.warn("Failed to preload emote:",e),i++,t&&t(i,o)},a.src=Ge(e)}}function et(t=null){let e,n,o=0,i=0,a=0,r=0;var l,s;e=Xe().size,n=x.size+Y.size;for([l,s]of U.entries())o+=s.length;let d=e+n+o,c=()=>{var e=i+a+r;t&&t(e,d)};Ye((e,t)=>{i=e,c()}),We((e,t)=>{a=e,c()}),Qe((e,t)=>{r=e,c()})}function tt(n,o,i,a){let r=null,l=new Intl.NumberFormat,s=e=>{r=r||e;var e=Math.min((e-r)/a,1),t=Math.floor(e*(i-o)+o);n.textContent=l.format(t),e<1&&window.requestAnimationFrame(s)};window.requestAnimationFrame(s)}let nt={Kt:e=>e,Qt:e=>e*e,Wt:e=>e*(2-e),Xt:e=>e<.5?2*e*e:(4-2*e)*e-1,Yt:e=>e*e*e,Ze:e=>{e-=1;return e*e*e+1},en:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2};function ot(e,t=2){var n,o;return 0===e?"0":(o=e<0?"-":"",(n=Math.abs(e))<1e3?Math.round(e).toString():1e12<=n?o+(n/1e12).toFixed(t)+"T":1e9<=n?o+(n/1e9).toFixed(t)+"B":1e6<=n?o+(n/1e6).toFixed(t)+"M":o+(n/1e3).toFixed(t)+"K")}function it(n,o,i,a,r=2,l=nt.Ze){let s=null,d=e=>{null===s&&(s=e);var e=Math.min((e-s)/a,1),t=l(e);n.textContent=ot(o+(i-o)*t,r),e<1&&window.requestAnimationFrame(d)};window.requestAnimationFrame(d)}function at(e,t,n){e.querySelector(t).addEventListener("click",function(){let r=this;var e;r.dataset.originalColor=r.style.color||"",r.style.color="#FFFFFF",(e=r).disabled=!0,e.dataset.originalText=e.textContent,e.dataset.originalBackground=e.style.backgroundColor||"",n((e,t)=>{var n,o,i,a;n=r,a=e,i=0<(o=t)?Math.round(a/o*100):0,n.textContent=a+`/${o} (${i}%)`,n.style.background=`linear-gradient(to right, var(--accent-color, #9147ff) ${i}%, var(--panel-border) ${i}%)`,t<=e&&((a=r).disabled=!1,a.style.backgroundImage="",a.textContent=a.dataset.originalText,a.style.backgroundColor=a.dataset.originalBackground||"var(--panel-border)",a.style.color=a.dataset.originalColor||"var(--text-color)")})})}function rt(e){var n=new Map;let o=0;var t=e.text,i=e.fragments,a=st(t);for(let e=0,t=i.length;e<t;e++){var r=i[e],l=o;if(o+=r.text.length,r.emoticon){var s=r.emoticon.emoticonID;let e;n.has(s)?e=n.get(s):(e={id:s,len:r.text.length,pos:[]},n.set(s,e)),e.pos.push(a[l])}}return Array.from(n.values())}function lt(t){if(!t||!t.length)return[];if(void 0!==t[0].name)return t;var n=t.length,o=new Array(n);for(let e=0;e<n;e++){var i=t[e];o[e]={name:i.id,value:i.version}}return o}function st(e){var t,n=[0];let o=0;for(t of e)o+=t.length,n.push(o);return n}function Ie(o,e,t=!1){if(!(e&&e.length||t))return(a=document.createDocumentFragment()).textContent=o,a;var n,i=[];if(e){let n=st(o);i.push(...e.flatMap(t=>t.pos.map(e=>({tn:!1,start:n[e],end:n[e+t.len],id:t.id}))))}if(t&&q)for(q.lastIndex=0;null!==(n=q.exec(o));)i.push({tn:!0,start:n.index,end:n.index+n[0].length,nn:n[1],Lt:parseInt(n[2],10)});i.sort((e,t)=>e.start-t.start);var a,r=document.createDocumentFragment();let l=0;for(let e=0,t=i.length;e<t;e++){var s=i[e],d=(s.start>l&&(d=o.substring(l,s.start),r.appendChild(document.createTextNode(d))),document.createElement("img"));if(d.onerror=function(){this.replaceWith(document.createTextNode(this.alt))},s.tn){var c=U.get(s.nn.toLowerCase());let t=1;if(c){let e=c.length;for(;e--;)if(s.Lt>=c[e]){t=c[e];break}}var h=document.createElement("span"),u=(h.className="bits-container",h.style="display: inline-flex; align-items: center; vertical-align: middle; gap: 4px; margin-left: 2px; margin-right: 2px;",d.src=Ke(s.nn,"dark",!0,t,b),d.title=d.alt=""+s.nn+s.Lt,d.style="height: 1.55rem; width: auto; vertical-align: middle;",document.createElement("span"));u.textContent=s.Lt.toString(),u.style=`font-weight: bold; color: ${G.get(t)};`,h.appendChild(d),h.appendChild(u),r.appendChild(h)}else d.src=Ge(s.id),d.title=d.alt=o.substring(s.start,s.end),d.style.cssText="height: 1.55rem; width: auto; vertical-align: middle;",r.appendChild(d);l=s.end}return l<o.length&&(a=o.substring(l),r.appendChild(document.createTextNode(a))),r}function dt(e){var t=e.toString().split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0),t=Math.abs(t)%ae.length,t=ae[t];return ie.set(e,t),t}function ct(e){var t,n=document.createElement("span");for(t of e){var o,i=""+t.name+t.value,a=Y.get(i)||x.get(i);a?((o=document.createElement("img")).src=a[W],o.style="height: 1.0rem; width: auto; vertical-align: middle; margin-right: 4px;",o.title=o.alt=a.title,n.appendChild(o)):console.warn("Badge not found: "+i)}return n}function Ee(t,e,n=null){var o=document.createElement("span"),i=(o.className="chat-username",t.login||t["display-name"]),e=e||(e=i,ie.get(e))||dt(e);return o.style=`color: ${e}; cursor: pointer;`,o.textContent=t["display-name"]||i,o.onclick=e=>$t(t,e),X&&n&&n.length?(e=document.createElement("span"),i=ct(n),e.appendChild(i),e.appendChild(o),o.style.marginLeft="2px",e):o}function ht(e,t,n){var o=document.createElement("span"),e=(o.appendChild(Ee(e,t,n)),document.createElement("span"));return e.className="chat-text",e.textContent=": ",e.appendChild(Ie(msgData.text,msgData.emotes)),e.style.marginTop="4px",o.appendChild(e),o}function ut(t,e=!1){var F,B,H,O=t.type,o=t.data,i=document.createElement("div");i.className="chat-message "+O,i.id=o.id||0,(we||e)&&((e=document.createElement("span")).className="timestamp",e.textContent=Ae(t.offset-xe),i.appendChild(e));let a,r;try{switch(O){case"msg":case void 0:r=Ee(o.user,o.color,o.badges);var R,n,l,s,N,d,j,_,c,U,G,h,u,q,p=document.createElement("span");if(p.className="chat-text",p.textContent=": ","reply"===(a=o["msg-id"]))return(R=$e(Pe.reply,18,18,20,20)).style.color="var(--reply-color)",(n=document.createElement("div")).style="display: flex; gap: 5px; margin-bottom: 2px; align-items: center; word-break: break-word;",n.appendChild(R),s=(l=o.reply).parent,j=s?(N=s["msg-body"],d=s["display-name"],s["msg-id"]):(N=l["parent-msg-body"],d=l["parent-display-name"],l["parent-msg-id"]),_=`Replying to @${d}: `+N,(c=document.createElement("a")).onclick=e=>{e.preventDefault();let t=be.querySelector(`.chat-message[id="${j}"]`);var n,o;t&&(e=be,o=t.offsetTop-e.offsetTop,n=t.offsetHeight,o=Math.max(0,Math.min(e.scrollHeight-e.clientHeight,o-(e.clientHeight/2-n/2))),1<Math.abs(e.scrollTop-o)&&e.scrollTo({top:o,behavior:"instant"}),t.style.backgroundColor="rgba(255,255,0,0.3)",setTimeout(()=>t.style.backgroundColor="",250))},c.textContent=_,c.style="color: var(--reply-color);",n.appendChild(c),i.appendChild(n),U=Ie(o.text,o.emotes),p.appendChild(U),G=`@${d} `,(h=p.childNodes[1])&&h.nodeType===Node.TEXT_NODE&&h.nodeValue.startsWith(G)&&(h.nodeValue=h.nodeValue.slice(G.length)),i.appendChild(r),i.appendChild(p),i;let e=Ie(o.text,o.emotes);if(o["first-msg"]&&ye)return u=document.createElement("div"),u.style="padding: 6px 5px; border-radius: 4px; border: 1px solid hotpink;",we&&(u.style.marginTop="4px"),(q=document.createElement("span")).style="margin: 0 8px 0 3px; background: var(--game-name-color); border-radius: 4px; padding: 3px 8px; color: var(--bg-color); font-weight: bold; font-size: 0.8rem; word-break: break-all;",q.appendChild(document.createTextNode("1ST TIME CHAT")),u.appendChild(q),u.appendChild(r),p.appendChild(e),u.appendChild(p),i.appendChild(u),i;if("highlighted-message"===a&&e&&ye){var m,v,J,f,Z=document.createElement("span"),K=(Z.style="background-color: var(--accent-color); padding: 4px; border-radius: 4px;",Z.appendChild(e),(e=Z).style.color="#FFFFFF",i.classList.add("misc"),De?De.automaticRewards.get("SEND_HIGHLIGHTED_MESSAGE").defaultCost:null);if(K)return(m=document.createElement("div")).style="display: flex; flex-direction: column; gap: 6px;",(v=document.createElement("div")).style="display: flex; align-items: center; color: var(--game-name-color);",v.appendChild(document.createTextNode("Reedemed Highlight My Message")),B=F=20,(J=ze&&ze.url4x?((H=new Image).src=ze.url4x,H):$e(Pe.m,F,B)).style="height: 20px; width: auto; vertical-align: middle; margin-left: 3px;",v.appendChild(J),v.appendChild(document.createTextNode(K)),m.appendChild(v),f=document.createElement("div"),p.appendChild(e),f.appendChild(r),f.appendChild(p),m.appendChild(f),i.appendChild(m),i}i.appendChild(r),p.appendChild(e),i.appendChild(p);break;case"monet":if("bits"===(a=o["msg-id"])){i.className="chat-message msg";var g=document.createElement("span"),Q=(g.className="chat-text",g.textContent=": ",Ie(o.text,o.emotes,!0));g.appendChild(Q),i.appendChild(Ee(o.user,o.color,o.badges)),i.appendChild(g)}else{if(!Te)return;r=Ee(o.user,"var(--sub-color)",null);var b,W,x,X,Y=o.user["display-name"]||o.user.login,w=document.createElement("span");w.className="chat-text",w.style="font-size: 0.9rem; line-height: 1.2rem;";let t=o["system-msg"];t.startsWith(Y)&&(t=t.substring(Y.length).trimStart());let n;switch(a){case"resub":case"sub":var ee,te,ne,y,oe,M=o["msg-params"],k=document.createElement("div"),C=(k.style="display: flex; flex-direction: column; gap: 1px;",document.createElement("div")),ie="Prime"===M["sub-plan"],ae=$e(ie?Pe.l:Pe.sub,22,22),P=(ae.style.color=ie?"var(--sub-color)":"var(--game-name-color)",document.createElement("span")),re=(P.style="font-size: 0.9rem; margin: 0 0 0 29px;",document.createElement("span")),le=(re.style="font-weight: bold;",re.textContent="Subscribed",P.appendChild(re),P.appendChild(document.createTextNode(ie?" with Prime":" at Tier "+M["sub-plan"].toString()[0])),M["cumulative-months"]);return le&&1<le&&(P.appendChild(document.createTextNode(". They've been subscribed for ")),(ee=document.createElement("span")).style="font-weight: bold;",ee.textContent=""+le,P.appendChild(ee),P.appendChild(document.createTextNode(" months")),te=M["streak-months"])&&1<te&&(P.appendChild(document.createTextNode(", Currently on a ")),(ne=document.createElement("span")).style="font-weight: bold;",ne.textContent=""+te,P.appendChild(ne),P.appendChild(document.createTextNode(" months streak!"))),C.style="display: flex; align-items: center; gap: 5px; margin-top: 2px; margin-left: 2px;",C.appendChild(ae),C.appendChild(r),k.appendChild(C),k.appendChild(P),i.appendChild(k),o.text&&((n=document.createElement("div")).style="margin-top: 4px; margin-left: 4px;",(y=document.createElement("span")).className="chat-text",y.textContent=": ",oe=Ie(o.text,o.emotes),y.appendChild(oe),n.appendChild(Ee(o.user,o.color,o.badges)),n.appendChild(y),i.appendChild(n)),i;case"submysterygift":case"subgift":(n=document.createElement("div")).style="display: flex; align-items: center; gap: 4px; margin-top: 2px; padding: 4px;",r.style.fontWeight="bold",w.textContent=" "+t,w.style.fontSize="0.9rem";var se,z=document.createElement("div");let e;return"submysterygift"===a?((e=document.createElement("img")).src=Ve.src,e.style="height: 45px; width: auto;",r.style.color="var(--theme-opposite-color)",w.style.color="var(--game-name-color)",z.style="display: flex; flex-direction: column; gap: 2px;",n.style.gap="6px"):((e=$e(Pe.i,21,21)).style.color="var(--text-color)",r.style.color="var(--text-color)",z.style.marginLeft="4px",se=t.substring(0,t.lastIndexOf(" "))+" ",w.textContent="",w.appendChild(document.createTextNode(se)),w.style.marginLeft="4px",w.appendChild(Ee({id:o["msg-params"]["recipient-id"],"display-name":o["msg-params"]["recipient-display-name"]},"var(--theme-opposite-color)"))),z.appendChild(r),z.appendChild(w),n.appendChild(e),n.appendChild(z),i.appendChild(n),i;default:w.textContent=" "+t,i.appendChild(r),i.appendChild(w)}o.text&&((b=document.createElement("div")).style.marginTop="6px",W=Ee(o.user,o.color,o.badges),(x=document.createElement("span")).className="chat-text",x.textContent=": ",X=Ie(o.text,o.emotes),x.appendChild(X),b.appendChild(W),b.appendChild(x),i.appendChild(b))}break;case"inraid":r=Ee(o.user,"#ff8b38",o.badges);var de=document.createElement("span");de.className="chat-text",de.textContent=` is raiding with a party of ${o["msg-params"].viewerCount} viewers`,i.appendChild(r),i.appendChild(de);break;case"mod":if(!Se)return;var $=document.createElement("span");if($.className="chat-text","ban"===o["msg-id"])r=Ee(o["target-user"],"var(--text-color)",null),i.appendChild(r),$.style.color="var(--text-color)",$.textContent=" was banned",o["ban-duration"]&&($.textContent+=" for "+Fe(o["ban-duration"]));else if("clear-msg"===o["msg-id"]){let t=be.querySelector(`.chat-message[id="${o["target-msg-id"]}"]`);if(!t)return;var ce=t.querySelector(".chat-text"),A=(ce&&(ce.style.opacity="0.7"),document.createElement("a"));A.href="#"+t.id,A.textContent="message deleted",A.style="cursor: pointer; margin-left: 5px; color: #999;",A.addEventListener("click",e=>{e.preventDefault(),t.scrollIntoView(),t.style.backgroundColor="rgba(255,255,0,0.3)",setTimeout(()=>t.style.backgroundColor="",200)}),$.appendChild(A)}else{if("announcement"===o["msg-id"]){r=Ee(o.user,o.color,o.badges);var L,I=document.createElement("span"),he=(I.className="chat-text",I.textContent=": ",a=o["msg-id"],Ie(o.text,o.emotes));ye&&((L=document.createElement("span")).style="display: flex; align-items: center; font-size: 0.95rem; font-weight: bold; gap: 6px; margin-bottom: 8px;",L.appendChild($e(Pe.h,20,20,20,20)),L.appendChild(document.createTextNode("Announcement")),i.appendChild(L),i.classList.add("chat-msg-bordered","announcement-line","announcement-line--"+o["msg-params"].color.toLowerCase())),i.appendChild(r),I.appendChild(he),i.appendChild(I),i.classList.remove("mod");break}$.textContent="Moderation action"}i.appendChild($);break;case"poll":if(!Ce)return;switch(o.type){case"POLL_CREATE":Le.it(o.data.poll);break;case"POLL_UPDATE":Le.ut(o.data.poll);break;case"POLL_COMPLETE":Le.rt(o.data.poll);break;case"POLL_ARCHIVE":Le.ot(o.data.poll.poll_id)}return;case"prediction":if(!ke)return;if("event-created"===o.type)Le.Me(o.data.event);else if("event-updated"===o.type){var ue=o.data.event;switch(ue.status){case"RESOLVE_PENDING":case"RESOLVED":Le.ye(ue);break;case"ACTIVE":Le.et(o.data.event);break;case"CANCELLED":Le.be(ue.id)}}return;case"pin":if("pin-message"!==o.type)return;switch(o.data.message.type){case"CHEER":if(!Me)return;Le.kt(o.data);break;case"MOD":Le.xt(o.data);case"UNPIN":var E=o.data.id;Le.u&&Le.u.id===E?Le.wt(E):Le.Y.has(E)&&Le.zt(E)}return;default:if("viewermilestone"===(a=o["msg-id"])){var pe=void 0!==o.text;if(!ye)return pe?(i.appendChild(ht(o.user,o.color,o.badges)),i):void 0;var S=document.createElement("div"),T=(S.style="display: flex; flex-direction: column; gap: 1px;",document.createElement("div")),me=(T.style="display: flex; align-items: center; gap: 5px;",$e(Pe.k,24,24,20,20)),ve=(me.style.color="var(--theme-opposite-color)",Ee(o.user,"var(--sub-color)",null)),V=document.createElement("span");V.style="display: inline-flex; align-items: center; color: var(--game-name-color);",V.appendChild(document.createTextNode("+ "));let e;ze?((e=new Image).src=ze.url4x,e.style="height: 1.2rem; width: auto; vertical-align: middle;"):e=$e(Pe.m,20,20),V.appendChild(e),V.appendChild(document.createTextNode(o["msg-params"].copoReward)),T.appendChild(me),T.appendChild(ve),T.appendChild(V),S.appendChild(T);var fe,D=document.createElement("span"),ge=(D.style.fontSize="0.9rem",D.style.marginLeft="30px",document.createElement("span"));ge.style="font-weight: bold;",ge.textContent="Watch Streak reached!",D.appendChild(ge),D.appendChild(document.createTextNode(` ${o.user["display-name"]} is currently on a ${o["msg-params"].value}-stream streak!`)),S.appendChild(D),pe&&((fe=ht(o.user,o.color,o.badges)).style.margin="3px 0 0 5px",S.appendChild(fe)),i.appendChild(S)}}return i}catch(e){console.error("Error rendering chat message:",e,t)}}function pt(){if(u){var e=k();let t=l;for(;t<u&&h[t].offset<=e;)t++;if(t>l){var n=document.createDocumentFragment();for(let e=l;e<t;e++){var o=ut(h[e]);o&&n.appendChild(o)}var i,a=be.scrollHeight-be.clientHeight<=be.scrollTop+100,r=(be.appendChild(n),l=t,be.children);r.length>m&&((i=document.createRange()).setStart(be,0),i.setEnd(be,r.length-m),i.deleteContents()),(a?It:Tt)()}}}function mt(){l=l>=m?l-m:0,be.innerHTML="",pt()}function vt(){let n=document.querySelector(".container"),o=document.getElementById("resize-handle"),i,a,r,l=!1;var e;function t(e){l=!0;var t=e.touches[0];i=t.clientX,a=C.offsetWidth,r=n.offsetWidth,document.addEventListener("touchmove",d,{passive:!1}),document.addEventListener("touchend",h),document.addEventListener("touchcancel",h),o.classList.add("active"),document.body.style.userSelect="none",e.preventDefault()}function s(e){l&&(e=e.clientX-i,e=Math.max(200,Math.min(r-200,a-e)),C.style.width=e+"px")}function d(e){var t;l&&(t=e.touches[0].clientX-i,t=Math.max(200,Math.min(r-200,a-t)),C.style.width=t+"px",e.preventDefault())}function c(){l&&(l=!1,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",c),o.classList.remove("active"),document.body.style.userSelect="",H)&&It()}function h(){l&&(l=!1,document.removeEventListener("touchmove",d),document.removeEventListener("touchend",h),document.removeEventListener("touchcancel",h),o.classList.remove("active"),document.body.style.userSelect="",It())}H&&((e=document.createElement("div")).style.cssText=` position: absolute; top: -15px; bottom: -15px; left: -15px; right: -15px; z-index: 1; touch-action: none; `,o.style.position="relative",o.appendChild(e),e.addEventListener("touchstart",t,{passive:!1})),o.addEventListener("mousedown",function(e){l=!0,i=e.clientX,a=C.offsetWidth,r=n.offsetWidth,document.addEventListener("mousemove",s),document.addEventListener("mouseup",c),o.classList.add("active"),document.body.style.userSelect="none",e.preventDefault()}),o.addEventListener("touchstart",t,{passive:!1})}function k(){return xe+P.currentTime}function S(){return M.createdUnix+k()}function ft(){var e,t;P.paused||(t=(t=>{let n=1/0;var o=M.titles,i=M.games;if(o&&o.length)for(let e=0;e<o.length;e++){var[a,,]=o[e];t<a&&a<n&&(n=a)}if(i&&i.length)for(let e=0;e<i.length;e++){var[r,,]=i[e];t<r&&r<n&&(n=r)}return n===1/0?null:n})(e=k()),a.t&&(clearTimeout(a.t),a.t=null),t&&(t=1e3*(t-e)/z,a.t=setTimeout(()=>{kt(),setTimeout(ft,200)},100+t)))}function gt(){if(!P.paused){var n,o=k(),i=(i=o,(n=M.viewers)&&n.length?0<=(i=yt(i))&&i<n.length-1?[i+1,n[i+1][0]]:[0,n[0][0]]:null);if(i){let[e,t]=i;a.viewers&&(clearTimeout(a.viewers),a.viewers=null),t&&(n=1e3*(t-o)/z,a.viewers=setTimeout(()=>{Mt(e),setTimeout(gt,100)},100+n))}}}function bt(){P.paused||(a.o&&(clearTimeout(a.o),a.o=null),a.o=setTimeout(()=>{Ze(),setTimeout(bt,200)},800*Q))}function xt(){ft(),gt(),bt()}function wt(){for(var e in a)a[e]&&(clearTimeout(a[e]),a[e]=null)}function yt(n){var o=M.viewers;if(!o.length||n<o[0][0])return-1;var i,a,e=Math.floor(n/30),r=Math.max(0,e-3),l=Math.min(o.length-1,e+3);let s=-1,d=-1;for(let e=r;e<=l;e++){var[t,,]=o[e];t<=n&&t>d&&(d=t,s=e)}if(-1===s)for(let e=0,t=o.length;e<t;e++)e>=r&&e<=l||([i,a]=o[e],i<=n&&i>d&&(d=i,s=e));return s}function Mt(e=null){e=e||yt(k()),e=0<=e?M.viewers[e][1]:0;L.textContent=e.toLocaleString()}function kt(){var n=Math.ceil(k()),o=M.titles,i=M.games;if(o&&o.length){let t=o[0][1];for(let e=o.length-1;0<=e;e--){var[a,r]=o[e];if(a<=n){t=r;break}}F.textContent=t,document.title=t+" - "+R.displayName}if(i&&i.length){let t=i[0][1]||"";for(let e=i.length-1;0<=e;e--){var[l,s]=i[e];if(l<=n){t="object"==typeof s?s.name:s;break}}B.textContent=t}}function Ct(e){document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),document.getElementById("moon-icon").style.display="light"===e?"none":"block",document.getElementById("sun-icon").style.display="light"===e?"block":"none"}function Pt(){Ct("light"===(localStorage.getItem("theme")||"light")?"dark":"light")}let zt=new class{constructor(){this.on=new Map,this.an="×",this.rn=null}ln(e){var t,n=this.on.get(e);this.rn&&this.rn!==e?(n.style.zIndex=parseInt(getComputedStyle(n).zIndex)+1,(t=this.on.get(this.rn))&&(t.style.zIndex=parseInt(getComputedStyle(t).zIndex)-1)):this.rn||(n.style.zIndex=parseInt(getComputedStyle(n).zIndex)+1),this.rn=e}We(t,e,n,o={}){let i=document.createElement("div"),a=(i.className="popout",i.id=t,null);return e&&((a=document.createElement("div")).className="popout-header",a.textContent=e,e=this.Ae(i),a.appendChild(e),i.appendChild(a)),i.Ye=()=>{Object.assign(i.style,o),document.body.appendChild(i),a&&this.sn(a,i,t,{dn:!0});var e=this.cn(i,n);i.style.left=e.x+"px",i.style.top=e.y+"px",this.ln(t)},this.on.set(t,i),i}hn(e){var t=this.on.get(e);t&&(t.remove(),this.on.delete(e))}Ae(e){var t=document.createElement("button");return t.textContent=this.an,t.className="btn popout-close-btn",t.onmousedown=e=>e.stopPropagation(),t.ontouchstart=e=>e.stopPropagation(),t.onclick=()=>e.remove(),t.ontouchend=()=>e.remove(),t}sn(e,i,t,n={}){let{dn:a=!1}=n,r,l,o=(e,t)=>{r=e-i.offsetLeft,l=t-i.offsetTop,document.addEventListener("mousemove",s),document.addEventListener("mouseup",d),document.addEventListener("touchmove",s,{passive:!1}),document.addEventListener("touchend",d),document.addEventListener("touchcancel",d)},s=e=>{"touchmove"===e.type&&e.preventDefault();var t=(e.touches?e.touches[0]:e).clientX,e=(e.touches?e.touches[0]:e).clientY;let n=t-r,o=e-l;a&&(t=window.innerWidth-i.offsetWidth,n=Math.max(0,Math.min(n,t)),e=i.querySelector(".popout-header"),o=e?(t=e.offsetHeight||0,e=window.innerHeight-t,Math.max(0,Math.min(o,e))):(t=window.innerHeight-i.offsetHeight,Math.max(0,Math.min(o,t)))),i.style.left=n+"px",i.style.top=o+"px"},d=()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",d),document.removeEventListener("touchmove",s),document.removeEventListener("touchend",d),document.removeEventListener("touchcancel",d)};e.addEventListener("mousedown",e=>{e.preventDefault(),this.ln(t),o(e.clientX,e.clientY)}),e.addEventListener("touchstart",e=>{e.preventDefault();e=e.touches[0];this.ln(t),o(e.clientX,e.clientY)},{passive:!1})}cn(e,t=null){var e=e.getBoundingClientRect(),n=window.innerWidth,o=window.innerHeight;let i,a;return a=t?(i=t.clientX+20,a=t.clientY+20,i+e.width>n&&(i=t.clientX-e.width-20),a+e.height>o&&(a=t.clientY-e.height-20),i=Math.max(0,Math.min(i,n-e.width)),Math.max(0,Math.min(a,o-e.height))):(t=n-e.width-50,n=o-e.height-50,i=Math.random()*Math.max(0,t)+50,Math.random()*Math.max(0,n)+50),{x:i,y:a}}};function $t(e,t){let a=e.id.toString();var e=e["display-name"]||e.login,r="user-chat-window-"+a;if(!document.getElementById(r)){r=zt.We(r,"Chat History for "+e,t);let n=document.createElement("div"),o=(n.style.cssText=` flex-grow: 1; overflow-y: auto; background-color: var(--panel-bg); `,r.appendChild(n),document.createElement("button")),i=(o.textContent="Load All Messages",o.style.cssText=` width: 100%; padding: 8px; background-color: var(--panel-border); color: var(--text-color); border: none; cursor: pointer; `,r.appendChild(o),0);o.onclick=function(){for(var e=document.createDocumentFragment();i<u;){var t=c();t&&e.appendChild(t),i++}o.remove(),n.appendChild(e)};for(var l=k()+.1,s=document.createDocumentFragment();i<u&&h[i].offset<=l;){var d=c();d&&s.appendChild(d),i++}function c(){var e=h[i],t=e.data.user||e.data["target-user"];if(t&&t.id==a)return ut(e,!0)}n.appendChild(s),r.Ye(),n.scrollTop=n.scrollHeight}}function At(){var t=prompt("Enter username for chatlog history:");if(t){var n=t.toLowerCase();for(let e=0;e<u;e++){var o=h[e];if(o.data.user&&(o.data.user.login===n||o.data.user["display-name"]===t))return void $t(o.data.user)}}}function Lt(){let t=document.createElement("div"),r=(t.className="modal",document.createElement("div")),l=(r.className="settings-panel",r.innerHTML=` <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;"><h2 style="margin: 0; color: var(--text-color);">Settings</h2><button id="settings-close" style="background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-color);">&times;</button></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Emoji Resolution (1-3): <span id="emote-res-value">${g}</span></label><input type="range" id="emote-res" min="1" max="3" value="${g}" style="width: 100%;"><button id="preload-emotes" style="margin-top: 5px; padding: 5px 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Preload Emotes</button></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Bits Resolution (1-4): <span id="bits-res-value">${b}</span></label><input type="range" id="bits-res" min="1" max="4" value="${b}" style="width: 100%;"><button id="preload-bits" style="margin-top: 5px; padding: 5px 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Preload Bits</button></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Badges Resolution: <span id="badges-res-value">${v}</span></label><select id="badges-res" style="width: 100%; padding: 5px; background-color: var(--bg-color); border: 1px solid var(--panel-border); color: var(--text-color); border-radius: 4px;"><option value="1" ${1===v?"selected":""}>1x</option><option value="2" ${2===v?"selected":""}>2x</option><option value="4" ${4===v?"selected":""}>4x</option></select><button id="preload-badges" style="margin-top: 5px; padding: 5px 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Preload Badges</button></div><div style="margin-bottom: 15px;"><button id="preload-all" style="width: 100%; padding: 10px; background-color: var(--accent-color); border: none; border-radius: 4px; color: white; cursor: pointer; font-weight: bold;">Preload All Assets</button></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Chat History Buffer (50-1000): <span id="history-value">${m}</span></label><input type="range" id="chat-history" min="50" max="1000" step="10" value="${m}" style="width: 100%;"></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Chat Update Speed (10-1000ms): <span id="update-speed-value">${p}</span>ms</label><input type="range" id="chat-update-speed" min="10" max="1000" step="10" value="${p}" style="width: 100%;"></div><div style="margin-bottom: 15px;"><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-timestamps" ${we?"checked":""} style="margin-right: 8px;"> Show message timestamps </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-badges" ${X?"checked":""} style="margin-right: 8px;"> Show user badges </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-sub-messages" ${Te?"checked":""} style="margin-right: 8px;"> Show subscription messages </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-ban-messages" ${Se?"checked":""} style="margin-right: 8px;"> Show moderation messages </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-highlighted-messages" ${ye?"checked":""} style="margin-right: 8px;"> Show message highlights </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-message-borders" ${f?"checked":""} style="margin-right: 8px;"> Show message borders </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-pinned-bits" ${Me?"checked":""} style="margin-right: 8px;"> Show pinned bits </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-polls" ${Ce?"checked":""} style="margin-right: 8px;"> Show polls </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-predictions" ${ke?"checked":""} style="margin-right: 8px;"> Show predictions </label></div><div style="display: flex; gap: 10px; margin-top: 20px;"><button id="settings-save" style="flex: 1; padding: 10px; background-color: var(--accent-color); border: none; border-radius: 4px; color: white; cursor: pointer; font-weight: bold;">Save & Close</button><button id="settings-cancel" style="flex: 1; padding: 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Cancel</button></div> `,t.appendChild(r),document.body.appendChild(t),r.querySelector("#emote-res")),e=r.querySelector("#emote-res-value"),s=(l.addEventListener("input",()=>{e.textContent=l.value}),r.querySelector("#bits-res")),n=r.querySelector("#bits-res-value"),d=(s.addEventListener("input",()=>{n.textContent=s.value}),r.querySelector("#badges-res")),o=r.querySelector("#badges-res-value"),c=(d.addEventListener("change",()=>{o.textContent=d.value}),r.querySelector("#chat-history")),i=r.querySelector("#history-value"),h=(c.addEventListener("input",()=>{i.textContent=c.value}),r.querySelector("#chat-update-speed")),a=r.querySelector("#update-speed-value"),u=(h.addEventListener("input",()=>{a.textContent=h.value}),at(r,"#preload-emotes",Ye),at(r,"#preload-bits",Qe),at(r,"#preload-badges",We),at(r,"#preload-all",et),()=>t.remove());r.querySelector("#settings-close").addEventListener("click",u),r.querySelector("#settings-cancel").addEventListener("click",u),t.addEventListener("click",e=>{e.target===t&&u()}),r.querySelector("#settings-save").addEventListener("click",()=>{g=parseInt(l.value),b=parseInt(s.value);var e=parseInt(d.value),t=(m=parseInt(c.value),parseInt(h.value)),n=(we=r.querySelector("#show-timestamps").checked,X=r.querySelector("#show-badges").checked,Te=r.querySelector("#show-sub-messages").checked,Se=r.querySelector("#show-ban-messages").checked,ye=r.querySelector("#show-highlighted-messages").checked,r.querySelector("#show-message-borders").checked),o=r.querySelector("#show-pinned-bits").checked,i=r.querySelector("#show-polls").checked,a=r.querySelector("#show-predictions").checked;v!==e&&(v=e,W=`image${v}x`),t!==p&&(Z(t),clearInterval(O),O=setInterval(()=>{P.paused||pt()},p)),n!==f&&(f=n,Et()),o!==Me&&(Me=o,St()),i!==Ce&&((Ce=i)?Le.nt():Le.poll&&Le.ot(Le.poll.id)),a!==ke&&((ke=a)?Le.ge():Le.p&&Le.be(Le.p.id)),e={emoteRes:g,bitsRes:b,badgesRes:v,chatHistoryLength:m,chatUpdateInterval:p,showMessageTimestamp:we,showUserBadges:X,showSubMessages:Te,showBanMessages:Se,showMessageBorders:f,showPinnedBits:Me,showPolls:Ce,showPredictions:ke,showHighlightedMessages:ye},localStorage.setItem("settings",JSON.stringify(e)),u(),mt()})}function It(){n&&n.disconnect(),(n=new MutationObserver(()=>{be.scrollTop=be.scrollHeight})).observe(be,{childList:!0,subtree:!0}),be.scrollTop=be.scrollHeight,setTimeout(()=>{n&&(n.disconnect(),n=null)},K)}function Et(){var e=document.getElementById("message-borders-style")||document.createElement("style");e.id="message-borders-style",f?e.textContent=".chat-message { border-bottom: 1px solid var(--panel-border); }":e.textContent=".chat-message { border-bottom: none !important; }",e.parentNode||document.head.appendChild(e)}function St(){var e=document.getElementById("pinned-bits-style")||document.createElement("style");if(e.id="pinned-bits-style",Me){if(e.textContent="",!u)return;Le.Mt(),Le.Ct()}else e.textContent=".pinned-cheer { display: none !important; }";e.parentNode||document.head.appendChild(e)}function Tt(){var e=be.scrollHeight-be.clientHeight<=be.scrollTop+100;o.style.display=e?"none":"block",o.classList.add("show")}function Vt(){var e=Math.floor(P.currentTime),t=new URL(window.location);t.searchParams.set("t",(e=>{var t=3600<e?Math.floor(e/3600):0,n=60<e?Math.floor(e%3600/60):0;let o="";return 0<t&&(o+=t+"h"),0<n&&(o+=n+"m"),o+=e%60+"s"})(e)),window.history.replaceState({},"",t.toString())}function Dt(){var e=new URL(window.location).searchParams.get("t");e&&(P.currentTime=/^\d+$/.test(e=e)?parseInt(e):3600*((e=e.match(/(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s)?/))[1]?parseInt(e[1]):0)+60*(e[2]?parseInt(e[2]):0)+(e[3]?parseInt(e[3]):0))}window.addEventListener("keydown",e=>{var t;!P||e.defaultPrevented||(t=e.target)&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable)||e.altKey||e.ctrlKey||e.metaKey||"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||(e.preventDefault(),t="ArrowLeft"===e.key?-1:1,e=Number.isFinite(P.duration)?P.duration:1/0,e=Math.min(e,Math.max(0,(P.currentTime||0)+5*t)),P.currentTime=e)},{capture:!0}),document.addEventListener("DOMContentLoaded",async()=>{document.getElementById("settings-btn").addEventListener("click",Lt),document.getElementById("theme-toggle-btn").addEventListener("click",Pt),document.getElementById("report-btn").addEventListener("click",()=>{window.open("https://github.com/sputchik/sputchik.github.io/issues/new","_blank")}),vt();var e=localStorage.getItem("settings");if(e)try{"emoteRes"in(e=JSON.parse(e))&&(g=e.emoteRes),"bitsRes"in e&&(b=e.bitsRes),"badgesRes"in e&&(v=e.badgesRes),"chatHistoryLength"in e&&(m=e.chatHistoryLength),"chatUpdateInterval"in e&&Z(e.chatUpdateInterval),"showMessageTimestamp"in e&&(we=e.showMessageTimestamp),"showUserBadges"in e&&(X=e.showUserBadges),"showSubMessages"in e&&(Te=e.showSubMessages),"showBanMessages"in e&&(Se=e.showBanMessages),"showMessageBorders"in e&&(f=e.showMessageBorders),"showPinnedBits"in e&&(Me=e.showPinnedBits),"showPolls"in e&&(Ce=e.showPolls),"showPredictions"in e&&(ke=e.showPredictions),"showHighlightedMessages"in e&&(ye=e.showHighlightedMessages),W=`image${v}x`,Et(),St()}catch(e){console.error("Failed to load settings:",e)}await Promise.all([_e(),(async()=>{var e=await E.add(ge.T.L());if(e.errors)return console.warn("Failed to fetch global badges: ",e.errors);var t=e.badges;let n=t.length;for(;n--;){var o=t[n];x.set(""+o.setID+o.version,o)}})(),(async()=>{var t=await E.add(ge.S.L({channelLogin:r}));if(t.errors)return console.warn("Failed to fetch channel badges: ",t.errors);if(t.user&&t.user.broadcastBadges){var n=t.user.broadcastBadges;let e=n.length;for(;e--;){var o=n[e];Y.set(""+o.setID+o.version,o)}}else console.warn("Invalid channel badges response: ",t)})(),(async()=>{var e=await E.add(ge.I.L());if(e.errors)return console.warn("Failed to fetch bits config: ",e.errors);var t=e.cheerConfig.groups[0],n=e.cheerConfig.displayConfig.colors;j=t.templateURL;for(let e=0;e<n.length;e++){var o=n[e];G.set(o.bits,o.color)}for(let e=0;e<t.nodes.length;e++){var i=t.nodes[e];if("DISPLAY_ONLY"!==i.type){_.add(i.prefix);var a=new Array;for(let e=0;e<i.tiers.length;e++)a.push(i.tiers[e].bits);var r=i.prefix.toLowerCase();U.set(r,a)}}e=Array.from(_).join("|"),q=new RegExp(`(?:^|\\s)(${e})(\\d+)(?=\\s|$)`,"gi")})(),(async()=>{var e;J||(e=await E.add(ge.V.L({channelLogin:r,includeIsDJ:!1})),J)||(e.errors||!e.user?console.warn("Failed to fetch channel primary color: ",e.errors):(e=e.user.primaryColorHex)&&Oe("#"+e))})(),(async()=>{var e=await E.add(ge.F.L({channelLogin:r,includeGoalTypes:[]}));if(e.errors)console.warn("Failed to fetch channel points context: ",e.errors);else{var t=e?.community?.channel?.communityPointsSettings;if(t){(ze=t.image)&&((new Image).src=ze.url4x),De=t;var n=new Map,o=t.automaticRewards;let e=o.length;for(;e--;){var i=o[e],a=i.id.split(":",2)[1];n.set(a,i)}De.automaticRewards=n}else console.warn("Invalid community points settings: ",e)}})()]).then(()=>{Ze()}),O=setInterval(()=>{P.paused||pt()},p),P.addEventListener("play",()=>{wt(),xt(),be.scrollHeight-be.clientHeight>=be.scrollTop+100&&It(),Le.St()}),P.addEventListener("pause",()=>{Vt(),wt(),Le.Et()}),P.addEventListener("ratechange",()=>{z=P.playbackRate||1,P.paused||(wt(),xt()),Le.Vt()}),P.addEventListener("seeking",()=>{wt(),kt(),Mt(),Le.Ct()}),P.addEventListener("seeked",()=>{wt(),Vt(),l=(e=>{if(!u)return 0;let t=0,n=u-1,o=-1;for(;t<=n;){var i=t+n>>1;h[i].offset<=e?(o=i,t=1+i):n=i-1}return Math.max(0,o)})(k()),Mt(),kt(),mt(),Le.Tt(),xt(),Ze()}),P.addEventListener("loadedmetadata",()=>{Dt(),Ze(),Le.Tt(),z=P.playbackRate||1,xt(),setInterval(Vt,3e3)});let o=!1;P.addEventListener("ended",()=>{if(!o){var e=document.createElement("btn"),t=(e.title="Play Next Stream",e.className="btn chat-header-btn",$e(Pe.$));e.appendChild(t);let n=Ue.Zt(i);e.onclick=async function(){var e=await n;if(!e)return alert("This is the last archived stream!");var t=new URL(window.location);t.searchParams.set("id",e.id),location.replace(t)},$.insertBefore(e,$.firstChild),o=!0}})}),document.addEventListener("touchstart",()=>{},{passive:!0});</script>