<!DOCTYPE html><html lang="en"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Twitch VOD Viewer</title><style>:root{--bg-color:#f8f8f8;--scrollbar-bg:#f0f0f0;--scrollbar-thumb:#c1c1c1;--scrollbar-thumb-hover:#a1a1a1;--text-color:#333;--panel-bg:#fff;--panel-border:#ddd;--chat-border:#eee;--timestamp-color:#999;--game-name-color:#555;--resize-handle:#ddd;--resize-handle-hover:#6441a5;--chat-header-bg:#f4f4f4;--viewer-icon-color:#971311;--accent-color:#6741a5;--sub-color:#8b04c1}[data-theme=dark]{--bg-color:#000000;--scrollbar-bg:#000000;--scrollbar-thumb:#222222;--scrollbar-thumb-hover:#6441a5;--text-color:#e5e5e5;--panel-bg:#0f0f0f;--panel-border:#333;--chat-border:#252525;--timestamp-color:#888;--game-name-color:#aaa;--resize-handle:#333333;--resize-handle-hover:#6441a5;--chat-header-bg:#000000;--viewer-icon-color:#ff6b68}*{scrollbar-width:thin;scrollbar-color:var(--scrollbar-thumb) var(--scrollbar-bg)}a{color:inherit;text-decoration:none}a:focus,a:hover{text-decoration:underline}body{font-family:Arial,sans-serif;font-size:15px;margin:0;padding:0;background:var(--bg-color);color:var(--text-color);overflow-y:hidden}.container{display:flex;flex-direction:row;max-width:100%;height:100dvh}.left-panel{flex:1;min-width:0;padding-left:10px;padding-right:10px;display:flex;flex-direction:column;height:100%;overflow-y:auto}.video-container{position:relative;width:100%;padding-top:56.25%;background:#000}#video-player{position:absolute;top:0;left:0;width:100%;height:100%}.stream-info{margin-top:12px;padding:8px;padding-top:12px;background:var(--panel-bg);border-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,.1)}.stream-info-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.stream-title{font-size:1rem;margin:0}.game-name{color:var(--game-name-color);font-size:.8rem;margin-top:3px}.viewers-count{font-weight:700;margin-right:55px;display:flex;align-items:center}.chat-toggle{background:var(--panel-bg);color:var(--text-color);border:1px solid var(--panel-border);border-radius:4px;padding:8px 15px;cursor:pointer;font-weight:700}.description{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:15px;margin-top:15px;padding:15px;background:var(--panel-bg);border-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,.1);overflow-wrap:break-word}.chat-panel{resize:horizontal;min-width:200px;width:380px;background:var(--panel-bg);border-left:1px solid var(--panel-border);display:flex;flex-direction:column;padding-bottom:env(safe-area-inset-bottom);padding-top:env(safe-area-inset-top);position:relative}.chat-header{padding:5px 9px;border-bottom:1px solid var(--panel-border);font-weight:700;background:var(--chat-header-bg);display:flex;justify-content:space-between;align-items:center}.chat-header-btn{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;color:var(--text-color)}.chat-event-log{background:var(--panel-bg);border-bottom:1px solid var(--panel-border);max-height:200px;overflow-y:auto;padding:8px;display:none}.chat-event-log.has-events{display:block}.chat-event-item{padding:6px 8px;margin-bottom:4px;border-radius:4px;font-size:13px;line-height:1.3;border-left:3px solid}.chat-event-item.poll{background:rgba(145,70,255,.1);border-left-color:#9146ff}.chat-event-item.prediction{background:rgba(0,173,181,.1);border-left-color:#00adb5}.chat-event-item.raid{background:rgba(255,158,39,.1);border-left-color:#ff9e27}.chat-event-item.pin{background:rgba(100,65,165,.1);border-left-color:#6441a5}.chat-event-item.misc{background:rgba(139,4,193,.1);border-left-color:#8b04c1}.chat-event-title{font-weight:700;margin-bottom:2px}.chat-event-description{color:var(--timestamp-color);font-size:12px}.chat-event-status{float:right;font-size:11px;font-weight:700;text-transform:uppercase}.chat-event-status.active{color:#0f0}.chat-event-status.completed{color:#fa0}.chat-event-status.resolved{color:#00adb5}.chat-messages{overflow-y:scroll;padding:10px}.chat-message{padding:5px 0;border-bottom:1px solid var(--chat-border)}.chat-username{font-weight:700}.chat-text{word-break:break-word}.timestamp{color:var(--timestamp-color);font-size:.75rem;margin-right:5px}.monet,.poll,.prediction{background-color:var(--panel-bg);border-left:3px solid #6441a5;padding-left:5px}.inraid{background-color:#ffad000f;border-left:3px solid #ff9e27;padding-left:5px}.mod{background-color:#ff00000a;border-left:3px solid red;padding-left:5px;font-style:italic}@media (orientation:portrait){.container{position:relative;display:grid;grid-template-areas:"video" "info" "chat";grid-template-rows:auto auto 1fr;height:100dvh}.left-panel{display:contents;height:auto;padding:10px}.video-container{grid-area:video}.stream-info{grid-area:info;margin-bottom:0}#chat-panel{grid-area:chat;position:relative;width:100%;border-left:none;overflow-y:auto;padding-bottom:env(safe-area-inset-bottom)}.description{position:absolute;top:100dvh;left:0;right:0}#resize-handle{display:none}.viewers-count{margin-right:5px}}.resize-handle{width:5px;background-color:var(--resize-handle);cursor:col-resize}.resize-handle.active,.resize-handle:hover{transition:background-color .2s;background-color:var(--resize-handle-hover)}.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center}.settings-panel{background:var(--panel-bg);border:1px solid var(--panel-border);border-radius:4px;padding:20px;min-width:300px;width:40vw;max-width:80vw;max-height:80vh;height:75%;overflow-y:auto;color:var(--text-color);box-shadow:0 1px 3px rgba(0,0,0,.1)}.progress-bar{width:100%;background:var(--panel-border);border-radius:4px;margin-top:5px;padding:2px;font-size:12px;text-align:center;color:var(--bg-color);display:none}.popout{position:absolute;top:100px;left:100px;width:350px;height:400px;max-width:80vw;max-height:80vh;background-color:var(--bg-color);border:1px solid var(--panel-border);border-radius:4px;z-index:10;display:flex;flex-direction:column;resize:both;overflow:auto}</style><div class="container"><div class="left-panel"><div class="video-container"><video id="video-player" webkit-playsinline="true" playsinline="true" controls preload="auto">Your browser does not support the video tag.</video></div><div class="stream-info"><div class="stream-info-header"><div><h1 class="stream-title" id="stream-title">Loading...</h1><div style="display:flex;align-items:center;gap:6px;margin-top:6px"><svg fill="var(--game-name-color)" width="16" height="16" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg" id="memory-gamepad-center"><path d="M14 1V2H15V7H20V8H21V14H20V15H15V20H14V21H8V20H7V15H2V14H1V8H2V7H7V2H8V1H14M13 8H9V9H8V13H9V14H13V13H14V9H13V8Z"/></svg><span class="game-name" id="game-name">Loading...</span></div></div><div style="display:flex;align-items:center"><span class="viewers-count" style="gap:3px;display:flex;align-items:center;color:var(--viewer-icon-color)"><svg width="20" height="20" viewBox="0 0 20 20" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M5 7a5 5 0 1 1 6.192 4.857A2 2 0 0 0 13 13h1a3 3 0 0 1 3 3v2h-2v-2a1 1 0 0 0-1-1h-1a3.99 3.99 0 0 1-3-1.354A3.99 3.99 0 0 1 7 15H6a1 1 0 0 0-1 1v2H3v-2a3 3 0 0 1 3-3h1a2 2 0 0 0 1.808-1.143A5.002 5.002 0 0 1 5 7zm5 3a3 3 0 1 1 0-6 3 3 0 0 1 0 6z" clip-rule="evenodd"></path></svg><span id="viewer-count">0</span></span><button class="theme-toggle" id="theme-toggle-btn" style="margin-left:8px;background:var(--panel-bg);color:var(--text-color);border:1px solid var(--panel-border);border-radius:4px;padding:8px 15px;cursor:pointer"><svg id="theme-icon" width="16" height="16" viewBox="0 0 24 24" style="vertical-align:text-bottom"><path id="moon-icon" fill="currentColor" d="M21.53 15.93c-.16-.27-.61-.69-1.73-.49a8.46 8.46 0 01-1.88.13 8.409 8.409 0 01-5.91-2.82 8.068 8.068 0 01-1.44-8.66c.44-1.01.13-1.54-.09-1.76s-.77-.55-1.83-.11a10.318 10.318 0 00-6.32 10.21 10.475 10.475 0 007.04 8.99 10 10 0 002.89.55c.16.01.32.02.48.02a10.5 10.5 0 008.47-4.27c.67-.93.49-1.519.32-1.79z" style="display:none"/><path id="sun-icon" fill="currentColor" d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 000-1.41l-1.06-1.06zm1.06-10.96a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/></svg></button></div></div></div><div class="description" id="description-container" style="display:none"><details><summary></summary><div id="description-content">Loading...</div></details></div></div><div class="resize-handle" id="resize-handle"></div><div class="chat-panel" id="chat-panel"><div class="chat-header"><span>Chat Replay (WIP)</span><div style="display:flex;gap:5px"><button class="chat-header-btn" title="Found Issue? Report here" id="report-btn"><svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M17.416 2.62412C17.7607 2.39435 17.8538 1.9287 17.624 1.58405C17.3943 1.23941 16.9286 1.14628 16.584 1.37604L13.6687 3.31955C13.1527 3.11343 12.5897 3.00006 12.0001 3.00006C11.4105 3.00006 10.8474 3.11345 10.3314 3.31962L7.41603 1.37604C7.07138 1.14628 6.60573 1.23941 6.37596 1.58405C6.1462 1.9287 6.23933 2.39435 6.58397 2.62412L8.9437 4.19727C8.24831 4.84109 7.75664 5.70181 7.57617 6.6719C8.01128 6.55973 8.46749 6.50006 8.93763 6.50006H15.0626C15.5328 6.50006 15.989 6.55973 16.4241 6.6719C16.2436 5.70176 15.7519 4.841 15.0564 4.19717L17.416 2.62412Z"/><path fill="currentColor" d="M1.25 14.0001C1.25 13.5859 1.58579 13.2501 2 13.2501H5V11.9376C5 11.1019 5.26034 10.327 5.70435 9.68959L3.22141 8.69624C2.83684 8.54238 2.6498 8.10589 2.80366 7.72131C2.95752 7.33673 3.39401 7.1497 3.77859 7.30356L6.91514 8.55841C7.50624 8.20388 8.19807 8.00006 8.9375 8.00006H15.0625C15.8019 8.00006 16.4938 8.20388 17.0849 8.55841L20.2214 7.30356C20.606 7.1497 21.0425 7.33673 21.1963 7.72131C21.3502 8.10589 21.1632 8.54238 20.7786 8.69624L18.2957 9.68959C18.7397 10.327 19 11.1019 19 11.9376V13.2501H22C22.4142 13.2501 22.75 13.5859 22.75 14.0001C22.75 14.4143 22.4142 14.7501 22 14.7501H19V15.0001C19 16.1808 18.7077 17.2932 18.1915 18.2689L20.7786 19.3039C21.1632 19.4578 21.3502 19.8943 21.1963 20.2789C21.0425 20.6634 20.606 20.8505 20.2214 20.6966L17.3288 19.5394C16.1974 20.8664 14.5789 21.7655 12.75 21.9604V15.0001C12.75 14.5858 12.4142 14.2501 12 14.2501C11.5858 14.2501 11.25 14.5858 11.25 15.0001V21.9604C9.42109 21.7655 7.80265 20.8664 6.67115 19.5394L3.77859 20.6966C3.39401 20.8505 2.95752 20.6634 2.80366 20.2789C2.6498 19.8943 2.83684 19.4578 3.22141 19.3039L5.80852 18.2689C5.29231 17.2932 5 16.1808 5 15.0001V14.7501H2C1.58579 14.7501 1.25 14.4143 1.25 14.0001Z"/></svg><button class="chat-header-btn" title="Open user ChatLog by username" id="chatlog-btn"><svg width="20" height="20" viewBox="0 0 24 24"><path fill="none" d="M18.5 19.5L20 21M11 14C7.13401 14 4 17.134 4 21H11M19 17.5C19 18.8807 17.8807 20 16.5 20C15.1193 20 14 18.8807 14 17.5C14 16.1193 15.1193 15 16.5 15C17.8807 15 19 16.1193 19 17.5ZM15 7C15 9.20914 13.2091 11 11 11C8.79086 11 7 9.20914 7 7C7 4.79086 8.79086 3 11 3C13.2091 3 15 4.79086 15 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button><button class="chat-header-btn" title="Open Settings" id="settings-btn"><svg width="20" height="20" viewBox="0 0 20 20" style="color:var(--text-color)"><path fill="currentColor" d="M10 8a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"></path><path fill="currentColor" fill-rule="evenodd" d="M9 2h2a2.01 2.01 0 0 0 1.235 1.855l.53.22a2.01 2.01 0 0 0 2.185-.439l1.414 1.414a2.01 2.01 0 0 0-.439 2.185l.22.53A2.01 2.01 0 0 0 18 9v2a2.01 2.01 0 0 0-1.855 1.235l-.22.53a2.01 2.01 0 0 0 .44 2.185l-1.415 1.414a2.01 2.01 0 0 0-2.184-.439l-.531.22A2.01 2.01 0 0 0 11 18H9a2.01 2.01 0 0 0-1.235-1.854l-.53-.22a2.009 2.009 0 0 0-2.185.438L3.636 14.95a2.009 2.009 0 0 0 .438-2.184l-.22-.531A2.01 2.01 0 0 0 2 11V9c.809 0 1.545-.487 1.854-1.235l.22-.53a2.009 2.009 0 0 0-.438-2.185L5.05 3.636a2.01 2.01 0 0 0 2.185.438l.53-.22A2.01 2.01 0 0 0 9 2zm-4 8 1.464 3.536L10 15l3.535-1.464L15 10l-1.465-3.536L10 5 6.464 6.464 5 10z" clip-rule="evenodd"></path></svg></button></button></div></div><div class="chat-messages" id="chat-messages"></div></div></div><script>var e=new URLSearchParams(window.location.search).get("id");e||window.location.replace("https://archive.org/details/@sputchik?sort=-date");let[D,,y]=e.split("-");e=`https://archive.org/download/${e}/`;let L=e+y+".json",N=e+y+"-metadata.json";var t=e+y+".mp4";let O=`https://corsproxy.io/?url=${e}${y}.tar.gz`,f=document.getElementById("video-player"),h=document.getElementById("chat-panel"),g=document.getElementById("chat-messages"),H=document.getElementById("viewer-count"),j="ontouchstart"in window||0<navigator.maxTouchPoints,U=(f.src=t,e=window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("theme"),ze(e||!t?e?"dark":"light":t),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{ze(e.matches?"dark":"light")}),null),r={t:null,viewers:null,o:null},d=null,V=0,J=null,b=[],w=0,s=!1,l=0,G=null,_=new Set,m=new Map,X=new Map,p=null,q,v=100,x=250,K=5,k=4,M=`image${k}x`,$=!0,I=!0,S=!0,B=!0,P=!0,A=3,F=4,u=new Map,C=new Map,Q=new Set,Y=new Set;new Set(["msg","monet","inraid","mod","misc"]);let W=new Map,Z=["#FF0000","#0000FF","#008000","#B22222","#FF7F50","#9ACD32","#FF4500","#2E8B57","#DAA520","#D2691E","#5F9EA0","#1E90FF","#FF69B4","#8A2BE2","#00FF7F"],T={i:'<path fill="currentColor" fill-rule="evenodd" d="M16 6h2v6h-1v6H3v-6H2V6h2V4.793c0-2.507 3.03-3.762 4.803-1.99.131.131.249.275.352.429L10 4.5l.845-1.268a2.81 2.81 0 0 1 .352-.429C12.969 1.031 16 2.286 16 4.793V6zM6 4.793V6h2.596L7.49 4.341A.814.814 0 0 0 6 4.793zm8 0V6h-2.596l1.106-1.659a.814.814 0 0 1 1.49.451zM16 8v2h-5V8h5zm-1 8v-4h-4v4h4zM9 8v2H4V8h5zm0 4H5v4h4v-4z" clip-rule="evenodd"></path>',reply:'<path fill="currentColor" d="M11 8h2v2h-2V8zM9 8H7v2h2V8z"></path><path fill="currentColor" fill-rule="evenodd" d="m10 18-3-3H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2l-3 3zm-2.172-5L10 15.172 12.172 13H15V5H5v8h2.828z" clip-rule="evenodd"></path>',sub:'<path fill="currentColor" d="M8.944 2.654c.406-.872 1.706-.872 2.112 0l1.754 3.77 4.2.583c.932.13 1.318 1.209.664 1.853l-3.128 3.083.755 4.272c.163.92-.876 1.603-1.722 1.132L10 15.354l-3.579 1.993c-.846.47-1.885-.212-1.722-1.132l.755-4.272L2.326 8.86c-.654-.644-.268-1.723.664-1.853l4.2-.583 1.754-3.77z"></path>',l:'<path fill="currentColor" d="M18 5v8a2 2 0 0 1-2 2H4a2.002 2.002 0 0 1-2-2V5l4 3 4-4 4 4 4-3z" fill-rule="evenodd"></path>',u:'<path fill="currentColor" fill-rule="evenodd" d="m11 14 7 4V2l-7 4H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h2v4h2v-4h3zm1-6.268 4-2.286v9.108l-4-2.286V7.732zM10 12H4V8h6v4z" clip-rule="evenodd"></path>'},ee=new Image;ee.src="https://static-cdn.jtvnw.net/subs-image-assets/gift-illus.png";let te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=null,a=document.createElement("button");function oe(e,t=20,o=20){var a=document.createElementNS("http://www.w3.org/2000/svg","svg");return a.setAttribute("width",t),a.setAttribute("height",o),a.setAttribute("viewBox",`0 0 ${t} `+o),a.style.color="var(--text-color)",a.style=`min-height: ${o}px; min-width: ${t}px;`,a.innerHTML=e,a}a.textContent="▼ Scroll to Bottom",a.style.cssText="position: absolute; bottom: 4%; left: 50%; transform: translateX(-50%); display: none; z-index: 3; width: 50%; height: fit-content; min-height: 33px; border-radius: 8px; border-color: var(--panel-border); background-color: var(--bg-color); color: var(--text-color);",a.addEventListener("click",()=>{g.scrollTop=g.scrollHeight}),h.appendChild(a),g.addEventListener("scroll",He);class ae{constructor(e,t){this.operationName=e,this.sha256Hash=t,this.extensions={persistedQuery:{version:1,sha256Hash:this.sha256Hash}}}h(e={}){return{operationName:this.operationName,extensions:this.extensions,variables:e}}}class ne extends ae{constructor(){super("BitsConfigContext_Global","6a265b86f3be1c8d11bdcf32c183e106028c6171e985cc2584d15f7840f5fee6")}}class re extends ae{constructor(){super("ChannelRoot_AboutPanel","0df42c4d26990ec1216d0b815c92cc4a4a806e25b352b66ac1dd91d5a1d59b80")}}class ie extends ae{constructor(){super("ChatList_Badges","838a7e0b47c09cac05f93ff081a9ff4f876b68f7624f0fc465fe30031e372fc2")}}class se extends ae{constructor(){super("GlobalBadges","9db27e18d61ee393ccfdec8c7d90f14f9a11266298c2e5eb808550b77d7bcdf6")}}let le=new class{m=new ne;p=new re;v=new ie;g=new se};class z extends Error{constructor(e){super("string"==typeof e?e:JSON.stringify(e)),this.name="RequestError",this.k=e}}let E=new class{constructor(e=30,t=35,o=3e3){this.M=e,this.$=t,this.I=o,this.S=[],this.total=0,this.B=0,this.P=null,this.endpoint="https://gql.twitch.tv/gql",this.headers={"Client-ID":"kimne78kx3ncx6brgo4mv6wki5h1ko","Device-Id":Array(32).fill(0).map(()=>te.charAt(Math.floor(Math.random()*te.length))).join(""),"Accept-Language":"en-US"}}async add(t,n=10){for(;0<=n;){let o,a;var e=new Promise((e,t)=>{o=e,a=t}),r=(this.S.push({A:t,resolve:o,reject:a}),this.S.length),i=Date.now();1===r?(this.B=i,this.P=setTimeout(()=>{this.F(),this.M})):(r>=this.$||i-this.B>=this.M)&&(this.P&&(clearTimeout(this.P),this.P=null),this.F());try{return await e}catch(e){if(--n<0)throw r=t.operationName||"unknown",new Error(`Failed to execute operation "${r}" after retries: `+e.message)}}}async F(){if(this.S.length){var o=this.S,t=(this.S=[],this.P&&(clearTimeout(this.P),this.P=null),o.length);this.total+=t;try{console.debug(`Collecting ${t} promises...`);var a=JSON.stringify(o.map(e=>e.A)),n=this.C(a.length),r=Date.now();let e=new AbortController;var i=setTimeout(()=>e.abort(),this.I),s=await fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json",...this.headers},body:a,signal:e.signal});if(clearTimeout(i),!s.ok)throw new Error(`Invalid response status (${s.status})`);var l=await s.text(),c=this.C(l.length),d=JSON.parse(l),u=((Date.now()-r)/1e3).toFixed(2);console.debug(`Collected ${t} promise(s) (${n}) in ${u}s (${c}). Total: `+this.total);for(let e=0;e<o.length;e++){var h,m,p=o[e],v=d[e];v.errors?(h=new z(v.errors),m=p.A.operationName||"Unknown",console.warn(`[${m}] Operation error: `+JSON.stringify(v.errors)),p.reject(h)):p.resolve(v.data||v)}}catch(t){console.error(`Error collecting ${o.length} promises: `+t.message);for(let e=0;e<o.length;e++)o[e].reject(new z(t))}}}C(e){return e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB"}},ce=new class{constructor(e,t,o=1){this.T=e,this.R=t,this.version=o,this.D=null}async init(){return this.D||new Promise((t,o)=>{if(window.indexedDB){let e=indexedDB.open(this.T,this.version);e.onerror=()=>o(e.error),e.onsuccess=()=>{this.D=e.result,t(this.D)},e.onupgradeneeded=e=>{e=e.target.result;e.objectStoreNames.contains(this.R)||e.createObjectStore(this.R,{keyPath:"id"})}}else o(new Error("IndexedDB not supported"))})}async set(a,n){try{return this.D||await this.init(),new Promise((e,t)=>{let o=this.D.transaction([this.R],"readwrite").objectStore(this.R).put({id:a,data:n,timestamp:Date.now()});o.onerror=()=>t(o.error),o.onsuccess=()=>e(!0)})}catch(e){return console.warn("IndexedDB set failed:",e),!1}}async get(a){return this.D||await this.init(),new Promise((t,e)=>{let o=this.D.transaction([this.R],"readonly").objectStore(this.R).get(a);o.onerror=()=>e(o.error),o.onsuccess=()=>{var e=o.result;t(e?e.data:null)}})}async delete(a){try{return this.D||await this.init(),new Promise((e,t)=>{let o=this.D.transaction([this.R],"readwrite").objectStore(this.R).delete(a);o.onerror=()=>t(o.error),o.onsuccess=()=>e(!0)})}catch(e){return console.warn("IndexedDB delete failed:",e),!1}}async L(){try{return this.D||await this.init(),new Promise((e,t)=>{let o=this.D.transaction([this.R],"readwrite").objectStore(this.R).clear();o.onerror=()=>t(o.error),o.onsuccess=()=>e(!0)})}catch(e){return console.warn("IndexedDB deleteAll failed:",e),!1}}};new class{constructor(){}N(e){}O(e){}H(e){}j(e){}U(e){}V(e){}J(e){}G(e){}_(e){}X(e){}q(e){}K(e){}Y(e){}W(e){}Z(e){}ee(e){}te(e){}};async function de(t){try{var o=t.stream(),a=new DecompressionStream("gzip"),n=o.pipeThrough(a),r=await new Response(n).arrayBuffer(),i=new Uint8Array(r),s={};let e=0;for(;e+512<=i.byteLength;){var l=i.slice(e,e+512);if(l.every(e=>0===e))break;var c=l.slice(0,100);let t="";for(let e=0;e<c.length&&0!==c[e];e++)t+=String.fromCharCode(c[e]);var d=String.fromCharCode(l[156]),u=l.slice(124,136);let o="";for(let e=0;e<u.length&&0!==u[e];e++)o+=String.fromCharCode(u[e]);var h=parseInt(o.trim()||"0",8);if(console.log("TAR entry:",t,"type:",d,"size:",h),"0"!==d&&"\0"!==d||t.includes("PaxHeader")){var m=Math.ceil(h/512);e+=512+512*m}else{if(0<h&&(t.endsWith(".json")||t.endsWith("-metadata.json"))){var p=e+512,v=i.slice(p,p+h);try{var f=new TextDecoder("utf-8").decode(v),g=JSON.parse(f);s[t]=g,console.log("Extracted:",t,"size:",E.C(h))}catch(e){console.warn("Failed to parse JSON for",t,":",e)}}var b=Math.ceil(h/512);e+=512+512*b}}var w=y+"-metadata.json",x=y+".json";return(console.log("Available files:",Object.keys(s)),s[w]&&s[x])?(console.log("Successfully extracted both metadata and chat log"),[s[w],s[x]]):(console.warn("Target files not found"),null)}catch(e){return console.error("Failed to parse compressed chat log:",e),null}}function ue(e){return`https://static-cdn.jtvnw.net/emoticons/v2/${e}/default/dark/${A}.0`}function he(t){if(t&&t.length){let e=t.length;for(;e--;)(e=>{var t;Q.has(e)||(Q.add(e),(t=new Image).src=ue(e),t.onerror=()=>{console.warn("Failed to load emote:",e),Q.delete(e)})})(t[e].id)}}function me(t){if(t&&t.length){let e=t.length;for(;e--;){var o=t[e];(e=>{var t,o;Y.has(e)||((t=C.get(e)||u.get(e))?((o=new Image).src=t[M],o.onerror=()=>{console.warn("Failed to load badge:",e)},o.onload=()=>{Y.add(e)}):console.warn("Unknown badge ID:",e))})(""+o.name+o.value)}}}function pe(){if(s){var t=b[l].offset;let e=l;for(;e<b.length&&b[e].offset<t+K;){var o=b[e];he(o.data.emotes),me(o.data.badges),o.data.user&&!o.data.color&&(o=o.data.user.login,W.has(o)||Me(o)),e++}}}function ve(e,t,o,a,n){let r={PREFIX:e.toLowerCase(),BACKGROUND:t,ANIMATION:o?"animated":"static",TIER:a,SCALE:n,EXTENSION:o?"gif":"png"};return G.replace(/\b(PREFIX|BACKGROUND|ANIMATION|TIER|SCALE|EXTENSION)\b/g,e=>r[e])}function fe(n=null){if(null===G)console.warn("Bits template URL not set");else{let o=0,a=0;for(var[,e]of m.entries())o+=e.length;n&&n(a,o);for(var[r,i]of m.entries()){let t=i.length;for(;t--;){var s=i[t];let e=ve(r,"dark",!0,s,F);s=new Image;s.onload=()=>{a++,n&&n(a,o)},s.onerror=()=>{console.warn("Failed to preload bits image:",e),a++,n&&n(a,o)},s.src=e}}}}function ge(e=null){var o,t=Array.from(u.values()),a=Array.from(C.values());let n=t.length+a.length,r=0,i=(e&&e(r,n),()=>{r++,e&&e(r,n)});for(o of[t,a]){let t=o.length;for(;t--;){var s=o[t];let e=""+s.setID+s.version;var l=new Image;l.onload=i,l.onerror=()=>{console.warn("Failed to preload badge:",e),i()},l.src=s[M]}}}function be(){var t=new Set;let e=b.length;for(;e--;){var o=b[e].data.emotes;if(o){let e=o.length;for(;e--;)t.add(o[e].id)}}return t}function we(t=null){var o=be();let a=o.size,n=0;t&&t(n,a);for(let e of o){var r=new Image;r.onload=()=>{n++,t&&t(n,a)},r.onerror=()=>{console.warn("Failed to preload emote:",e),n++,t&&t(n,a)},r.src=ue(e)}}function xe(t=null){let e,o,a=0,n=0,r=0,i=0;var s,l;e=be().size,o=u.size+C.size;for([s,l]of m.entries())a+=l.length;let c=e+o+a,d=()=>{var e=n+r+i;t&&t(e,c)};we((e,t)=>{n=e,d()}),ge((e,t)=>{r=e,d()}),fe((e,t)=>{i=e,d()})}function ye(e,t,o){e.querySelector(t).addEventListener("click",function(){let i=this;var e;i.dataset.oe=i.style.color||"",i.style.color="#FFFFFF",(e=i).disabled=!0,e.dataset.ae=e.textContent,e.dataset.ne=e.style.backgroundColor||"",o((e,t)=>{var o,a,n,r;o=i,r=e,n=0<(a=t)?Math.round(r/a*100):0,o.textContent=r+`/${a} (${n}%)`,o.style.background=`linear-gradient(to right, var(--accent-color, #9147ff) ${n}%, var(--panel-border) ${n}%)`,t<=e&&((r=i).disabled=!1,r.style.backgroundImage="",r.textContent=r.dataset.ae,r.style.backgroundColor=r.dataset.ne||"var(--panel-border)",r.style.color=r.dataset.oe||"var(--text-color)")})})}function ke(o,e,t=!1){if(!e.length&&!t)return document.createTextNode(o);var a,n=[];if(e&&n.push(...e.flatMap(t=>t.pos.map(e=>({re:!1,start:e,end:e+t.len-1,id:t.id})))),t&&p)for(p.lastIndex=0;null!==(a=p.exec(o));)n.push({re:!0,start:a.index,end:a.index+a[0].length-1,ie:a[1],se:parseInt(a[2],10)});n.sort((e,t)=>e.start-t.start);var r=document.createDocumentFragment();let i=0;for(let e=0,t=n.length;e<t;e++){var s=n[e],l=(s.start>i&&(l=o.substring(i,s.start),r.appendChild(document.createTextNode(l))),document.createElement("img"));if(l.onerror=function(){this.replaceWith(document.createTextNode(this.alt))},s.re){var c=m.get(s.ie.toLowerCase());let t=1;if(c)for(let e=c.length-1;0<=e;e--)if(s.se>=c[e]){t=c[e];break}var d=document.createElement("span"),u=(d.className="bits-container",d.style="display: inline-flex; align-items: center; vertical-align: middle; gap: 2px; margin-left: 2px; margin-right: 2px;",l.src=ve(s.ie,"dark",!0,t,F),l.title=l.alt=""+s.ie+t,l.style="height: 1.6rem; width: auto; vertical-align: middle;",document.createElement("span"));u.textContent=s.se.toString(),u.style=`font-weight: bold; color: ${X.get(t)};`,d.appendChild(l),d.appendChild(u),r.appendChild(d)}else l.src=ue(s.id),l.title=l.alt=o.substring(s.start,s.end+1),l.style.cssText="height: 1.6rem; width: auto; vertical-align: middle; margin-left: 0.5px;",r.appendChild(l);i=s.end+1}return i<o.length&&(e=o.substring(i),r.appendChild(document.createTextNode(e))),r}function Me(e){var t=e.toString().split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0),t=Math.abs(t)%Z.length,t=Z[t];return W.set(e,t),t}function $e(e){return W.get(e)||Me(e)}function R(e,t,o=null){var a=document.createElement("span"),t=(a.className="chat-username",t||$e(e.login));if(a.style=`color: ${t}; cursor: pointer;`,a.textContent=e["display-name"]||e.login,a.onclick=()=>Re(e),!B||!o||!o.length)return a;var n,t=document.createElement("span"),r=document.createElement("span");r.style="margin-right: 4px;";for(n of o){var i,s=""+n.name+n.value,l=C.get(s)||u.get(s);l?((i=document.createElement("img")).src=l[M],i.style="height: 1.0rem; width: auto; vertical-align: middle; margin-right: 4px;",i.title=i.alt=l.title,r.appendChild(i)):console.warn("Badge not found: "+s)}return t.appendChild(r),t.appendChild(a),t}function Ie(e){var t,o,a,n,r,i,s=e.type,l=e.data,c=document.createElement("div");c.className="chat-message "+s,c.id=l.id||0,$&&((t=document.createElement("span")).className="timestamp",t.textContent=(e=e.offset-V,a=(i=e<(o=0))?-e:e,n=Math.floor(a/3600),r=Math.floor(a%3600/60),a=Math.floor(a%60),i=i?"-":"",n=0<n?i+n.toString().padStart(2,"0")+`:${r.toString().padStart(2,"0")}:`+a.toString().padStart(2,"0"):i+r.toString().padStart(2,"0")+":"+a.toString().padStart(2,"0"),o?n+"."+(e%1).toFixed(o).substring(2):n),c.appendChild(t));let d,u;switch(s){case"msg":u=R(l.user,l.color,l.badges);var h=document.createElement("span"),m=(h.className="chat-text",h.textContent=": ",ke(l.text,l.emotes));if("reply"===(d=l["msg-id"])){var p=oe(T.reply,18,18),v=(p.style.color="var(--timestamp-color)",document.createElement("div")),p=(v.style="display: flex; gap: 5px; margin-bottom: 2px; align-items: center;",v.appendChild(p),l.reply["parent-msg-body"]),p=`Replying to @${l.reply["parent-display-name"]}: `+p;let o=l.reply["parent-msg-id"];var f=document.createElement("a");f.href="#"+o,f.onclick=e=>{e.preventDefault();let t=g.querySelector(`.chat-message[id="${o}"]`);t&&(t.scrollIntoView(),t.style.backgroundColor="rgba(255,255,0,0.3)",setTimeout(()=>t.style.backgroundColor="",200))},f.textContent=p,f.style="color: var(--timestamp-color);",v.appendChild(f),c.appendChild(v)}h.appendChild(m),c.appendChild(u),c.appendChild(h);break;case"monet":if("bits"===(d=l["msg-id"])){c.className="chat-message msg";p=document.createElement("span"),f=(p.className="chat-text",p.textContent=": ",ke(l.text,l.emotes,!0));p.appendChild(f),c.appendChild(R(l.user,l.color,l.badges)),c.appendChild(p)}else{if(!S)return;u=R(l.user,"var(--sub-color)",null);var v=l.user["display-name"]||l.user.login,m=document.createElement("span");m.className="chat-text",m.style.fontSize="0.9rem";let o=l["system-msg"];if(o.startsWith(v)&&(o=o.substring(v.length).trimStart()),"resub"===d||"sub"===d)return o.startsWith("subscribed")&&(o=o.charAt(0).toUpperCase()+o.slice(1)),m.textContent=" "+o,(h=document.createElement("div")).style="display: flex; flex-direction: column; gap: 2px;",f=document.createElement("div"),(v=oe((p="Prime"===l["msg-params"]["sub-plan"])?T.l:T.sub,20,20)).style.color=p?"var(--sub-color)":"var(--game-name-color)",f.style="display: flex; align-items: center; gap: 4px;",m.style.marginLeft="24px",f.appendChild(v),f.appendChild(u),h.appendChild(f),h.appendChild(m),c.appendChild(h),l.text&&((p=document.createElement("div")).style.marginTop="8px",(v=document.createElement("span")).className="chat-text",v.textContent=": ",f=ke(l.text,l.emotes),v.appendChild(f),p.appendChild(R(l.user,l.color,l.badges)),p.appendChild(v),c.appendChild(p)),c;if("submysterygift"===d||"subgift"===d){m.textContent=" "+o;var h=document.createElement("div"),f=(h.style="display: flex; align-items: center; gap: 3px;",u.style.fontWeight="bold",document.createElement("div")),v=document.createElement("span");v.className="chat-text";let e=l["system-msg"];p=l.user["display-name"]||l.user.login;e.startsWith(p)&&(e=e.substring(p.length).trimStart()),v.textContent=" "+e,v.style.fontSize="0.9rem";let t;return"submysterygift"===d?((t=document.createElement("img")).src=ee.src,t.style="height: 45px; width: auto;",u.style.color=l.color||$e(l.user.login),f.style="display: flex; flex-direction: column;"):(t=oe(T.i),u.style.color="var(--text-color)",f.style.marginLeft="4px"),f.appendChild(u),f.appendChild(v),h.appendChild(t),h.appendChild(f),c.appendChild(h),c}m.textContent=" "+o,c.appendChild(u),c.appendChild(m),l.text&&((p=document.createElement("div")).style.marginTop="4px",v=R(l.user,l.color,l.badges),(f=document.createElement("span")).className="chat-text",f.textContent=": ",h=ke(l.text,l.emotes),f.appendChild(h),p.appendChild(v),p.appendChild(f),c.appendChild(p))}break;case"inraid":u=R(l.user,"#ff8b38",l.badges);m=document.createElement("span");m.className="chat-text",m.textContent=` is raiding with a party of ${l["msg-params"].viewerCount} viewers`,c.appendChild(u),c.appendChild(m);break;case"mod":if(!I)return;h=document.createElement("span");if(h.className="chat-text","ban"===l["msg-id"])u=R(l["target-user"],"var(--text-color)",null),c.appendChild(u),h.style.color="var(--text-color)",h.textContent=" was banned",l["ban-duration"]&&(h.textContent+=` for ${l["ban-duration"]} seconds`);else if("clear-msg"===l["msg-id"]){let t=g.querySelector(`.chat-message[id="${l["target-msg-id"]}"]`);if(!t)return;v=t.querySelector(".chat-text"),f=(v&&(v.style.opacity="0.7"),document.createElement("a"));f.href="#"+t.id,f.textContent="message deleted",f.style="cursor: pointer; margin-left: 5px; color: #999;",f.addEventListener("click",e=>{e.preventDefault(),t.scrollIntoView(),t.style.backgroundColor="rgba(255,255,0,0.3)",setTimeout(()=>t.style.backgroundColor="",200)}),h.appendChild(f)}else h.textContent="Moderation action";c.appendChild(h);break;case"poll":case"prediction":p=document.createElement("div");p.style.fontWeight="bold",p.textContent=s.charAt(0).toUpperCase()+s.slice(1)+": ","poll"===s&&l.data&&l.data.poll?p.textContent+=l.data.poll.title||"":"prediction"===s&&l.data&&l.data.event&&(p.textContent+=l.data.event.title||""),c.appendChild(p);break;default:m=document.createElement("span");m.className="chat-text",m.textContent=`[${s}] Event`,c.appendChild(m)}return c}function Se(){if(s&&w){var e=f.currentTime;let t=l;for(;t<b.length&&b[t].offset<=e;)t++;if(t>l){var o=document.createDocumentFragment();for(let e=l;e<t;e++){var a=Ie(b[e]);a&&o.appendChild(a)}var n,r=g.scrollHeight-g.clientHeight<=g.scrollTop+100,i=(g.appendChild(o),l=t,g.children);i.length>x&&((n=document.createRange()).setStart(g,0),n.setEnd(g,i.length-x),n.deleteContents()),(r?Oe:He)()}}}function Be(){l=l>=x?l-x:0,g.innerHTML="",Se()}function Pe(){let o=document.querySelector(".container"),a=document.getElementById("resize-handle"),n,r,i,s=!1;var e;function t(e){s=!0;var t=e.touches[0];n=t.clientX,r=h.offsetWidth,i=o.offsetWidth,document.addEventListener("touchmove",c,{passive:!1}),document.addEventListener("touchend",u),document.addEventListener("touchcancel",u),a.classList.add("active"),document.body.style.userSelect="none",e.preventDefault()}function l(e){s&&(e=e.clientX-n,e=Math.max(200,Math.min(i-200,r-e)),h.style.width=e+"px")}function c(e){var t;s&&(t=e.touches[0].clientX-n,t=Math.max(200,Math.min(i-200,r-t)),h.style.width=t+"px",e.preventDefault())}function d(){s&&(s=!1,document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",d),a.classList.remove("active"),document.body.style.userSelect="")}function u(){s&&(s=!1,document.removeEventListener("touchmove",c),document.removeEventListener("touchend",u),document.removeEventListener("touchcancel",u),a.classList.remove("active"),document.body.style.userSelect="")}j&&((e=document.createElement("div")).style.cssText=` position: absolute; top: -15px; bottom: -15px; left: -15px; right: -15px; z-index: 1; touch-action: none; `,a.style.position="relative",a.appendChild(e),e.addEventListener("touchstart",t,{passive:!1})),a.addEventListener("mousedown",function(e){s=!0,n=e.clientX,r=h.offsetWidth,i=o.offsetWidth,document.addEventListener("mousemove",l),document.addEventListener("mouseup",d),a.classList.add("active"),document.body.style.userSelect="none",e.preventDefault()}),a.addEventListener("touchstart",t,{passive:!1})}function Ae(){var e,t;f.paused||(t=(t=>{let o=1/0;var a=d.titles,n=d.games;if(a&&a.length)for(let e=0;e<a.length;e++){var[r,,]=a[e];t<r&&r<o&&(o=r)}if(n&&n.length)for(let e=0;e<n.length;e++){var[i,,]=n[e];t<i&&i<o&&(o=i)}return o===1/0?null:o})(e=f.currentTime),r.t&&(clearTimeout(r.t),r.t=null),t&&(t=1e3*(t-e)/f.playbackRate+50,r.t=setTimeout(()=>{c(),Ae()},t)))}function Fe(){if(!f.paused){var o,a,n=f.currentTime;a=n;let[e,t]=(o=d.viewers)&&o.length?0<=(a=Te(a))&&a<o.length-1?[a+1,o[a+1][0]]:[0,o[0][0]]:null;r.viewers&&(clearTimeout(r.viewers),r.viewers=null),t&&(a=1e3*(t-n)/f.playbackRate,r.viewers=setTimeout(()=>{i(index=e),Fe()},a))}}function Ce(){Ae(),Fe(),function e(){f.paused||(r.o&&(clearTimeout(r.o),r.o=null),r.o=setTimeout(()=>{pe(),e()},800*K))}()}function n(){for(var e in r)r[e]&&(clearTimeout(r[e]),r[e]=null)}function Te(o){var a=d.viewers;if(!a.length||o<a[0][0])return-1;var n,r,e=Math.floor(o/30),i=Math.max(0,e-3),s=Math.min(a.length-1,e+3);let l=-1,c=-1;for(let e=i;e<=s;e++){var[t,,]=a[e];t<=o&&t>c&&(c=t,l=e)}if(-1===l)for(let e=0,t=a.length;e<t;e++)e>=i&&e<=s||([n,r]=a[e],n<=o&&n>c&&(c=n,l=e));return l}function i(e=null){e=e||Te(f.currentTime),e=0<=e?d.viewers[e][1]:0;H.textContent=e.toLocaleString()}function c(){var o=Math.ceil(f.currentTime),a=d.titles,n=d.games;if(a&&a.length){let t=a[0][1];for(let e=a.length-1;0<=e;e--){var[r,i]=a[e];if(r<=o){t=i;break}}document.querySelector(".stream-title").textContent=t,document.title=t+" - "+J.displayName}if(n&&n.length){let t=n[0][1]||"";for(let e=n.length-1;0<=e;e--){var[s,l]=n[e];if(s<=o){t="object"==typeof l?l.name:l;break}}document.getElementById("game-name").textContent=t}}function ze(e){document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),document.getElementById("moon-icon").style.display="light"===e?"none":"block",document.getElementById("sun-icon").style.display="light"===e?"block":"none"}function Ee(){ze("light"===(localStorage.getItem("theme")||"light")?"dark":"light")}function Re(e){let c=e.id.toString();var d=e.login.toString(),e=e["display-name"]||d,d=document.getElementById("user-chat-window-"+c);if(!d){let r=document.createElement("div");r.id="user-chat-window-"+c,r.className="popout";d=document.createElement("div"),e=(d.style.cssText=` padding: 5px; cursor: move; background-color: var(--panel-border); color: var(--text-color); border-bottom: 1px solid var(--panel-border); display: flex; justify-content: space-between; align-items: center; z-index: 11; `,d.textContent="Chat History for "+e,document.createElement("button"));e.textContent="X",e.style.cssText=` background: none; border: none; color: var(--text-color); cursor: pointer; padding: 0 5px; `,e.onclick=()=>{r.remove()},e.ontouchend=()=>r.remove(),d.appendChild(e),r.appendChild(d);let o=document.createElement("div"),a=(o.style.cssText=` flex-grow: 1; overflow-y: auto; padding: 5px; background-color: var(--panel-bg); `,r.appendChild(o),document.createElement("button")),i=(a.textContent="Load All Messages",a.style.cssText=` width: 100%; padding: 8px; background-color: var(--panel-border); color: var(--text-color); border: none; cursor: pointer; `,r.appendChild(a),document.body.appendChild(r),d.offsetHeight),t=!1,n,s,l=(d.onmousedown=e=>{t=!0,n=e.clientX-r.offsetLeft,s=e.clientY-r.offsetTop,e.preventDefault(),document.onmousemove=e=>{t&&(e=p(e.clientX-n,e.clientY-s),r.style.left=e.x+"px",r.style.top=e.y+"px")},document.onmouseup=()=>{t=!1,document.onmousemove=null,document.onmouseup=null}},d.addEventListener("touchstart",e=>{e.preventDefault(),t=!0;e=e.touches[0];n=e.clientX-r.offsetLeft,s=e.clientY-r.offsetTop},{passive:!1}),document.addEventListener("touchmove",e=>{t&&(e.preventDefault(),e=p((e=e.touches[0]).clientX-n,e.clientY-s),r.style.left=e.x+"px",r.style.top=e.y+"px")},{passive:!1}),document.addEventListener("touchend",()=>{t=!1},{passive:!1}),window.addEventListener("resize",()=>{var e=r.getBoundingClientRect(),e=p(e.left,e.top);r.style.left=e.x+"px",r.style.top=e.y+"px"}),0);a.onclick=function(){for(var e=document.createDocumentFragment();l<w;){var t=v();t&&e.appendChild(t),l++}a.remove(),o.appendChild(e)};for(var u=f.currentTime+V,h=document.createDocumentFragment();l<w&&b[l].offset<=u;){var m=v();m&&h.appendChild(m),l++}function p(e,t){var o=r.getBoundingClientRect(),a=window.innerWidth,n=window.innerHeight,a=a-o.width,o=Math.max(0,Math.min(a,e)),a=n-i;return{x:o,y:Math.max(0,Math.min(a,t))}}function v(){var e=b[l],t=e.data.user||e.data["target-user"];if(t&&t.id==c)return Ie(e)}o.appendChild(h),o.scrollTop=o.scrollHeight}}function De(){var t=prompt("Enter username for chatlog history:");if(t){var o=t.toLowerCase();for(let e=0;e<w;e++){var a=b[e];if(a.data.user&&(a.data.user.login===o||a.data.user["display-name"]===t))return void Re(a.data.user)}}}function Le(){var e=document.getElementById("message-borders-style")||document.createElement("style");e.id="message-borders-style",P?e.textContent="":e.textContent=".chat-message { border-bottom: none !important; }",e.parentNode||document.head.appendChild(e)}function Ne(){let t=document.createElement("div"),a=(t.className="modal",document.createElement("div")),n=(a.className="settings-panel",a.innerHTML=` <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;"><h2 style="margin: 0; color: var(--text-color);">Settings</h2><button id="settings-close" style="background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-color);">&times;</button></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Emoji Resolution (1-3): <span id="emote-res-value">${A}</span></label><input type="range" id="emote-res" min="1" max="3" value="${A}" style="width: 100%;"><button id="preload-emotes" style="margin-top: 5px; padding: 5px 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Preload Emotes</button></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Bits Resolution (1-4): <span id="bits-res-value">${F}</span></label><input type="range" id="bits-res" min="1" max="4" value="${F}" style="width: 100%;"><button id="preload-bits" style="margin-top: 5px; padding: 5px 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Preload Bits</button></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Badges Resolution: <span id="badges-res-value">${k}</span></label><select id="badges-res" style="width: 100%; padding: 5px; background-color: var(--bg-color); border: 1px solid var(--panel-border); color: var(--text-color); border-radius: 4px;"><option value="1" ${1===k?"selected":""}>1x</option><option value="2" ${2===k?"selected":""}>2x</option><option value="4" ${4===k?"selected":""}>4x</option></select><button id="preload-badges" style="margin-top: 5px; padding: 5px 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Preload Badges</button></div><div style="margin-bottom: 15px;"><button id="preload-all" style="width: 100%; padding: 10px; background-color: var(--accent-color); border: none; border-radius: 4px; color: white; cursor: pointer; font-weight: bold;">Preload All Assets</button></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Chat History Buffer (50-1000): <span id="history-value">${x}</span></label><input type="range" id="chat-history" min="50" max="1000" step="10" value="${x}" style="width: 100%;"></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Chat Update Speed (10-1000ms): <span id="update-speed-value">${v}</span>ms</label><input type="range" id="chat-update-speed" min="10" max="1000" step="10" value="${v}" style="width: 100%;"></div><div style="margin-bottom: 15px;"><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-timestamps" ${$?"checked":""} style="margin-right: 8px;"> Show message timestamps </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-badges" ${B?"checked":""} style="margin-right: 8px;"> Show user badges </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-sub-messages" ${S?"checked":""} style="margin-right: 8px;"> Show gifted subscriptions, subscription messages </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-ban-messages" ${I?"checked":""} style="margin-right: 8px;"> Show moderation messages </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-message-borders" ${P?"checked":""} style="margin-right: 8px;"> Show message borders </label></div><div style="display: flex; gap: 10px; margin-top: 20px;"><button id="settings-save" style="flex: 1; padding: 10px; background-color: var(--accent-color); border: none; border-radius: 4px; color: white; cursor: pointer; font-weight: bold;">Save & Close</button><button id="settings-cancel" style="flex: 1; padding: 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Cancel</button></div> `,t.appendChild(a),document.body.appendChild(t),a.querySelector("#emote-res")),e=a.querySelector("#emote-res-value"),r=(n.addEventListener("input",()=>{e.textContent=n.value}),a.querySelector("#bits-res")),o=a.querySelector("#bits-res-value"),i=(r.addEventListener("input",()=>{o.textContent=r.value}),a.querySelector("#badges-res")),s=a.querySelector("#badges-res-value"),l=(i.addEventListener("change",()=>{s.textContent=i.value}),a.querySelector("#chat-history")),c=a.querySelector("#history-value"),d=(l.addEventListener("input",()=>{c.textContent=l.value}),a.querySelector("#chat-update-speed")),u=a.querySelector("#update-speed-value"),h=(d.addEventListener("input",()=>{u.textContent=d.value}),ye(a,"#preload-emotes",we),ye(a,"#preload-bits",fe),ye(a,"#preload-badges",ge),ye(a,"#preload-all",xe),()=>t.remove());a.querySelector("#settings-close").addEventListener("click",h),a.querySelector("#settings-cancel").addEventListener("click",h),t.addEventListener("click",e=>{e.target===t&&h()}),a.querySelector("#settings-save").addEventListener("click",()=>{A=parseInt(n.value),F=parseInt(r.value);var e=parseInt(i.value),t=(x=parseInt(l.value),parseInt(d.value)),o=($=a.querySelector("#show-timestamps").checked,B=a.querySelector("#show-badges").checked,S=a.querySelector("#show-sub-messages").checked,I=a.querySelector("#show-ban-messages").checked,a.querySelector("#show-message-borders").checked);k!==e&&(k=e,M=`image${k}x`),t!==v&&(v=t,clearInterval(U),U=setInterval(()=>{f.paused||Se()},v)),o!==P&&(P=o,Le()),e={emoteRes:A,bitsRes:F,badgesRes:k,chatHistoryLength:x,chatUpdateInterval:v,showMessageTimestamp:$,showUserBadges:B,showSubMessages:S,showBanMessages:I,showMessageBorders:P},localStorage.setItem("settings",JSON.stringify(e)),h(),Be()})}function Oe(){o&&o.disconnect(),(o=new MutationObserver(()=>{g.scrollTop=g.scrollHeight,o.disconnect(),o=null})).observe(g,{childList:!0,subtree:!0}),g.scrollTop=g.scrollHeight,setTimeout(()=>{o&&(o.disconnect(),o=null),g.scrollTop=g.scrollHeight},v)}function He(){var e=g.scrollHeight-g.clientHeight<=g.scrollTop+100;a.style.display=e?"none":"block"}function je(){var e=Math.floor(f.currentTime),t=new URL(window.location);t.searchParams.set("t",(e=>{var t=3600<e?Math.floor(e/3600):0,o=60<e?Math.floor(e%3600/60):0;let a="";return 0<t&&(a+=t+"h"),(0<o||0<t)&&(a+=o+"m"),a+=e%60+"s"})(e)),window.history.replaceState({},"",t.toString())}function Ue(){var e=new URL(window.location).searchParams.get("t");e&&(f.currentTime=/^\d+$/.test(e=e)?parseInt(e):3600*((e=e.match(/(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s)?/))[1]?parseInt(e[1]):0)+60*(e[2]?parseInt(e[2]):0)+(e[3]?parseInt(e[3]):0))}document.addEventListener("DOMContentLoaded",async()=>{document.getElementById("settings-btn").addEventListener("click",Ne),document.getElementById("theme-toggle-btn").addEventListener("click",Ee),document.getElementById("report-btn").addEventListener("click",()=>{window.open("https://github.com/sputchik/sputchik.github.io/issues/new","_blank")}),Pe();var e,t=localStorage.getItem("settings");if(t)try{"emoteRes"in(t=JSON.parse(t))&&(A=t.emoteRes),"bitsRes"in t&&(F=t.bitsRes),"badgesRes"in t&&(k=t.badgesRes),"chatHistoryLength"in t&&(x=t.chatHistoryLength),"chatUpdateInterval"in t&&(v=t.chatUpdateInterval),"showMessageTimestamp"in t&&($=t.showMessageTimestamp),"showUserBadges"in t&&(B=t.showUserBadges),"showSubMessages"in t&&(S=t.showSubMessages),"showBanMessages"in t&&(I=t.showBanMessages),"showMessageBorders"in t&&(P=t.showMessageBorders),M=`image${k}x`,P||Le()}catch(e){console.error("Failed to load settings:",e)}for(e of["beforeunload","unload","pagehide"])window.addEventListener(e,()=>{je()});await Promise.all([(async()=>{if(!s){console.log("Looking for cached chat for stream:",y);var t=async()=>{console.log("Falling back to uncompressed chat log...");var e=fetch(N).then(e=>e.json()).then(e=>{d=e,J=e.owner,c(),i()}),[,e]=await Promise.all([e,fetch(L)]);b=await e.json()},e=await ce.get(y);if(e instanceof Blob)[d,b]=await de(e),console.log("Chat loaded from IndexedDB cache");else{console.log("No cached chat found, trying compressed chat log first...");try{var o,a,n=await fetch(O);200===n.status&&(a=await de(o=await n.blob()))instanceof Array?([d,b]=a,await ce.set(y,o),console.log("Chat cached in IndexedDB for future use")):await t()}catch(e){console.warn("Failed to fetch compressed chat log:",e),await t()}if(!Array.isArray(b))return void console.error("Failed to load chat log from any source")}s=!0,w=b.length,J=d.owner,console.log("Chat loaded with",w,"messages"),c(),i()}})(),(async()=>{var e=await E.add(le.g.h());if(e.errors)throw new z(e.errors);var t=e.badges;let o=t.length;for(;o--;){var a=t[o];u.set(""+a.setID+a.version,a)}})(),(async()=>{var e=await E.add(le.v.h({channelLogin:D}));if(e.errors)throw new z(e.errors);var t=e.user.broadcastBadges;let o=t.length;for(;o--;){var a=t[o];C.set(""+a.setID+a.version,a)}})(),(async()=>{var e=await E.add(le.m.h());if(e.errors)throw new z(e.errors);var t=e.cheerConfig.groups[0],o=e.cheerConfig.displayConfig.colors;G=t.templateURL;for(let e=0;e<o.length;e++){var a=o[e];X.set(a.bits,a.color)}for(let e=0;e<t.nodes.length;e++){var n=t.nodes[e];if("DISPLAY_ONLY"!==n.type){_.add(n.prefix);var r=new Array;for(let e=0;e<n.tiers.length;e++)r.push(n.tiers[e].bits);var i=n.prefix.toLowerCase();m.set(i,r)}}e=Array.from(_).join("|"),p=new RegExp(`(?:^|\\s)(${e})(\\d+)(?=\\s|$)`,"gi")})(),(async()=>{var e=await E.add(le.p.h({channelLogin:D,skipSchedule:!0,includeIsDJ:!1}));if(e.errors)throw new z(e.errors);(q=e.user.primaryColorHex)&&((e=document.createElement("style")).id="channel-color-style",e.textContent=`.chat-message.monet { border-left-color: #${q} !important; }`,e.parentNode||document.head.appendChild(e))})()]),document.getElementById("chatlog-btn").addEventListener("click",De),U=setInterval(()=>{f.paused||Se()},v),f.addEventListener("play",()=>{n(),Ce(),g.scrollHeight-g.clientHeight>=g.scrollTop+100&&Oe()}),f.addEventListener("pause",()=>{je(),n()}),f.addEventListener("ratechange",()=>{f.paused||(n(),Ce())}),f.addEventListener("seeking",()=>{n(),c(),i()}),f.addEventListener("seeked",()=>{n(),je(),l=(t=>{var o=t/f.duration,o=Math.floor(w*o);if(t>f.duration)return w-1;if(b[o].offset<t){for(let e=o;e<w;e++)if(b[e].offset>t)return e-1}else for(let e=o;0<=e;e--)if(b[e].offset<t)return e;return 0})(f.currentTime),i(),c(),Ce(),pe(),Be()}),f.addEventListener("loadedmetadata",()=>{pe(),Ue()})});</script>