<!doctypehtml><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Twitch VOD Viewer</title><style>:root{--bg-color:#f8f8f8;--scrollbar-bg:#f0f0f0;--scrollbar-thumb:#c1c1c1;--scrollbar-thumb-hover:#a1a1a1;--text-color:#333;--panel-bg:#fff;--panel-border:#ddd;--chat-border:#eee;--timestamp-color:#999;--game-name-color:#555;--resize-handle:#ddd;--resize-handle-hover:#6441a5;--chat-header-bg:#f4f4f4;--viewer-icon-color:#971311}[data-theme=dark]{--bg-color:#000000;--scrollbar-bg:#000000;--scrollbar-thumb:#222222;--scrollbar-thumb-hover:#6441a5;--text-color:#e5e5e5;--panel-bg:#0f0f0f;--panel-border:#333;--chat-border:#333;--timestamp-color:#888;--game-name-color:#aaa;--resize-handle:#333333;--resize-handle-hover:#6441a5;--chat-header-bg:#000000;--viewer-icon-color:#ff6b68}*{scrollbar-width:thin;scrollbar-color:var(--scrollbar-thumb) var(--scrollbar-bg)}a{color:inherit;text-decoration:none}a:focus,a:hover{text-decoration:underline}body{font-family:Arial,sans-serif;font-size:15px;margin:0;padding:0;background:var(--bg-color);color:var(--text-color);overflow-y:hidden}.container{display:flex;flex-direction:row;max-width:100%;height:100dvh}.left-panel{flex:1;min-width:0;padding:15px;display:flex;flex-direction:column;height:100%;overflow-y:auto}.video-container{position:relative;width:100%;padding-top:56.25%;background:#000}#video-player{position:absolute;top:0;left:0;width:100%;height:100%}.stream-info{margin-top:12px;padding:8px;padding-top:12px;background:var(--panel-bg);border-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,.1)}.stream-info-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.stream-title{margin:0;font-size:1.2em}.game-name{color:var(--game-name-color);font-size:.9em;margin-top:3px}.viewers-count{font-weight:700;margin-right:15px;display:flex;align-items:center}.chat-toggle{background:var(--panel-bg);color:var(--text-color);border:1px solid var(--panel-border);border-radius:4px;padding:8px 15px;cursor:pointer;font-weight:700}.description{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:15px;margin-top:15px;padding:15px;background:var(--panel-bg);border-radius:4px;box-shadow:0 1px 3px rgba(0,0,0,.1);overflow-wrap:break-word}.chat-panel{resize:horizontal;min-width:200px;width:380px;background:var(--panel-bg);border-left:1px solid var(--panel-border);display:flex;flex-direction:column;padding-bottom:env(safe-area-inset-bottom);padding-top:env(safe-area-inset-top);position:relative}.chat-header{padding:5px 9px;border-bottom:1px solid var(--panel-border);font-weight:700;background:var(--chat-header-bg);display:flex;justify-content:space-between;align-items:center}.chat-header-btn{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;color:var(--text-color)}.chat-messages{overflow-y:scroll;padding:10px}.chat-message{padding:5px 0;border-bottom:1px solid var(--chat-border)}.chat-username{font-weight:700}.chat-text{word-break:break-word}.timestamp{color:var(--timestamp-color);font-size:.8em;margin-right:5px}.monet,.poll,.prediction{background-color:var(--panel-bg);border-left:3px solid #6441a5;padding-left:5px}.inraid{background-color:#ffad000f;border-left:3px solid #ff9e27;padding-left:5px}.mod{background-color:#ff00000a;border-left:3px solid red;padding-left:5px;font-style:italic}@media (orientation:portrait){.container{position:relative;display:grid;grid-template-areas:"video" "info" "chat";grid-template-rows:auto auto 1fr;height:100dvh}.left-panel{display:contents;height:auto;padding:10px}.video-container{grid-area:video}.stream-info{grid-area:info;margin-bottom:0}#chat-panel{grid-area:chat;position:relative;width:100%;border-left:none;overflow-y:auto;padding-bottom:env(safe-area-inset-bottom)}.description{position:absolute;top:100dvh;left:0;right:0}#resize-handle{display:none}}.resize-handle{width:5px;background-color:var(--resize-handle);cursor:col-resize;transition:background-color .2s}.resize-handle.active,.resize-handle:hover{background-color:var(--resize-handle-hover)}.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center}.settings-panel{background:var(--panel-bg);border:1px solid var(--panel-border);border-radius:4px;padding:20px;width:40%;min-width:400px;height:75%;overflow-y:auto;color:var(--text-color);box-shadow:0 1px 3px rgba(0,0,0,.1)}</style><div class=container><div class=left-panel><div class=video-container><video id=video-player webkit-playsinline=true playsinline=true controls preload=auto>Your browser does not support the video tag.</video></div><div class=stream-info><div class=stream-info-header><div><h1 class=stream-title id=stream-title>Loading...</h1><div class=game-name id=game-name>Loading...</div></div><div style=display:flex;align-items:center><span class=viewers-count style=gap:3px;display:flex;align-items:center;color:var(--viewer-icon-color)><svg width=20 height=20 viewBox="0 0 20 20"aria-hidden=true><path fill=currentColor fill-rule=evenodd d="M5 7a5 5 0 1 1 6.192 4.857A2 2 0 0 0 13 13h1a3 3 0 0 1 3 3v2h-2v-2a1 1 0 0 0-1-1h-1a3.99 3.99 0 0 1-3-1.354A3.99 3.99 0 0 1 7 15H6a1 1 0 0 0-1 1v2H3v-2a3 3 0 0 1 3-3h1a2 2 0 0 0 1.808-1.143A5.002 5.002 0 0 1 5 7zm5 3a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"clip-rule=evenodd></path></svg><span id=viewer-count>0</span></span><button class=chat-toggle id=toggle-chat-btn>Toggle Chat</button><button class=theme-toggle id=theme-toggle-btn style="margin-left:8px;background:var(--panel-bg);color:var(--text-color);border:1px solid var(--panel-border);border-radius:4px;padding:8px 15px;cursor:pointer"><svg id=theme-icon width=16 height=16 viewBox="0 0 24 24"style=vertical-align:text-bottom><path id=moon-icon fill=currentColor d="M21.53 15.93c-.16-.27-.61-.69-1.73-.49a8.46 8.46 0 01-1.88.13 8.409 8.409 0 01-5.91-2.82 8.068 8.068 0 01-1.44-8.66c.44-1.01.13-1.54-.09-1.76s-.77-.55-1.83-.11a10.318 10.318 0 00-6.32 10.21 10.475 10.475 0 007.04 8.99 10 10 0 002.89.55c.16.01.32.02.48.02a10.5 10.5 0 008.47-4.27c.67-.93.49-1.519.32-1.79z"style=display:none /><path id=sun-icon fill=currentColor d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 000-1.41l-1.06-1.06zm1.06-10.96a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/></svg></button></div></div></div><div class=description id=description-container style=display:none><details><summary></summary><div id=description-content>Loading...</div></details></div></div><div class=resize-handle id=resize-handle></div><div class=chat-panel id=chat-panel><div class=chat-header><span>Live Chat (WORK IN PROGRESS)</span><div style=display:flex;gap:5px><button class=chat-header-btn title="Open user ChatLog by username"id=chatlog-btn><svg width=20 height=20 viewBox="0 0 24 24"><path fill=none d="M18.5 19.5L20 21M11 14C7.13401 14 4 17.134 4 21H11M19 17.5C19 18.8807 17.8807 20 16.5 20C15.1193 20 14 18.8807 14 17.5C14 16.1193 15.1193 15 16.5 15C17.8807 15 19 16.1193 19 17.5ZM15 7C15 9.20914 13.2091 11 11 11C8.79086 11 7 9.20914 7 7C7 4.79086 8.79086 3 11 3C13.2091 3 15 4.79086 15 7Z"stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round /></svg></button><button class=chat-header-btn title="Open Settings"id=settings-btn><svg width=20 height=20 viewBox="0 0 20 20"style=color:var(--text-color)><path fill=currentColor d="M10 8a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"></path><path fill=currentColor fill-rule=evenodd d="M9 2h2a2.01 2.01 0 0 0 1.235 1.855l.53.22a2.01 2.01 0 0 0 2.185-.439l1.414 1.414a2.01 2.01 0 0 0-.439 2.185l.22.53A2.01 2.01 0 0 0 18 9v2a2.01 2.01 0 0 0-1.855 1.235l-.22.53a2.01 2.01 0 0 0 .44 2.185l-1.415 1.414a2.01 2.01 0 0 0-2.184-.439l-.531.22A2.01 2.01 0 0 0 11 18H9a2.01 2.01 0 0 0-1.235-1.854l-.53-.22a2.009 2.009 0 0 0-2.185.438L3.636 14.95a2.009 2.009 0 0 0 .438-2.184l-.22-.531A2.01 2.01 0 0 0 2 11V9c.809 0 1.545-.487 1.854-1.235l.22-.53a2.009 2.009 0 0 0-.438-2.185L5.05 3.636a2.01 2.01 0 0 0 2.185.438l.53-.22A2.01 2.01 0 0 0 9 2zm-4 8 1.464 3.536L10 15l3.535-1.464L15 10l-1.465-3.536L10 5 6.464 6.464 5 10z"clip-rule=evenodd></path></svg></button></div></div><div class=chat-messages id=chat-messages></div></div></div><script>let streamMetadata=null;var e=new URLSearchParams(window.location.search).get("id");e||window.location.replace("https://archive.org/details/@sputchik?sort=-date");let[R,,w]=e.split("-"),L=(e=`https://archive.org/download/${e}/`)+w+".json",O=e+w+"-metadata.json";var P=e+w+".mp4";let H=`https://corsproxy.io/?url=${e}${w}.tar.gz`,p=document.getElementById("video-player"),l=document.getElementById("chat-panel"),m=document.getElementById("chat-messages"),U=document.getElementById("viewer-count"),j=(p.src=P,Le(localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>{Le(e.matches?"dark":"light")})),0),V=null,h=[],g=0,s=!1,c=0,J=null,G=new Set,X=new Map,_=new Map,q=new Map,f=null,K=null,v=100,b=250,x=4,y=`image${x}x`,M=!0,k=!0,$=!0,S=!0,B=3,I=4,d=new Map,u=new Map;new Map;let Q=new Set,Y=new Set;new Set(["msg","monet","inraid","mod","misc"]);let W=new Map,Z=["#FF0000","#0000FF","#008000","#B22222","#FF7F50","#9ACD32","#FF4500","#2E8B57","#DAA520","#D2691E","#5F9EA0","#1E90FF","#FF69B4","#8A2BE2","#00FF7F"],ee='<path fill="currentColor" fill-rule="evenodd" d="M16 6h2v6h-1v6H3v-6H2V6h2V4.793c0-2.507 3.03-3.762 4.803-1.99.131.131.249.275.352.429L10 4.5l.845-1.268a2.81 2.81 0 0 1 .352-.429C12.969 1.031 16 2.286 16 4.793V6zM6 4.793V6h2.596L7.49 4.341A.814.814 0 0 0 6 4.793zm8 0V6h-2.596l1.106-1.659a.814.814 0 0 1 1.49.451zM16 8v2h-5V8h5zm-1 8v-4h-4v4h4zM9 8v2H4V8h5zm0 4H5v4h4v-4z" clip-rule="evenodd"></path>',te='<path fill="currentColor" d="M11 8h2v2h-2V8zM9 8H7v2h2V8z"></path><path fill="currentColor" fill-rule="evenodd" d="m10 18-3-3H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2l-3 3zm-2.172-5L10 15.172 12.172 13H15V5H5v8h2.828z" clip-rule="evenodd"></path>';function ae(e,t=20,n=20){var a=document.createElementNS("http://www.w3.org/2000/svg","svg");return a.setAttribute("width",t),a.setAttribute("height",n),a.setAttribute("viewBox",`0 0 ${t} `+n),a.style.color="var(--text-color)",a.style=`min-height: ${n}px; min-width: ${t}px;`,a.innerHTML=e,a}let oe=new Image,re=(oe.src="https://static-cdn.jtvnw.net/subs-image-assets/gift-illus.png","VODArchiverCache"),i="chatLogs",ne="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=document.createElement("button"),a=(t.textContent="▼ Scroll to Bottom",t.style.cssText="position: absolute; bottom: 4%; left: 50%; transform: translateX(-50%); display: none; z-index: 3; width: 50%; height: fit-content; min-height: 33px; border-radius: 8px; border-color: var(--panel-border); background-color: var(--bg-color); color: var(--text-color);",t.addEventListener("click",(()=>{m.scrollTop=m.scrollHeight})),l.appendChild(t),m.addEventListener("scroll",se),null);function ie(){a&&a.disconnect(),(a=new MutationObserver((()=>{m.scrollTop=m.scrollHeight,a.disconnect(),a=null}))).observe(m,{childList:!0,subtree:!0}),m.scrollTop=m.scrollHeight,setTimeout((()=>{a&&(a.disconnect(),a=null),m.scrollTop=m.scrollHeight}),v)}function se(){var e=m.scrollHeight-m.clientHeight<=m.scrollTop+100;t.style.display=e?"none":"block"}class le{constructor(e,t){this.operationName=e,this.sha256Hash=t,this.extensions={persistedQuery:{version:1,sha256Hash:this.sha256Hash}}}t(e={}){return{operationName:this.operationName,extensions:this.extensions,variables:e}}}class ce extends le{constructor(){super("BitsConfigContext_Global","6a265b86f3be1c8d11bdcf32c183e106028c6171e985cc2584d15f7840f5fee6")}}class de extends le{constructor(){super("ChatList_Badges","838a7e0b47c09cac05f93ff081a9ff4f876b68f7624f0fc465fe30031e372fc2")}}class ue extends le{constructor(){super("GlobalBadges","9db27e18d61ee393ccfdec8c7d90f14f9a11266298c2e5eb808550b77d7bcdf6")}}let me=new class{o=new ce;i=new de;l=new ue};class C extends Error{constructor(e){super("string"==typeof e?e:JSON.stringify(e)),this.name="RequestError",this.u=e}}class pe{constructor(e=30,t=35,n=3e3){this.m=e,this.p=t,this.h=n,this.g=[],this.total=0,this.v=0,this.M=null,this.endpoint="https://gql.twitch.tv/gql",this.headers={"Client-ID":"kimne78kx3ncx6brgo4mv6wki5h1ko","Device-Id":Array(32).fill(0).map((()=>ne.charAt(Math.floor(Math.random()*ne.length)))).join(""),"Accept-Language":"en-US"}}async add(e,t=10){for(;0<=t;){let o,l;var n=new Promise(((e,t)=>{o=e,l=t})),a=(this.g.push({k:e,resolve:o,reject:l}),this.g.length),r=Date.now();1===a?(this.v=r,this.$=setTimeout((()=>{this.S(),this.m}))):(a>=this.p||r-this.v>=this.m)&&(this.M&&(clearTimeout(this.M),this.M=null),this.S());try{return await n}catch(n){if(--t<0)throw a=e.operationName||"unknown",new Error(`Failed to execute operation "${a}" after retries: `+n.message)}}}async S(){if(this.g.length){var e=this.g,t=(this.g=[],this.M&&(clearTimeout(this.M),this.M=null),e.length);this.total+=t;try{console.debug(`Collecting ${t} promises...`);var n=JSON.stringify(e.map((e=>e.k))),a=this.B(n.length),r=Date.now();let g=new AbortController;var o=setTimeout((()=>g.abort()),this.h),l=await fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json",...this.headers},body:n,signal:g.signal});if(clearTimeout(o),!l.ok)throw new Error(`Invalid response status (${l.status})`);var s=await l.text(),i=this.B(s.length),d=JSON.parse(s),c=((Date.now()-r)/1e3).toFixed(2);console.debug(`Collected ${t} promise(s) (${a}) in ${c}s (${i}). Total: `+this.total);for(let t=0;t<e.length;t++){var p,m,u=e[t],h=d[t];h.errors?(p=new C(h.errors),m=u.k.operationName||"Unknown",console.warn(`[${m}] Operation error: `+JSON.stringify(h.errors)),u.reject(p)):u.resolve(h.data||h)}}catch(t){console.error(`Error collecting ${e.length} promises: `+t.message);for(let n=0;n<e.length;n++)e[n].reject(new C(t))}}}B(e){return e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB"}}let he=new pe;function ge(e,t=0){var n=(o=e<0)?-e:e,a=Math.floor(n/3600),r=Math.floor(n%3600/60),o=(n=Math.floor(n%60),o?"-":"");a=0<a?o+a.toString().padStart(2,"0")+`:${r.toString().padStart(2,"0")}:`+n.toString().padStart(2,"0"):o+r.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0");return t?a+"."+(e%1).toFixed(t).substring(2):a}function fe(){return new Promise(((e,t)=>{let n=indexedDB.open(re,1);n.onerror=()=>t(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=e=>{(e=e.target.result).objectStoreNames.contains(i)||e.createObjectStore(i,{keyPath:"id"})}}))}async function ve(e){try{var t=e.stream(),n=new DecompressionStream("gzip"),a=t.pipeThrough(n),r=await new Response(a).arrayBuffer(),o=new Uint8Array(r),l={};let y=0;for(;y+512<=o.byteLength;){var s=o.slice(y,y+512),i=s.slice(0,100);let e="";for(let t=0;t<i.length&&0!==i[t];t++)e+=String.fromCharCode(i[t]);if(e.includes("@PaxHeader")){var d=s.slice(124,136);let e="";for(let t=0;t<d.length&&0!==d[t];t++)e+=String.fromCharCode(d[t]);var c=parseInt(e.trim(),8)||0;y+=512+512*Math.ceil(c/512)}else{var p=s.slice(124,136);let t="";for(let e=0;e<p.length&&0!==p[e];e++)t+=String.fromCharCode(p[e]);var m,u,h,g,v=parseInt(t.trim(),8)||0;console.log("Found file:",e,"size:",v),0<v&&(m=y+512,u=o.slice(m,m+v),h=new TextDecoder("utf-8").decode(u),g=JSON.parse(h),l[e]=g),y+=512+(0<v?512*Math.ceil(v/512):0)}}var f=w+"-metadata.json",b=w+".json";return l[f]&&l[b]?[l[f],l[b]]:(console.error("No target files found in tar:",l),null)}catch(e){return console.error("Failed to parse compressed chat log:",e),null}}async function be(){if(!s){console.log("Looking for cached chat for stream:",w);var e=async()=>{console.log("Falling back to uncompressed chat log...");var[e,t]=await Promise.all([fetch(O),fetch(L)]);h=await t.json(),streamMetadata=await e.json()},t=await(async e=>{try{let t=(await fe()).transaction([i],"readonly").objectStore(i);return new Promise(((n,a)=>{let r=t.get(e);r.onerror=()=>a(r.error),r.onsuccess=()=>{r.result&&r.result.I?n(r.result.I):n(null)}}))}catch(e){return console.warn("IndexedDB not available, falling back to server fetch:",e),null}})(w);if(t instanceof Blob)[streamMetadata,h]=await ve(t),console.log("Chat loaded from IndexedDB cache");else{console.log("No cached chat found, trying compressed chat log first...");try{var n,a,r=await fetch(H);200===r.status&&(a=await ve(n=await r.blob()))instanceof Array?([streamMetadata,h]=a,await(async(e,t)=>{try{let n=(await fe()).transaction([i],"readwrite").objectStore(i);return new Promise(((a,r)=>{let o=n.put({id:e,I:t,timestamp:Date.now()});o.onerror=()=>r(o.error),o.onsuccess=()=>a()}))}catch(e){console.warn("Could not cache chat in IndexedDB:",e)}})(w,n),console.log("Chat cached in IndexedDB for future use")):await e()}catch(t){console.warn("Failed to fetch compressed chat log:",t),await e()}if(!Array.isArray(h))return void console.error("Failed to load chat log from any source")}s=!0,g=h.length,V=streamMetadata.owner,console.log("Chat loaded with",g,"messages")}}function xe(e){if(!streamMetadata.viewers.length||e<streamMetadata.viewers[0][0])return-1;var t,n,a=Math.floor(e/30),r=Math.max(0,a-3),o=Math.min(streamMetadata.viewers.length-1,a+3);let l=-1,s=-1;for(let t=r;t<=o;t++){var[i,,]=streamMetadata.viewers[t];i<=e&&i>s&&(s=i,l=t)}if(-1===l)for(let a=0;a<streamMetadata.viewers.length;a++)a>=r&&a<=o||([t,n]=streamMetadata.viewers[a],t<=e&&t>s&&(s=t,l=a));return l}function r(e=null){e=0<=(e=e||xe(p.currentTime))?streamMetadata.viewers[e][1]:0,U.textContent=e.toLocaleString()}function o(){var e=Math.ceil(p.currentTime);if(streamMetadata.titles&&streamMetadata.titles.length){let a=streamMetadata.title;for(let r=streamMetadata.titles.length-1;0<=r;r--){var[t,n]=streamMetadata.titles[r];if(t<=e){a=n;break}}document.querySelector(".stream-title").textContent=a,document.title=a+" - "+V.displayName}if(streamMetadata.games&&streamMetadata.games.length){let t=streamMetadata.game.name||"";for(let n=streamMetadata.games.length-1;0<=n;n--){var[a,r]=streamMetadata.games[n];if(a<=e){t="object"==typeof r?r.name:r;break}}document.querySelector(".game-name").textContent=t}}function we(e){return`https://static-cdn.jtvnw.net/emoticons/v2/${e}/default/dark/${B}.0`}function ye(e){var t;Q.has(e)||(Q.add(e),(t=new Image).src=we(e),t.onerror=()=>{console.warn("Failed to load emote:",e),Q.delete(e)})}function Me(e){var t,n;Y.has(e)||((t=u.get(e)||d.get(e))?((n=new Image).src=t[y],n.onerror=()=>{console.warn("Failed to load badge:",e)},n.onload=()=>{Y.add(e)}):console.log("Unknown badge ID:",e))}function ke(){if(s){var e=h[c].offset;let o=c;for(;o<h.length&&h[o].offset<e+5;){var t=h[o],n=(n=void 0,t.data.emotes);if(n&&n.length){let e=n.length;for(;--e;)ye(n[e].id)}r=void 0;var a=t.data.badges;if(a&&a.length){let e=a.length;for(;--e;){var r=a[e];Me(""+r.name+r.value)}}t.data.user&&!t.data.color&&(t=t.data.user.login,W.has(t)||Te(t)),o++}}}function $e(e,t,n,a,r){let o={PREFIX:e.toLowerCase(),BACKGROUND:t,ANIMATION:n?"animated":"static",TIER:a,SCALE:r,EXTENSION:n?"gif":"png"};return J.replace(/\b(PREFIX|BACKGROUND|ANIMATION|TIER|SCALE|EXTENSION)\b/g,(e=>o[e]))}function Se(){if(null===J)console.warn("Bits template URL not set");else for(var[e,t]of X.entries()){let a=t.length;for(;--a;){var n=t[a];let r=$e(e,"dark",!0,n,I);(n=new Image).src=r,n.onerror=()=>{console.warn("Failed to preload bits image:",r)}}}}function Be(){for(var e of d.values())Me(""+e.setID+e.version);for(var t of u.values())Me(""+t.setID+t.version)}function Ie(){let e=h.length;for(;--e;){var t=h[e];if(t.data.emotes)for(let e=0;e<t.data.emotes.length;e++)ye(t.data.emotes[e].id)}}function Ce(){Ie(),Be(),Se()}function Fe(e,t,n=!1){if(!t.length&&!n)return document.createTextNode(e);var a,r=[];if(t&&r.push(...t.flatMap((e=>e.pos.map((t=>({C:!1,start:t,end:t+e.len-1,id:e.id})))))),n&&f)for(f.lastIndex=0;null!==(a=f.exec(e));)r.push({C:!0,start:a.index,end:a.index+a[0].length-1,F:a[1],T:parseInt(a[2],10)});r.sort(((e,t)=>e.start-t.start));var o=document.createDocumentFragment();let l=0;for(let t=0,n=r.length;t<n;t++){var s=r[t],i=(s.start>l&&(i=e.substring(l,s.start),o.appendChild(document.createTextNode(i))),document.createElement("img"));if(i.onerror=function(){this.replaceWith(document.createTextNode(this.alt))},s.C){var d=X.get(s.F.toLowerCase());let e=1;if(d)for(let t=d.length-1;0<=t;t--)if(s.T>=d[t]){e=d[t];break}var c=document.createElement("span"),p=(c.className="bits-container",c.style="display: inline-flex; align-items: center; vertical-align: middle; gap: 2px; margin-left: 2px; margin-right: 2px;",i.src=$e(s.F,"dark",!0,e,I),i.title=i.alt=""+s.F+s.T,i.style="height: 1.6em; width: auto; vertical-align: middle;",document.createElement("span"));p.textContent=s.T.toString(),p.style=`font-weight: bold; color: ${q.get(e)};`,c.appendChild(i),c.appendChild(p),o.appendChild(c)}else i.src=we(s.id),i.title=i.alt=e.substring(s.start,s.end+1),i.style.cssText="height: 1.6em; width: auto; vertical-align: middle; margin-left: 0.5px;",o.appendChild(i);l=s.end+1}return l<e.length&&(t=e.substring(l),o.appendChild(document.createTextNode(t))),o}function Te(e){var t=e.toString().split("").reduce(((e,t)=>(e<<5)-e+t.charCodeAt(0)|0),0);t=Math.abs(t)%Z.length,t=Z[t];return W.set(e,t),t}function Ae(e){return W.get(e)||Te(e)}function F(e,t=!0){var n=document.createElement("span"),a=(n.className="chat-username",e.color||Ae(e.user.login));if(n.style.color=a,n.style.cursor="pointer",n.textContent=e.user["display-name"]||e.user.login,n.onclick=()=>Pe(e.user),!t||!S||!e.badges)return n;a=document.createElement("span");var r,o=document.createElement("span");for(r of(o.style="margin-right: 4px;",e.badges)){var l,s=""+r.name+r.value,i=u.get(s)||d.get(s);i?((l=document.createElement("img")).src=i[y],l.style="height: 1.0em; width: auto; vertical-align: middle; margin-right: 2px;",l.title=l.alt=i.title,o.appendChild(l)):console.warn("Badge not found: "+s)}return a.appendChild(o),a.appendChild(n),a}function Ee(e){var t,n=e.type,a=e.data,r=document.createElement("div");let o,l;switch(r.className="chat-message "+n,r.id=a.id||0,M&&((t=document.createElement("span")).className="timestamp",t.textContent=ge(e.offset-j),r.appendChild(t)),n){case"msg":l=F(a);var s=((c=document.createElement("span")).className="chat-text",c.textContent=": ",Fe(a.text,a.emotes));"reply"===(o=a["msg-id"])&&((p=ae(te,18,18)).style.color="var(--timestamp-color)",(d=document.createElement("div")).style="display: flex; gap: 5px; margin-bottom: 2px; align-items: center;",d.appendChild(p),p=a.reply["parent-msg-body"],p=`Replying to @${a.reply["parent-display-name"]}: `+p,(i=document.createElement("span")).textContent=p,i.style="color: var(--timestamp-color);",d.appendChild(i),r.appendChild(d)),c.appendChild(s),r.appendChild(l),r.appendChild(c);break;case"monet":if("bits"===(o=a["msg-id"])){r.className="chat-message msg";var i=((p=document.createElement("span")).className="chat-text",p.textContent=": ",Fe(a.text,a.emotes,!0));p.appendChild(i),r.appendChild(F(a)),r.appendChild(p)}else{if(!$)return;(l=F(a,addBadges=!1)).style.color="#8b04c1";var d=a.user["display-name"]||a.user.login;(s=document.createElement("span")).className="chat-text";let e=a["system-msg"];if((e=e.startsWith(d)?e.substring(d.length).trimStart():e).startsWith("subscribed")&&(e=e.charAt(0).toUpperCase()+e.slice(1)),s.textContent=" "+e,"submysterygift"===o||"subgift"===o){var c,p;i=((c=document.createElement("div")).style="display: flex; align-items: center; gap: 3px;",l.style.fontWeight="bold",document.createElement("div"));(p=document.createElement("span")).className="chat-text";let e=a["system-msg"];d=a.user["display-name"]||a.user.login;let t;return e.startsWith(d)&&(e=e.substring(d.length).trimStart()),p.textContent=" "+e,p.style.fontSize="0.9em","submysterygift"===o?((t=document.createElement("img")).src=oe.src,t.style="height: 45px; width: auto;",l.style.color=a.color||Ae(a.user.login),i.style="display: flex; flex-direction: column;"):(t=ae(ee),l.style.color="var(--text-color)",p.style.marginLeft="4px",i.style.marginLeft="4px"),i.appendChild(l),i.appendChild(p),c.appendChild(t),c.appendChild(i),r.appendChild(c),r}r.appendChild(l),r.appendChild(s),a.text&&((d=document.createElement("div")).style.marginTop="4px",p=F(a),(i=document.createElement("span")).className="chat-text",i.textContent=": ",c=Fe(a.text,a.emotes),i.appendChild(c),d.appendChild(p),d.appendChild(i),r.appendChild(d))}break;case"inraid":(l=F(a)).style.color="#ff8b38",(s=document.createElement("span")).className="chat-text",s.textContent=` is raiding with a party of ${a["msg-params"].viewerCount} viewers`,r.appendChild(l),r.appendChild(s);break;case"mod":if((c=document.createElement("span")).className="chat-text",!k)return;if("ban"===a["msg-id"])a.user=a["target-user"],l=F(a,!1),r.appendChild(l),c.style.color="var(--text-color)",c.textContent="was banned",a["ban-duration"]&&(c.textContent+=` for ${a["ban-duration"]} seconds`);else if("clear-msg"===a["msg-id"]){let e=m.querySelector(`.chat-message[id="${a["target-msg-id"]}"]`);if(!e)return;(p=e.querySelector(".chat-text"))&&(p.style.opacity="0.7"),(i=document.createElement("a")).href="#"+e.id,i.textContent="message deleted",i.style="cursor: pointer; margin-left: 5px; color: #999;",i.addEventListener("click",(t=>{t.preventDefault(),e.scrollIntoView(),e.style.backgroundColor="rgba(255,255,0,0.3)",setTimeout((()=>e.style.backgroundColor=""),200)})),c.appendChild(i)}else c.textContent="Moderation action";r.appendChild(c);break;case"poll":case"prediction":(d=document.createElement("div")).style.fontWeight="bold",d.textContent=n.charAt(0).toUpperCase()+n.slice(1)+": ","poll"===n&&a.data&&a.data.poll?d.textContent+=a.data.poll.title||"":"prediction"===n&&a.data&&a.data.event&&(d.textContent+=a.data.event.title||""),r.appendChild(d);break;default:(s=document.createElement("span")).className="chat-text",s.textContent=`[${n}] Event`,r.appendChild(s)}return r}function De(){if(s&&g){var e=p.currentTime;let l=c;for(;l<h.length&&h[l].offset<=e;)l++;if(l>c){var t=document.createDocumentFragment();for(let e=c;e<l;e++){var n=Ee(h[e]);n&&t.appendChild(n)}var a,r=m.scrollHeight-m.clientHeight<=m.scrollTop+100,o=(m.appendChild(t),c=l,m.children);o.length>b&&((a=document.createRange()).setStart(m,0),a.setEnd(m,o.length-b),a.deleteContents()),(r?ie:se)()}}}function ze(){c=c>=b?c-b:0,m.innerHTML="",De()}function Ne(){var e=window.getComputedStyle(l).display;l.style.display="none"===e?"flex":"none"}function Re(){let e,t,n,a=document.querySelector(".container"),r=document.getElementById("resize-handle");function o(a){a=a.clientX-e,a=Math.max(200,Math.min(n-200,t-a)),l.style.width=a+"px"}function s(){document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",s),r.classList.remove("active"),document.body.style.userSelect=""}r.addEventListener("mousedown",(function(i){e=i.clientX,t=l.offsetWidth,n=a.offsetWidth,document.addEventListener("mousemove",o),document.addEventListener("mouseup",s),r.classList.add("active"),document.body.style.userSelect="none"}))}let n=null,T=null,A=null;function E(){var e,t;p.paused||(e=(e=>{let t=1/0;if(streamMetadata.titles&&streamMetadata.titles.length)for(let a=0;a<streamMetadata.titles.length;a++){var[n,,]=streamMetadata.titles[a];e<n&&n<t&&(t=n)}if(streamMetadata.games&&streamMetadata.games.length)for(let n=0;n<streamMetadata.games.length;n++){var[a,,]=streamMetadata.games[n];e<a&&a<t&&(t=a)}return t===1/0?null:t})(t=p.currentTime),n&&(clearTimeout(n),n=null),e&&(t=1e3*(e-t)/p.playbackRate+50,console.debug(`Scheduling title/game update in ${(t/1e3).toFixed(2)}s at `+ge(e)),n=setTimeout((()=>{o(),E()}),t)))}function D(){if(!p.paused){var e,t=p.currentTime;e=t;let[n,a]=streamMetadata.viewers&&streamMetadata.viewers.length?0<=(e=xe(e))&&e<streamMetadata.viewers.length-1?[e+1,streamMetadata.viewers[e+1][0]]:[0,streamMetadata.viewers[0][0]]:null;T&&(clearTimeout(T),T=null),a&&(e=1e3*(a-t)/p.playbackRate,console.debug(`Scheduling viewers update in ${(e/1e3).toFixed(2)}s at `+ge(a)),T=setTimeout((()=>{r(index=n),D()}),e))}}function z(){p.paused||(A&&(clearTimeout(A),A=null),A=setTimeout((()=>{ke(),z()}),4e3))}function N(){n&&(clearTimeout(n),n=null),T&&(clearTimeout(T),T=null),A&&(clearTimeout(A),A=null)}function Le(e){document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),document.getElementById("moon-icon").style.display="light"===e?"none":"block",document.getElementById("sun-icon").style.display="light"===e?"block":"none"}function Oe(){Le("light"===(localStorage.getItem("theme")||"light")?"dark":"light")}function Pe(e){let t=e.id;e=e["display-name"]||e.login;var n=document.getElementById("user-chat-window-"+t);if(!n){let o=document.createElement("div");o.id="user-chat-window-"+t,o.className="user-chat-window",o.style.cssText="\n\t\t\t\tposition: absolute;\n\t\t\t\ttop: 100px;\n\t\t\t\tleft: 100px;\n\t\t\t\twidth: 350px;\n\t\t\t\theight: 400px;\n\t\t\t\tbackground-color: var(--bg-color);\n\t\t\t\tborder: 1px solid var(--panel-border);\n\t\t\t\tborder-radius: 4px;\n\t\t\t\tz-index: 10;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\tresize: both;\n\t\t\t\toverflow: auto;\n\t\t\t",(n=document.createElement("div")).style.cssText="\n\t\t\t\tpadding: 5px;\n\t\t\t\tcursor: move;\n\t\t\t\tbackground-color: var(--panel-border);\n\t\t\t\tcolor: var(--text-color);\n\t\t\t\tborder-bottom: 1px solid var(--panel-border);\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\talign-items: center;\n\t\t\t\tz-index: 11;\n\t\t\t",n.textContent="Chat History for "+e,(e=document.createElement("button")).textContent="X",e.style.cssText="\n\t\t\t\tbackground: none;\n\t\t\t\tborder: none;\n\t\t\t\tcolor: var(--text-color);\n\t\t\t\tcursor: pointer;\n\t\t\t\tpadding: 0 5px;\n\t\t\t",e.onclick=()=>{o.remove()},e.ontouchend=()=>o.remove(),n.appendChild(e),o.appendChild(n);let l,s,i=document.createElement("div"),d=(i.style.cssText="\n\t\t\t\tflex-grow: 1;\n\t\t\t\toverflow-y: auto;\n\t\t\t\tpadding: 5px;\n\t\t\t\tbackground-color: var(--panel-bg);\n\t\t\t",o.appendChild(i),document.createElement("button")),c=(d.textContent="Load All Messages",d.style.cssText="\n\t\t\t\twidth: 100%;\n\t\t\t\tpadding: 8px;\n\t\t\t\tbackground-color: var(--panel-border);\n\t\t\t\tcolor: var(--text-color);\n\t\t\t\tborder: none;\n\t\t\t\tcursor: pointer;\n\t\t\t",o.appendChild(d),document.body.appendChild(o),!1),m=(n.onmousedown=e=>{c=!0,l=e.clientX-o.offsetLeft,s=e.clientY-o.offsetTop,e.preventDefault(),document.onmousemove=e=>{c&&(o.style.left=e.clientX-l+"px",o.style.top=e.clientY-s+"px")},document.onmouseup=()=>{c=!1,document.onmousemove=null,document.onmouseup=null}},n.addEventListener("touchstart",(e=>{e.preventDefault(),c=!0,e=e.touches[0],l=e.clientX-o.offsetLeft,s=e.clientY-o.offsetTop}),{passive:!1}),document.addEventListener("touchmove",(e=>{c&&(e.preventDefault(),e=e.touches[0],o.style.left=e.clientX-l+"px",o.style.top=e.clientY-s+"px")}),{passive:!1}),document.addEventListener("touchend",(()=>{c=!1}),{passive:!1}),0);d.onclick=function(){for(;m<g;)r();d.remove()};for(var a=p.currentTime+j;m<g&&h[m].offset<=a;)r();function r(){var e=h[m];e.data.user&&e.data.user.id===t&&(e=Ee(e))&&i.appendChild(e),m++}i.scrollTop=i.scrollHeight}}function He(){var e=prompt("Enter username for chatlog history:");if(e){var t=e.toLowerCase();for(let a=0;a<g;a++){var n=h[a];if(n.data.user&&(n.data.user.login===t||n.data.user["display-name"]===e))return void Pe(n.data.user)}}}function Ue(){let e=document.createElement("div"),t=(e.className="modal",document.createElement("div")),n=(t.className="settings-panel",t.innerHTML=`\n\t\t<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">\n\t\t\t<h2 style="margin: 0; color: var(--text-color);">Settings</h2>\n\t\t\t<button id="settings-close" style="background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-color);">&times;</button>\n\t\t</div>\n\t\t<div style="margin-bottom: 15px;">\n\t\t\t<label style="display: block; margin-bottom: 5px; font-weight: bold;">Emoji Resolution (1-3): <span id="emote-res-value">${B}</span></label>\n\t\t\t<input type="range" id="emote-res" min="1" max="3" value="${B}" style="width: 100%;">\n\t\t\t<button id="preload-emotes" style="margin-top: 5px; padding: 5px 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Preload Emotes</button>\n\t\t</div>\n\t\t<div style="margin-bottom: 15px;">\n\t\t\t<label style="display: block; margin-bottom: 5px; font-weight: bold;">Bits Resolution (1-4): <span id="bits-res-value">${I}</span></label>\n\t\t\t<input type="range" id="bits-res" min="1" max="4" value="${I}" style="width: 100%;">\n\t\t\t<button id="preload-bits" style="margin-top: 5px; padding: 5px 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Preload Bits</button>\n\t\t</div>\n\t\t<div style="margin-bottom: 15px;">\n\t\t\t<label style="display: block; margin-bottom: 5px; font-weight: bold;">Badges Resolution: <span id="badges-res-value">${x}</span></label>\n\t\t\t<select id="badges-res" style="width: 100%; padding: 5px; background-color: var(--bg-color); border: 1px solid var(--panel-border); color: var(--text-color); border-radius: 4px;">\n\t\t\t\t<option value="1" ${1===x?"selected":""}>1x</option>\n\t\t\t\t<option value="2" ${2===x?"selected":""}>2x</option>\n\t\t\t\t<option value="4" ${4===x?"selected":""}>4x</option>\n\t\t\t</select>\n\t\t\t<button id="preload-badges" style="margin-top: 5px; padding: 5px 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Preload Badges</button>\n\t\t</div>\n\t\t<div style="margin-bottom: 15px;">\n\t\t\t<button id="preload-all" style="width: 100%; padding: 10px; background-color: var(--accent-color, #9147ff); border: none; border-radius: 4px; color: white; cursor: pointer; font-weight: bold;">Preload All Assets</button>\n\t\t</div>\n\t\t<div style="margin-bottom: 15px;">\n\t\t\t<label style="display: block; margin-bottom: 5px; font-weight: bold;">Chat History Buffer (50-1000): <span id="history-value">${b}</span></label>\n\t\t\t<input type="range" id="chat-history" min="50" max="1000" step="10" value="${b}" style="width: 100%;">\n\t\t</div>\n\t\t<div style="margin-bottom: 15px;">\n\t\t\t<label style="display: block; margin-bottom: 5px; font-weight: bold;">Chat Update Speed (10-1000ms): <span id="update-speed-value">${v}</span>ms</label>\n\t\t\t<input type="range" id="chat-update-speed" min="10" max="1000" step="10" value="${v}" style="width: 100%;">\n\t\t</div>\n\t\t<div style="margin-bottom: 15px;">\n\t\t\t<label style="display: flex; align-items: center; margin-bottom: 10px;">\n\t\t\t\t<input type="checkbox" id="show-timestamps" ${M?"checked":""} style="margin-right: 8px;">\n\t\t\t\tShow message timestamps\n\t\t\t</label>\n\t\t\t<label style="display: flex; align-items: center; margin-bottom: 10px;">\n\t\t\t\t<input type="checkbox" id="show-badges" ${S?"checked":""} style="margin-right: 8px;">\n\t\t\t\tShow user badges\n\t\t\t</label>\n\t\t\t<label style="display: flex; align-items: center; margin-bottom: 10px;">\n\t\t\t\t<input type="checkbox" id="show-sub-messages" ${$?"checked":""} style="margin-right: 8px;">\n\t\t\t\tShow gifted subscriptions, subscription messages\n\t\t\t</label>\n\t\t\t<label style="display: flex; align-items: center; margin-bottom: 10px;">\n\t\t\t\t<input type="checkbox" id="show-ban-messages" ${k?"checked":""} style="margin-right: 8px;">\n\t\t\t\tShow user ban messages\n\t\t\t</label>\n\t\t</div>\n\t\t<div style="display: flex; gap: 10px; margin-top: 20px;">\n\t\t\t<button id="settings-save" style="flex: 1; padding: 10px; background-color: var(--accent-color, #9147ff); border: none; border-radius: 4px; color: white; cursor: pointer; font-weight: bold;">Save & Apply</button>\n\t\t\t<button id="settings-cancel" style="flex: 1; padding: 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Cancel</button>\n\t\t</div>\n\t\t\t`,e.appendChild(t),document.body.appendChild(e),t.querySelector("#emote-res")),a=t.querySelector("#emote-res-value"),r=(n.addEventListener("input",(()=>{a.textContent=n.value})),t.querySelector("#bits-res")),o=t.querySelector("#bits-res-value"),l=(r.addEventListener("input",(()=>{o.textContent=r.value})),t.querySelector("#badges-res")),s=t.querySelector("#badges-res-value"),i=(l.addEventListener("change",(()=>{s.textContent=l.value})),t.querySelector("#chat-history")),d=t.querySelector("#history-value"),c=(i.addEventListener("input",(()=>{d.textContent=i.value})),t.querySelector("#chat-update-speed")),m=t.querySelector("#update-speed-value"),u=(c.addEventListener("input",(()=>{m.textContent=c.value})),t.querySelector("#preload-emotes").addEventListener("click",Ie),t.querySelector("#preload-bits").addEventListener("click",Se),t.querySelector("#preload-badges").addEventListener("click",Be),t.querySelector("#preload-all").addEventListener("click",Ce),()=>e.remove());t.querySelector("#settings-close").addEventListener("click",u),t.querySelector("#settings-cancel").addEventListener("click",u),e.addEventListener("click",(t=>{t.target===e&&u()})),t.querySelector("#settings-save").addEventListener("click",(()=>{B=parseInt(n.value),I=parseInt(r.value);var e=parseInt(l.value),a=(b=parseInt(i.value),parseInt(c.value));M=t.querySelector("#show-timestamps").checked,S=t.querySelector("#show-badges").checked,$=t.querySelector("#show-sub-messages").checked,k=t.querySelector("#show-ban-messages").checked,x!==e&&(x=e,y=`image${x}x`),a!==v&&(v=a,clearInterval(K),K=setInterval((()=>{p.paused||De()}),v)),e={A:B,D:I,N:x,R:b,L:v,O:M,P:S,H:$,U:k},localStorage.setItem("settings",JSON.stringify(e)),u(),ze()}))}document.addEventListener("DOMContentLoaded",(async()=>{await Promise.all([be(),(async()=>{var e=await he.add(me.l.t());if(e.errors)throw new C(e.errors);var t=e.badges;let n=t.length;for(;--n;){var a=t[n];d.set(""+a.setID+a.version,a)}})(),(async()=>{var e=await he.add(me.i.t({channelLogin:R}));if(e.errors)throw new C(e.errors);var t=e.user.broadcastBadges;let n=t.length;for(;--n;){var a=t[n];u.set(""+a.setID+a.version,a)}})(),(async()=>{var e=await he.add(me.o.t());if(e.errors)throw new C(e.errors);var t=e.cheerConfig.groups[0],n=e.cheerConfig.displayConfig.colors;J=t.templateURL;for(let e=0;e<n.length;e++){var a=n[e];q.set(a.bits,a.color)}for(let e=0;e<t.nodes.length;e++){var r=t.nodes[e];if("DISPLAY_ONLY"!==r.type){G.add(r.prefix);var o=new Array;for(let e=0;e<r.tiers.length;e++)o.push(r.tiers[e].bits);var l=r.prefix.toLowerCase();X.set(l,o),_.set(l,r.prefix)}}e=Array.from(G).join("|"),f=new RegExp(`(?:^|\\s)(${e})(\\d+)(?=\\s|$)`,"gi")})()]),r(),o(),ke(),Re();var e=localStorage.getItem("settings");if(e)try{"A"in(e=JSON.parse(e))&&(B=e.A),"D"in e&&(I=e.D),"N"in e&&(x=e.N),"R"in e&&(b=e.R),"L"in e&&(v=e.L),"O"in e&&(M=e.O),"P"in e&&(S=e.P),"H"in e&&($=e.H),"U"in e&&(k=e.U),y=`image${x}x`}catch(e){console.error("Failed to load settings:",e)}p.addEventListener("play",(()=>{E(),D(),z(),m.scrollHeight-m.clientHeight>=m.scrollTop+100&&ie()})),p.addEventListener("pause",(()=>{N()})),p.addEventListener("ratechange",(()=>{p.paused||(N(),E(),D(),z())})),K=setInterval((()=>{p.paused||De()}),v),p.addEventListener("seeking",(()=>{N(),o(),r()})),p.addEventListener("seeked",(()=>{N(),c=(e=>{var t=e/p.duration;t=Math.floor(g*t);if(e>p.duration)return g-1;if(h[t].offset<e){for(let n=t;n<g;n++)if(h[n].offset>e)return n-1}else for(let n=t;0<=n;n--)if(h[n].offset<e)return n;return 0})(p.currentTime),r(),o(),ke(),ze(),p.paused||(E(),D(),z())})),document.getElementById("toggle-chat-btn").addEventListener("click",Ne),document.getElementById("settings-btn").addEventListener("click",Ue),document.getElementById("chatlog-btn").addEventListener("click",He),document.getElementById("theme-toggle-btn").addEventListener("click",Oe)}))</script>