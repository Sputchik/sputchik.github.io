<!DOCTYPE html><html lang="en"><meta charset="UTF-8"><script>if (!new URLSearchParams(window.location.search).get('id')) window.location.replace('https://archive.org/details/@sputchik?sort=-date');</script><meta name="viewport" content="width=device-width,initial-scale=1"><title>Twitch VOD Viewer</title><style>:root{--bg-color:#f8f8f8;--scrollbar-bg:#f0f0f0;--scrollbar-thumb:#c1c1c1;--scrollbar-thumb-hover:#a1a1a1;--text-color:#333;--panel-bg:#fff;--panel-border:#ddd;--chat-border:#eee;--timestamp-color:#999;--game-name-color:#555;--resize-handle:#ddd;--resize-handle-hover:#6441a5;--chat-header-bg:#f4f4f4;--viewer-icon-color:#971311;--accent-color:#6741a5;--link-color:#7f52c9;--sub-color:#8b04c1;--cheer-gradient-left:#00000021;--cheer-gradient-right:#00000030;--cheer-clicked-bg:#33333390;--shadow-size-1:0 1px 2px rgba(0, 0, 0, 0.16),0 0px 2px rgba(0, 0, 0, 0.05);--shadow-size-2:0 4px 8px rgba(0, 0, 0, 0.16),0 0px 4px rgba(0, 0, 0, 0.05);--btn-hover-bg:#00000020;--choice-sweep-bg:#00000020}[data-theme=dark]{--bg-color:#000000;--scrollbar-bg:#000000;--scrollbar-thumb:#222222;--scrollbar-thumb-hover:#6441a5;--text-color:#e5e5e5;--panel-bg:#0f0f0f;--panel-border:#333;--chat-border:#1f1f1f;--timestamp-color:#888;--game-name-color:#aaa;--resize-handle:#333333;--resize-handle-hover:#6441a5;--chat-header-bg:#000000;--viewer-icon-color:#ff6b68;--cheer-gradient-left:#00000029;--cheer-gradient-right:#00000038;--cheer-clicked-bg:#00000090;--btn-hover-bg:#FFFFFF30;--choice-sweep-bg:#FFFFFF20}*{scrollbar-width:thin;scrollbar-color:var(--scrollbar-thumb) var(--scrollbar-bg)}a{color:var(--link-color);text-decoration:none}a:hover{text-decoration:underline}body{font-family:Arial,sans-serif;font-size:15px;margin:0;padding:0;background:var(--bg-color);color:var(--text-color);overflow-y:hidden}.container{display:flex;flex-direction:row;max-width:100%;height:100dvh}.left-panel{flex:1;min-width:0;padding-left:10px;padding-right:10px;display:flex;flex-direction:column;height:100%;overflow-y:auto;scrollbar-gutter:stable both-edges}.video-container{position:relative;width:100%;padding-top:56.25%;background:#000}#video-player{position:absolute;top:0;left:0;width:100%;height:100%}.stream-info{margin-top:12px;padding:8px;padding-top:8px;background:var(--panel-bg);border-radius:4px;box-shadow:var(--shadow-size-1);margin-bottom:13px}.stream-info-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2px}.stream-game{display:flex;align-items:center;gap:7px;margin-top:7px}.stream-title{font-size:1rem;margin:0}.game-name{color:var(--game-name-color);font-size:.8rem}.viewers-count{font-weight:700;margin-right:55px;display:flex;align-items:center}.chat-toggle{background:var(--panel-bg);color:var(--text-color);border:1px solid var(--panel-border);border-radius:4px;padding:8px 15px;cursor:pointer;font-weight:700}.chat-panel{resize:horizontal;min-width:200px;width:400px;background:var(--panel-bg);display:flex;flex-direction:column;padding-bottom:env(safe-area-inset-bottom);position:relative}.chat-header{padding:5px 9px;border-bottom:1px solid var(--panel-border);font-weight:700;background:var(--chat-header-bg);display:flex;justify-content:space-between;align-items:center}.chat-header-btn{background:0 0;border:none;cursor:pointer;padding:4px;border-radius:4px;color:var(--text-color)}.chat-messages{overflow-y:scroll;padding:10px;flex:1;overflow-y:auto}.chat-messages-panel{display:flex;flex-direction:column;height:100%;overflow:hidden;position:relative}.chat-message{padding:5px 0;border-bottom:1px solid var(--chat-border)}.chat-username{font-weight:700}.chat-text{word-break:break-word}.chat-overlay{position:absolute;top:16px;left:12px;right:12px;background:var(--panel-bg);border:1px solid var(--panel-border);border-radius:10px;padding:10px 12px;box-shadow:0 6px 16px rgba(0,0,0,.18);z-index:2;pointer-events:auto}.timestamp{color:var(--timestamp-color);font-size:.75rem;margin-right:5px}.monet,.prediction{background-color:var(--panel-bg);border-left:3.5px solid #6441a5;padding-left:5px}.inraid{background-color:#ffad000f;border-left:3.5px solid #ff9e27;padding-left:5px}.mod{background-color:#ff00000a;border-left:3.5px solid red;padding-left:5px;font-style:italic}@media (orientation:portrait){.container{position:relative;display:grid;grid-template-areas:"video" "info" "chat";grid-template-rows:auto auto 1fr;height:100dvh}.left-panel{display:contents;height:auto;padding:10px}.video-container{grid-area:video}.stream-info{grid-area:info;margin-bottom:0;margin-top:8px}.stream-game{margin-top:6px}#chat-panel{grid-area:chat;position:relative;width:100%;border-left:none;overflow-y:auto;padding-bottom:env(safe-area-inset-bottom)}.description{position:absolute;top:100dvh;left:0;right:0}#resize-handle{display:none}.viewers-count{margin-right:5px}}.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center;z-index:100}.settings-panel{background:var(--panel-bg);border:1px solid var(--panel-border);border-radius:4px;padding:20px;min-width:300px;width:40vw;max-width:80vw;max-height:80vh;height:75%;overflow-y:auto;color:var(--text-color);box-shadow:0 1px 3px rgba(0,0,0,.1);z-index:3}.progress-bar{width:100%;background:var(--panel-border);border-radius:4px;margin-top:5px;padding:2px;font-size:12px;text-align:center;color:var(--bg-color);display:none}.popout{position:absolute;top:100px;left:100px;width:350px;height:400px;max-width:80vw;max-height:80vh;background-color:var(--bg-color);border:1px solid var(--panel-border);border-radius:4px;z-index:10;display:flex;flex-direction:column;resize:both;overflow:auto}.scroll-bottom-btn{display:none;position:absolute;bottom:4%;left:50%;transform:translateX(-50%);z-index:3;width:50%;height:fit-content;min-height:33px;border-radius:8px;border-color:var(--panel-border);background-color:var(--bg-color);color:var(--text-color)}.event-container{display:flex;flex-direction:column;position:absolute;gap:8px;top:8px;left:10px;right:20px;z-index:1}.pin-placeholder{display:flex;justify-content:space-between;padding:11px;gap:10px;border-radius:3px;background:var(--panel-bg);border:1px solid var(--panel-border);box-shadow:var(--shadow-size-2)}.pin-left-container{display:flex;flex-direction:column;max-width:90%;min-width:0;gap:8px;word-break:break-word}.pinned-bits-container{display:flex;flex-direction:column;gap:8px}.pinned-bits-placeholder{display:flex;overflow-x:auto;overflow-y:hidden;max-width:100%;gap:5px;white-space:nowrap;scrollbar-width:none;touch-action:pan-x;-ms-overflow-style:none}.pinned-bits-placeholder::-webkit-scrollbar{display:none;width:0;height:0}.pinned-cheer{min-width:87px;height:41px;border-radius:5px;display:flex;align-items:center;justify-content:center;flex-shrink:0;position:relative;overflow:hidden;cursor:pointer}.pinned-cheer-inner{display:flex;position:absolute;align-items:center;justify-content:center;overflow:hidden;border-radius:3px;height:83%;width:92%;background:linear-gradient(to right,var(--cheer-gradient-left),var(--cheer-gradient-right));z-index:0}.pinned-bits-details{display:flex;flex-direction:column;border-radius:6px;gap:2px;box-shadow:var(--shadow-size-2)}.poll-container{display:flex;flex-direction:column;border-radius:5px;gap:10px;padding:8px 8px 12px 8px;box-shadow:var(--shadow-size-2);background:var(--panel-bg);border:1px solid var(--panel-border)}.poll-header-container{display:flex;align-items:center;justify-content:space-between;cursor:pointer}.poll-choice-container{display:flex;flex-direction:column;gap:8px}.poll-choice{display:flex;justify-content:space-between;align-items:center;border-radius:4px;background:var(--chat-border);padding:4px 6px 4px 10px;position:relative;overflow:hidden}.marquee-container{min-width:0;overflow:hidden;color:#fff;border-radius:6px;background:var(--accent-color);padding:15px;cursor:pointer}.marquee-content{display:flex;align-items:center;top:50%;gap:10px;font-size:1.5rem;font-weight:700;transform:translateX(-100%)}.animated-border-container{position:relative;overflow:hidden}.animated-border{position:absolute;bottom:0;right:0;width:100%;height:4px;overflow:hidden;background:var(--accent-color)}@keyframes marqueeFromRight{0%{transform:translateX(130%)}100%{transform:translateX(-130%)}}@keyframes translateLeftToRight{0%{transform:translateX(-100%)}100%{transform:translateX(0)}}@keyframes translateRightToLeft{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}@keyframes widthLeftToRight{0%{width:0}100%{width:100%}}@keyframes widthRightToLeft{0%{width:100%}100%{width:0}}.sweep{position:absolute;top:0;left:0;height:100%;width:100%;background:var(--cheer-gradient-right);z-index:0}.pinned-cheer-colors-level-one{background:linear-gradient(90deg,#9146ff,#8205b4)}.pinned-cheer-colors-level-two{background:linear-gradient(90deg,#578fff,#1e69ff)}.pinned-cheer-colors-level-three{background:linear-gradient(90deg,#00bba4,#009919)}.pinned-cheer-colors-level-four{background:linear-gradient(90deg,#ffff75,#fdb210,#ff6905)}.pinned-cheer-colors-level-five{background:linear-gradient(90deg,#f093f9,#fa1ed2,#f7262c)}.pinned-cheer-colors-level-six{background:linear-gradient(90deg,#fa1ed2,#9146ff,#1e69ff,#00c8af)}.pinned-cheer-colors-level-seven{background:linear-gradient(90deg,#fafa19,#fdb210,#ea7078,#fa1ed2,#9146ff,#1e69ff)}.pinned-cheer-colors-level-eight{background:linear-gradient(90deg,#ffb800,#beff00,#00fafa,#9146ff,#fa1ed2)}.btn{cursor:pointer;display:inline-flex;align-items:center;justify-content:center;border-radius:4px;transition:background .15s,transform .15s;padding:5px;user-select:none;-webkit-tap-highlight-color:transparent;-webkit-appearance:none;-webkit-user-select:none}@media (any-hover:none){.btn:active{background:var(--btn-hover-bg);transform:scale(1.15)}}@media (hover:hover) and (pointer:fine){.btn:hover{background:var(--btn-hover-bg);transform:scale(1.15)}.btn:active{background:var(--btn-hover-bg);transform:scale(.95)}.resize-handle:hover{transition:background-color .2s;background-color:var(--resize-handle-hover)}}.resize-handle{width:6px;background-color:var(--resize-handle);cursor:col-resize}.resize-handle.active,.resize-handle:active{transition:background-color .2s;background-color:var(--resize-handle-hover)}</style><div class="container"><div class="left-panel"><div class="video-container"><video id="video-player" webkit-playsinline="true" playsinline="true" controls preload="metadata">Your browser does not support the video tag.</video></div><div class="stream-info"><div class="stream-info-header"><div><h1 class="stream-title" id="stream-title">Loading...</h1><div class="stream-game"><svg fill="var(--game-name-color)" width="20" height="20" viewBox="0 0 20 20"><path d="M13 4a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v2l3 3 3-3V4zM4 7a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2l3-3-3-3H4zm14 4a2 2 0 0 1-2 2h-2l-3-3 3-3h2a2 2 0 0 1 2 2v2zM7 16a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2l-3-3-3 3v2z" fill="currentColor"></path></svg><span class="game-name" id="game-name">Loading...</span></div></div><div style="display:flex;align-items:center"><span class="viewers-count" style="gap:3px;display:flex;align-items:center;color:var(--viewer-icon-color)"><svg width="20" height="20" viewBox="0 0 20 20" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M5 7a5 5 0 1 1 6.192 4.857A2 2 0 0 0 13 13h1a3 3 0 0 1 3 3v2h-2v-2a1 1 0 0 0-1-1h-1a3.99 3.99 0 0 1-3-1.354A3.99 3.99 0 0 1 7 15H6a1 1 0 0 0-1 1v2H3v-2a3 3 0 0 1 3-3h1a2 2 0 0 0 1.808-1.143A5.002 5.002 0 0 1 5 7zm5 3a3 3 0 1 1 0-6 3 3 0 0 1 0 6z" clip-rule="evenodd"></path></svg><span id="viewer-count">0</span></span><button class="theme-toggle" id="theme-toggle-btn" style="margin-left:8px;background:var(--panel-bg);color:var(--text-color);border:1px solid var(--panel-border);border-radius:4px;padding:8px 15px;cursor:pointer"><svg id="theme-icon" width="16" height="16" viewBox="0 0 24 24" style="vertical-align:text-bottom"><path id="moon-icon" fill="currentColor" d="M21.53 15.93c-.16-.27-.61-.69-1.73-.49a8.46 8.46 0 01-1.88.13 8.409 8.409 0 01-5.91-2.82 8.068 8.068 0 01-1.44-8.66c.44-1.01.13-1.54-.09-1.76s-.77-.55-1.83-.11a10.318 10.318 0 00-6.32 10.21 10.475 10.475 0 007.04 8.99 10 10 0 002.89.55c.16.01.32.02.48.02a10.5 10.5 0 008.47-4.27c.67-.93.49-1.519.32-1.79z" style="display:none"/><path id="sun-icon" fill="currentColor" d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 000-1.41l-1.06-1.06zm1.06-10.96a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/></svg></button></div></div></div><div class="description" id="description-container" style="display:none"><details><summary></summary><div id="description-content">Loading...</div></details></div></div><div class="resize-handle" id="resize-handle"></div><div class="chat-panel" id="chat-panel"><div class="chat-header"><span>Chat Replay (WIP)</span><div style="display:flex;gap:5px" id="chat-header-buttons"><button class="chat-header-btn btn" title="Found Issue? Report here" id="report-btn"><svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M17.416 2.62412C17.7607 2.39435 17.8538 1.9287 17.624 1.58405C17.3943 1.23941 16.9286 1.14628 16.584 1.37604L13.6687 3.31955C13.1527 3.11343 12.5897 3.00006 12.0001 3.00006C11.4105 3.00006 10.8474 3.11345 10.3314 3.31962L7.41603 1.37604C7.07138 1.14628 6.60573 1.23941 6.37596 1.58405C6.1462 1.9287 6.23933 2.39435 6.58397 2.62412L8.9437 4.19727C8.24831 4.84109 7.75664 5.70181 7.57617 6.6719C8.01128 6.55973 8.46749 6.50006 8.93763 6.50006H15.0626C15.5328 6.50006 15.989 6.55973 16.4241 6.6719C16.2436 5.70176 15.7519 4.841 15.0564 4.19717L17.416 2.62412Z"/><path fill="currentColor" d="M1.25 14.0001C1.25 13.5859 1.58579 13.2501 2 13.2501H5V11.9376C5 11.1019 5.26034 10.327 5.70435 9.68959L3.22141 8.69624C2.83684 8.54238 2.6498 8.10589 2.80366 7.72131C2.95752 7.33673 3.39401 7.1497 3.77859 7.30356L6.91514 8.55841C7.50624 8.20388 8.19807 8.00006 8.9375 8.00006H15.0625C15.8019 8.00006 16.4938 8.20388 17.0849 8.55841L20.2214 7.30356C20.606 7.1497 21.0425 7.33673 21.1963 7.72131C21.3502 8.10589 21.1632 8.54238 20.7786 8.69624L18.2957 9.68959C18.7397 10.327 19 11.1019 19 11.9376V13.2501H22C22.4142 13.2501 22.75 13.5859 22.75 14.0001C22.75 14.4143 22.4142 14.7501 22 14.7501H19V15.0001C19 16.1808 18.7077 17.2932 18.1915 18.2689L20.7786 19.3039C21.1632 19.4578 21.3502 19.8943 21.1963 20.2789C21.0425 20.6634 20.606 20.8505 20.2214 20.6966L17.3288 19.5394C16.1974 20.8664 14.5789 21.7655 12.75 21.9604V15.0001C12.75 14.5858 12.4142 14.2501 12 14.2501C11.5858 14.2501 11.25 14.5858 11.25 15.0001V21.9604C9.42109 21.7655 7.80265 20.8664 6.67115 19.5394L3.77859 20.6966C3.39401 20.8505 2.95752 20.6634 2.80366 20.2789C2.6498 19.8943 2.83684 19.4578 3.22141 19.3039L5.80852 18.2689C5.29231 17.2932 5 16.1808 5 15.0001V14.7501H2C1.58579 14.7501 1.25 14.4143 1.25 14.0001Z"/></svg></button><button class="chat-header-btn btn" title="Open user ChatLog by username" id="chatlog-btn"><svg width="20" height="20" viewBox="0 0 24 24"><path fill="none" d="M18.5 19.5L20 21M11 14C7.13401 14 4 17.134 4 21H11M19 17.5C19 18.8807 17.8807 20 16.5 20C15.1193 20 14 18.8807 14 17.5C14 16.1193 15.1193 15 16.5 15C17.8807 15 19 16.1193 19 17.5ZM15 7C15 9.20914 13.2091 11 11 11C8.79086 11 7 9.20914 7 7C7 4.79086 8.79086 3 11 3C13.2091 3 15 4.79086 15 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button><button class="chat-header-btn btn" title="Open Settings" id="settings-btn"><svg width="20" height="20" viewBox="0 0 20 20" style="color:var(--text-color)"><path fill="currentColor" d="M10 8a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"></path><path fill="currentColor" fill-rule="evenodd" d="M9 2h2a2.01 2.01 0 0 0 1.235 1.855l.53.22a2.01 2.01 0 0 0 2.185-.439l1.414 1.414a2.01 2.01 0 0 0-.439 2.185l.22.53A2.01 2.01 0 0 0 18 9v2a2.01 2.01 0 0 0-1.855 1.235l-.22.53a2.01 2.01 0 0 0 .44 2.185l-1.415 1.414a2.01 2.01 0 0 0-2.184-.439l-.531.22A2.01 2.01 0 0 0 11 18H9a2.01 2.01 0 0 0-1.235-1.854l-.53-.22a2.009 2.009 0 0 0-2.185.438L3.636 14.95a2.009 2.009 0 0 0 .438-2.184l-.22-.531A2.01 2.01 0 0 0 2 11V9c.809 0 1.545-.487 1.854-1.235l.22-.53a2.009 2.009 0 0 0-.438-2.185L5.05 3.636a2.01 2.01 0 0 0 2.185.438l.53-.22A2.01 2.01 0 0 0 9 2zm-4 8 1.464 3.536L10 15l3.535-1.464L15 10l-1.465-3.536L10 5 6.464 6.464 5 10z" clip-rule="evenodd"></path></svg></button></div></div><div class="chat-messages-panel" id="chat-messages-panel"><div class="event-container" id="event-container"><div class="pinned-bits-container" id="pinned-bits-container"><div class="pinned-bits-placeholder" id="pinned-bits-placeholder"></div></div><div class="pin-container" id="pin-container"></div></div><div class="chat-messages" id="chat-messages"></div></div></div></div><script>var e=new URLSearchParams(window.location.search),t=e.get("id"),e="true"==e.get("local");t||window.location.replace("https://archive.org/details/@sputchik?sort=-date");let[i,,y]=t.split("-");var t=`https://archive.org/download/${t}/`;let r,c,o,u,v=(u=e?(e=window.location.origin,r=`${e}/${y}.json`,c=`${e}/${y}-metadata.json`,o=`${e}/${y}.mp4`,`${e}/${y}.tar.gz`):(r=t+y+".json",c=t+y+"-metadata.json",o=t+y+".mp4",`https://corsproxy.io/?url=${t}${y}.tar.gz`),document.getElementById("video-player")),h=document.getElementById("chat-panel"),N=document.getElementById("chat-header-buttons"),p=document.getElementById("chat-messages"),U=document.getElementById("viewer-count"),j=document.getElementById("pinned-bits-placeholder"),_=document.getElementById("pinned-bits-container"),J=document.getElementById("pin-container"),q=document.getElementById("event-container"),G=(j.addEventListener("wheel",e=>{e.preventDefault(),j.scrollLeft+=.3*e.deltaY}),"ontouchstart"in window||0<navigator.maxTouchPoints),X=(v.src=o,e=window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("theme"),ot(e||!t?e?"dark":"light":t),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{ot(e.matches?"dark":"light")}),null),a={t:null,viewers:null,o:null},d=null,K=0,Y=null,g=1;let b=[],w=0,l=!1,s=0,Q=null,W=new Set,m=new Map,Z=new Map,ee=null,te=null,f=100,x=250,ne=5,M=4,k=`image${M}x`,$=!0,z=!0,L=!0,oe=!0,C=!1,P=!0,A=!0,S=3,I=4,ie=new Map,ae=new Map,re=new Map,le=new Set,se=new Set;new Set(["msg","monet","inraid","mod","misc"]);let ce=new Map;let de=["#FF0000","#0000FF","#008000","#B22222","#FF7F50","#9ACD32","#FF4500","#2E8B57","#DAA520","#D2691E","#5F9EA0","#1E90FF","#FF69B4","#8A2BE2","#00FF7F"],ue=/(https?:\/\/[^\s]+|www\.[^\s]+)(?![^<]*>)/gi,T={i:'<path fill="currentColor" fill-rule="evenodd" d="M16 6h2v6h-1v6H3v-6H2V6h2V4.793c0-2.507 3.03-3.762 4.803-1.99.131.131.249.275.352.429L10 4.5l.845-1.268a2.81 2.81 0 0 1 .352-.429C12.969 1.031 16 2.286 16 4.793V6zM6 4.793V6h2.596L7.49 4.341A.814.814 0 0 0 6 4.793zm8 0V6h-2.596l1.106-1.659a.814.814 0 0 1 1.49.451zM16 8v2h-5V8h5zm-1 8v-4h-4v4h4zM9 8v2H4V8h5zm0 4H5v4h4v-4z" clip-rule="evenodd"></path>',reply:'<path fill="currentColor" d="M11 8h2v2h-2V8zM9 8H7v2h2V8z"></path><path fill="currentColor" fill-rule="evenodd" d="m10 18-3-3H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2l-3 3zm-2.172-5L10 15.172 12.172 13H15V5H5v8h2.828z" clip-rule="evenodd"></path>',sub:'<path fill="currentColor" d="M8.944 2.654c.406-.872 1.706-.872 2.112 0l1.754 3.77 4.2.583c.932.13 1.318 1.209.664 1.853l-3.128 3.083.755 4.272c.163.92-.876 1.603-1.722 1.132L10 15.354l-3.579 1.993c-.846.47-1.885-.212-1.722-1.132l.755-4.272L2.326 8.86c-.654-.644-.268-1.723.664-1.853l4.2-.583 1.754-3.77z"></path>',l:'<path fill="currentColor" d="M18 5v8a2 2 0 0 1-2 2H4a2.002 2.002 0 0 1-2-2V5l4 3 4-4 4 4 4-3z" fill-rule="evenodd"></path>',u:'<path fill="currentColor" fill-rule="evenodd" d="m11 14 7 4V2l-7 4H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h2v4h2v-4h3zm1-6.268 4-2.286v9.108l-4-2.286V7.732zM10 12H4V8h6v4z" clip-rule="evenodd"></path>',bits:'<path fill="currentColor" fill-rule="evenodd" d="m3 12 7-10 7 10-7 6-7-6zm2.678-.338L10 5.487l4.322 6.173-.85.728L10 11l-3.473 1.39-.849-.729z" clip-rule="evenodd"></path>',h:'<path fill="currentColor" fill-rule="evenodd" d="M4.941 2h10v2H13v3a3 3 0 0 1 3 3v3H4v-3a3 3 0 0 1 3-3V4H4.941V2zM9 9H7a1 1 0 0 0-1 1v1h8v-1a1 1 0 0 0-1-1h-2V4H9v5z" clip-rule="evenodd"></path><path fill="currentColor" d="M10.999 15h-2v3h2v-3z"></path>',hide:'<path fill="currentColor" d="m16.5 18 1.5-1.5-2.876-2.876a9.99 9.99 0 0 0 1.051-1.191L18 10l-1.825-2.433a9.992 9.992 0 0 0-2.855-2.575 35.993 35.993 0 0 1-.232-.14 6 6 0 0 0-6.175 0 35.993 35.993 0 0 1-.35.211L3.5 2 2 3.5 16.5 18zm-2.79-5.79a8 8 0 0 0 .865-.977L15.5 10l-.924-1.233a7.996 7.996 0 0 0-2.281-2.058 37.22 37.22 0 0 1-.24-.144 4 4 0 0 0-4.034-.044l1.53 1.53a2 2 0 0 1 2.397 2.397l1.762 1.762z" fill-rule="evenodd"></path><path fill="currentColor" d="m11.35 15.85-1.883-1.883a3.996 3.996 0 0 1-1.522-.532 38.552 38.552 0 0 0-.239-.144 7.994 7.994 0 0 1-2.28-2.058L4.5 10l.428-.571L3.5 8 2 10l1.825 2.433a9.992 9.992 0 0 0 2.855 2.575c.077.045.155.092.233.14a6 6 0 0 0 4.437.702z"></path>',expand:'<path fill="currentColor" d="M14.5 6.5 10 11 5.5 6.5 4 8l6 6 6-6-1.5-1.5z"></path>',collapse:'<path fill="currentColor" d="M5.5 13.5 10 9l4.5 4.5L16 12l-6-6-6 6 1.5 1.5z"></path>',p:'<path fill="currentColor" d="M3 9c0-.621.08-1.223.233-1.796l1.122.441.654 1.663a5 5 0 1 0 5.3-5.299l-1.664-.654-.441-1.122a7 7 0 0 1 5.014 12.985L14 16a2 2 0 0 1 2 2H4a2 2 0 0 1 2-2l.782-.782A7 7 0 0 1 3 9z"></path><path fill="currentColor" d="M7.489 4.511 10 5.5l-2.511.989L6.5 9l-.989-2.511L3 5.5l2.511-.989L6.5 2l.989 2.511zM12 9l-1.435-.565L10 7l-.565 1.435L8 9l1.435.565L10 11l.565-1.435L12 9z"></path>',m:'<path fill="currentColor" d="M10 6a4 4 0 0 1 4 4h-2a2 2 0 0 0-2-2V6z"></path><path fill="currentColor" fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0zm-2 0a6 6 0 1 1-12 0 6 6 0 0 1 12 0z" clip-rule="evenodd"></path>',poll:'<path d="M2 9V3h16v6H2zm14-4h-4v2h4V5zM2 17v-6h16v6H2zm4-4h10v2H6v-2z" fill-rule="evenodd" clip-rule="evenodd" fill="currentColor"></path>',v:'<path d="M5 10h.1A5.006 5.006 0 0 0 9 13.9V16H7v2h6v-2h-2v-2.1a5.006 5.006 0 0 0 3.9-3.9h.1a3 3 0 0 0 3-3V4h-3V2H5v2H2v3a3 3 0 0 0 3 3zm2-6h6v5a3 3 0 1 1-6 0V4zm8 2v2a1 1 0 0 0 1-1V6h-1zM4 6h1v2a1 1 0 0 1-1-1V6z" fill-rule="evenodd" clip-rule="evenodd" fill="currentColor"></path>'},he=new Image;he.src="https://static-cdn.jtvnw.net/subs-image-assets/gift-illus.png";let pe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=null,me=document.createElement("button");function E(e,t=20,n=20,o=20,i=20){var a=document.createElementNS("http://www.w3.org/2000/svg","svg");return a.setAttribute("width",t),a.setAttribute("height",n),a.setAttribute("viewBox",`0 0 ${o} `+i),a.style.color="var(--text-color)",a.style=`min-height: ${n}px; min-width: ${t}px;`,a.innerHTML=e,a}function fe(e,t=0){var n=e<0,o=n?-e:e,i=Math.floor(o/3600),a=Math.floor(o%3600/60),o=Math.floor(o%60),n=n?"-":"",i=0<i?n+i.toString().padStart(2,"0")+`:${a.toString().padStart(2,"0")}:`+o.toString().padStart(2,"0"):n+a.toString().padStart(2,"0")+":"+o.toString().padStart(2,"0");return t?i+"."+(e%1).toFixed(t).substring(2):i}function ve(e){e.offsetHeight}me.textContent="▼ Scroll to Bottom",me.className="scroll-bottom-btn",me.addEventListener("click",()=>{p.scrollTop=p.scrollHeight}),h.appendChild(me),p.addEventListener("scroll",ut);class ge{constructor(e,t){this.operationName=e,this.sha256Hash=t,this.extensions={persistedQuery:{version:1,sha256Hash:this.sha256Hash}}}g(e={}){return{operationName:this.operationName,extensions:this.extensions,variables:e}}}class be extends ge{constructor(){super("BitsConfigContext_Global","6a265b86f3be1c8d11bdcf32c183e106028c6171e985cc2584d15f7840f5fee6")}}class we extends ge{constructor(){super("StreamMetadata","b57f9b910f8cd1a4659d894fe7550ccc81ec9052c01e438b290fd66a040b9b93")}}class xe extends ge{constructor(){super("ChatList_Badges","838a7e0b47c09cac05f93ff081a9ff4f876b68f7624f0fc465fe30031e372fc2")}}class ye extends ge{constructor(){super("GlobalBadges","9db27e18d61ee393ccfdec8c7d90f14f9a11266298c2e5eb808550b77d7bcdf6")}}class Me extends ge{constructor(){super("getUserLoginInfo","324dbc4e29626d9db7a013bed894b0745f2104c279386a00e17f637e6e2d0fe0")}}let ke=new class{M=new be;k=new xe;$=new ye;L=new we;C=new Me};class B extends Error{constructor(e){super("string"==typeof e?e:JSON.stringify(e)),this.name="RequestError",this.P=e}}let F=new class{constructor(e=30,t=35,n=3e3){this.A=e,this.S=t,this.I=n,this.T=[],this.total=0,this.B=0,this.F=null,this.endpoint="https://gql.twitch.tv/gql",this.headers={"Client-ID":"kimne78kx3ncx6brgo4mv6wki5h1ko","Device-Id":Array(32).fill(0).map(()=>pe.charAt(Math.floor(Math.random()*pe.length))).join(""),"Accept-Language":"en-US"}}async add(t,i=10){for(;0<=i;){let n,o;var e=new Promise((e,t)=>{n=e,o=t}),a=(this.T.push({R:t,resolve:n,reject:o}),this.T.length),r=Date.now();1===a?(this.B=r,this.F=setTimeout(()=>{this.H(),this.A})):(a>=this.S||r-this.B>=this.A)&&(this.F&&(clearTimeout(this.F),this.F=null),this.H());try{return await e}catch(e){if(--i<0)throw a=t.operationName||"unknown",new Error(`Failed to execute operation "${a}" after retries: `+e.message)}}}async H(){if(this.T.length){var n=this.T,t=(this.T=[],this.F&&(clearTimeout(this.F),this.F=null),n.length);this.total+=t;try{console.debug(`Collecting ${t} promises...`);var o=JSON.stringify(n.map(e=>e.R)),i=this.D(o.length),a=Date.now();let e=new AbortController;var r=setTimeout(()=>e.abort(),this.I),l=await fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json",...this.headers},body:o,signal:e.signal});if(clearTimeout(r),!l.ok)throw new Error(`Invalid response status (${l.status})`);var s=await l.text(),c=this.D(s.length),d=JSON.parse(s),u=((Date.now()-a)/1e3).toFixed(2);console.debug(`Collected ${t} promise(s) (${i}) in ${u}s (${c}). Total: `+this.total);for(let e=0;e<n.length;e++){var h,p,m=n[e],f=d[e];f.errors?(h=new B(f.errors),p=m.R.operationName||"Unknown",console.warn(`[${p}] Operation error: `+JSON.stringify(f.errors)),m.reject(h)):m.resolve(f.data||f)}}catch(t){console.error(`Error collecting ${n.length} promises: `+t.message);for(let e=0;e<n.length;e++)n[e].reject(new B(t))}}}D(e){return e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB"}},$e=new class{constructor(e,t,n=1){this.O=e,this.V=t,this.version=n,this.N=null}async init(){return this.N||new Promise((t,n)=>{if(window.indexedDB){let e=indexedDB.open(this.O,this.version);e.onerror=()=>n(e.error),e.onsuccess=()=>{this.N=e.result,t(this.N)},e.onupgradeneeded=e=>{e=e.target.result;e.objectStoreNames.contains(this.V)||e.createObjectStore(this.V,{keyPath:"id"})}}else n(new Error("IndexedDB not supported"))})}async set(o,i){try{return this.N||await this.init(),new Promise((e,t)=>{let n=this.N.transaction([this.V],"readwrite").objectStore(this.V).put({id:o,data:i,timestamp:Date.now()});n.onerror=()=>t(n.error),n.onsuccess=()=>e(!0)})}catch(e){return console.warn("IndexedDB set failed:",e),!1}}async get(o){return this.N||await this.init(),new Promise((t,e)=>{let n=this.N.transaction([this.V],"readonly").objectStore(this.V).get(o);n.onerror=()=>e(n.error),n.onsuccess=()=>{var e=n.result;t(e?e.data:null)}})}async delete(o){try{return this.N||await this.init(),new Promise((e,t)=>{let n=this.N.transaction([this.V],"readwrite").objectStore(this.V).delete(o);n.onerror=()=>t(n.error),n.onsuccess=()=>e(!0)})}catch(e){return console.warn("IndexedDB delete failed:",e),!1}}async U(){try{return this.N||await this.init(),new Promise((e,t)=>{let n=this.N.transaction([this.V],"readwrite").objectStore(this.V).clear();n.onerror=()=>t(n.error),n.onsuccess=()=>e(!0)})}catch(e){return console.warn("IndexedDB deleteAll failed:",e),!1}}},R=new class{constructor(){this.j=new Map,this._=new Map,this.h=null,this.J=null,this.q=[],this.G=[],this.X=[],this.K=[],this.Y=null,this.poll=null}W(){for(let e=0,t=w;e<t;e++){var n,o=b[e],i=o.type;"pin"===i?"pin-message"===o.data.type&&("CHEER"===(n=o.data.data.message.type)?this.q.push(o.data.data):"MOD"===n&&this.G.push(o.data.data)):"poll"===i&&("POLL_CREATE"===(n=o.data.type)?this.X.push(o.data.data.poll):"POLL_COMPLETE"===n&&this.K.push(o.data.data.poll))}}Z(e){}ee(e){}te(e){}ne(e){}oe(e){}ie(){let n=V();if(this.poll&&(this.poll.ae+60<=n||this.poll.re>n))this.le(this.poll.id);else if(this.poll){if(!this.poll.se)return;let e=V();var t=e-this.poll.re,o=this.poll.se;return o.style.animation="none",ve(this.poll.se),o.style.animation=`translateRightToLeft ${this.poll.duration*g}s linear both`,o.style.animationDelay=`-${t*g}s`,void(o.style.animationPlayState=v.paused?"paused":"running")}for(let e=0,t=this.X.length;e<t;e++){var i=this.X[e],a=Date.parse(i.started_at)/1e3,r=a+i.duration_seconds;if(a<=n&&n<r+60){this.ce(i);for(let e=0,t=this.K.length;e<t;e++){var l=this.K[e];if(l.id===i.id){this.de(l);break}}return}}}ce(e){if(this.poll){if(this.poll.id===e.poll_id)return;this.le(this.poll.id)}var t=e.poll_id,n=e.created_by,o=re.get(n),i=e.title,a=Date.parse(e.started_at)/1e3,r=e.duration_seconds,l=V(),s=a+r;if(l<=a||s+60<l)return;var s=s<l,c=e.choices,d=c.length,u=e.votes.total;let h=document.createElement("div");h.className="marquee-container";l=document.createElement("div");l.className="marquee-content",l.appendChild(E(T.poll,30,30,20,20)),l.appendChild(document.createTextNode(s?"Poll Ended":"Poll Started!")),h.appendChild(l),q.appendChild(h),l.style.animation="marqueeFromRight 3s linear";let p=document.createElement("div");p.className="poll-container";e=document.createElement("div"),e.className="poll-header-container",s=document.createElement("div");s.style="display: flex; flex-direction: column; gap: 6px;";let m=document.createElement("span");m.style="color: var(--timestamp-color); font-size: 0.8rem;",o?m.textContent="Current Poll by "+o:(m.textContent="Current Poll",(async e=>{var t=await F.add(ke.C.g({id:e}));if(t=t&&t.user&&t.user.login||null)return re.set(e,t),t})(n).then(e=>{this.poll&&(m.textContent="Current Poll by "+e,this.poll.ue=e)}));l=document.createElement("span"),l.style="font-weight: bold; font-size: 0.9rem;",l.textContent=i,s.appendChild(m),s.appendChild(l),e.appendChild(s),n=document.createElement("div");n.style.color="var(--text-color)";let f=E(T.collapse,18,18,20,20);f.setAttribute("class","btn");function v(e){e.stopPropagation(),f.innerHTML=E(T.collapse,18,18,20,20).innerHTML,f.onclick=g,b.style.display="flex",R.poll&&(R.poll.isCollapsed=!1)}function g(e){e.stopPropagation(),f.innerHTML=E(T.expand,18,18,20,20).innerHTML,f.onclick=v,b.style.display="none",R.poll&&(R.poll.isCollapsed=!0)}f.onclick=e=>g(e),e.onclick=e=>{("none"===b.style.display?v:g)(e)},n.appendChild(f),e.appendChild(n),p.appendChild(e);let b=document.createElement("div");b.className="poll-choice-container";var w=new Map;for(let e=0;e<d;e++){var x=c[e],y=x.choice_id||e,M=x.title,x=x.votes.total,k=document.createElement("div"),$=(k.className="poll-choice",document.createElement("div")),z=($.className="sweep",k.appendChild($),document.createElement("span")),M=(z.id="poll-title",z.style="font-weight: bold; font-size: 0.9rem; z-index: 1;",z.textContent=M,k.appendChild(z),document.createElement("div")),z=(M.style="display: flex; align-items: center; gap: 5px; z-index: 1;",document.createElement("span")),L=(z.style="font-size: 0.85rem;",u?(x/u*100).toFixed(1):"0.0"),L=($.style.width=L+"%",$.style.background="var(--choice-sweep-bg)",$.dataset.he=L,document.createTextNode(L)),C=(z.appendChild(L),z.appendChild(document.createTextNode("%")),document.createElement("span")),x=(C.style="font-size: 0.85rem;",document.createTextNode(""+x));C.appendChild(document.createTextNode("(")),C.appendChild(x),C.appendChild(document.createTextNode(")")),M.appendChild(z),M.appendChild(C),k.appendChild(M),b.appendChild(k),w.set(y,[k,L,x,$])}p.appendChild(b);let P=document.createElement("div");function A(){h.replaceWith(p),R.poll.se=P,R.ie(),p.appendChild(P)}P.className="animated-border",p.classList.add("animated-border-container");let S=setTimeout(A,3e3);h.onclick=()=>{clearTimeout(S),A()},this.poll={id:t,title:i,pe:c,me:Array.from(w.keys()),fe:w,duration:r,re:a,ae:a+r,ue:o,ve:h,ge:S,isCollapsed:!1,be:u,se:null,element:p,finished:!1}}we(e){var t=e.poll_id;if(this.poll){if(this.poll.id===t){if(this.poll.finished){if(!(V()<this.poll.ae))return;this.xe(t)}var n=e.votes.total,o=e.choices,i=this.poll.be,a=this.poll.isCollapsed;for(let e=0;e<o.length;e++){var r=o[e],l=r.choice_id||this.poll.me[e],r=r.votes.total,[,l,s,c]=this.poll.fe.get(l),d=this.poll.pe[e].votes.total,u=i?d/i*100:0,h=n?r/n*100:0;a?(c.style.width=h+"%",c.dataset.he=h,l.textContent=h.toFixed(1),s.textContent=r.toString()):(((n,o,i,a)=>{if(r=n.parentElement)if(0===r.offsetWidth)n.style.width=o+"%",n.dataset.he=o;else{var r=r.clientWidth||parseFloat(getComputedStyle(r).width)||1;let e=parseFloat(getComputedStyle(n).width),t=(e=Number.isFinite(e)?e:0)/r*100;(r<=1||0===e)&&n.dataset.he&&0<(r=parseFloat(n.dataset.he))&&(t=r),n.ye&&(n.ye.cancel(),n.ye=null),Math.abs(t-o)<.1?(n.style.width=o+"%",n.dataset.he=o):(n.ye=n.animate([{width:t+"%"},{width:o+"%"}],{duration:i,easing:a,fill:"forwards"}),n.dataset.he=o,n.ye.onfinish=()=>{n.style.width=o+"%",n.ye=null})}})(c,h,777,"cubic-bezier(0.165, 0.84, 0.44, 1)"),((n,o,i,a,e)=>{let r=null,l=new Intl.NumberFormat("en-US",{minimumFractionDigits:e,maximumFractionDigits:e}),s=e=>{r=r||e;var e=Math.min((e-r)/a,1),t=o+(i-o)*e;n.textContent=l.format(t),e<1&&window.requestAnimationFrame(s)};window.requestAnimationFrame(s)})(l,u,h,666,1),((n,o,i,a)=>{let r=null,l=new Intl.NumberFormat("en-US"),s=e=>{r=r||e;var e=Math.min((e-r)/a,1),t=Math.floor(e*(i-o)+o);n.textContent=l.format(t),e<1&&window.requestAnimationFrame(s)};window.requestAnimationFrame(s)})(s,d,r,666))}this.poll.be=n,this.poll.pe=o}}else this.ce(e)}xe(e){this.poll&&this.poll.id===e&&(this.poll.pe.forEach((e,t)=>{var n,[e]=this.poll.fe.get(e.choice_id||this.poll.me[t]),t=(e.style.order=t,e.style.background="",e.style.zIndex="",e.querySelector("#poll-title"));t&&((n=t.firstChild)&&"svg"===n.tagName&&n.remove(),t.style.display="",t.style.gap=""),e.style.transform=""}),this.poll.finished=!1,this.ie())}de(e){var n=e.poll_id;if(this.poll&&this.poll.id===n&&!this.poll.finished){this.we(e);let t=e.choices;n=t.findIndex(e=>e.votes.total===Math.max(...t.map(e=>e.votes.total))),e=t[n].choice_id||this.poll.me[n],n=this.poll.fe.get(e)[0],e=(n.style.background="#01f593bb",n.style.zIndex="1",n.querySelector("#poll-title"));e.style.display="flex",e.style.gap="3px",e.insertBefore(E(T.v,18,18),e.firstChild);n=Array.from(this.poll.fe.values()).map(([e])=>e);if(this.poll.isCollapsed)n.sort((t,n)=>{var e=this.poll.pe.find(e=>this.poll.fe.get(e.choice_id)[0]===t).votes.total;return this.poll.pe.find(e=>this.poll.fe.get(e.choice_id)[0]===n).votes.total-e}),n.forEach((e,t)=>e.style.order=t);else{let o=new Map;n.forEach(e=>o.set(e,e.getBoundingClientRect())),n.sort((t,n)=>{var e=this.poll.pe.find(e=>this.poll.fe.get(e.choice_id)[0]===t).votes.total;return this.poll.pe.find(e=>this.poll.fe.get(e.choice_id)[0]===n).votes.total-e}),n.forEach((e,t)=>{e.style.order=t}),ve(this.poll.element),n.forEach(n=>{var e=o.get(n),t=n.getBoundingClientRect(),e=e.top-t.top;Math.abs(e)<1||(n.style.transform=`translateY(${e}px)`,n.style.transition="none",requestAnimationFrame(()=>{n.style.transition="transform 400ms ease",n.style.transform=""}),n.addEventListener("transitionend",function e(t){"transform"===t.propertyName&&(n.style.transition="",n.removeEventListener("transitionend",e))}))})}this.poll.finished=!0}}le(e){this.poll&&this.poll.id===e&&(clearTimeout(this.poll.ge),this.poll.ve&&this.poll.ve.remove(),this.poll.element.remove(),this.poll=null)}Me(){var e=V();let t=this.G.length;for(;t--;){var n=this.G[t];if(!(n.message.starts_at>e||e>n.message.ends_at))return this.h&&this.h.id===n.message.id?void 0:void this.ke(n)}}ke(e){var e=e.message,t=e.id,n=e.sender;n["display-name"]=n.display_name,n.badges=Ve(n.badges);let o=D(n,n.chat_color,n.badges);var i=e.starts_at,a=e.ends_at,r=a-i;let l=document.createElement("div"),s=(l.className="pin-placeholder",document.createElement("div"));s.className="pin-left-container";var c=document.createElement("div"),d=(c.style="display: flex; align-items: center; gap: 3px;",c.appendChild(E(T.h,16,16,20,20)),document.createElement("span")),u=(d.style="font-weight: 500; font-size: 0.85rem;",_e(n.badges)),u=(u.style="margin: 0 2px 0 6px;",d.textContent="Pinned by",d.appendChild(u),d.appendChild(document.createTextNode(n["display-name"])),c.appendChild(d),s.appendChild(c),H(e.content.text,Oe(e.content),!1));let h=document.createElement("span");h.style="font-size: 1.1rem;",h.appendChild(u);for(var p,d=h,m=document.createTreeWalker(d,NodeFilter.SHOW_TEXT,null),f=[];m.nextNode();)f.push(m.currentNode);for(p of f){let r=p.nodeValue;if(ue.test(r)){ue.lastIndex=0;let i=document.createDocumentFragment(),a=0;r.replace(ue,(e,t,n)=>{n>a&&i.appendChild(document.createTextNode(r.slice(a,n)));var o=document.createElement("a");return o.textContent=e,o.href=e.startsWith("http")?e:"https://"+e,o.target="_blank",o.rel="noopener noreferrer",i.appendChild(o),a=n+e.length,e}),a<r.length&&i.appendChild(document.createTextNode(r.slice(a))),p.replaceWith(i)}}s.appendChild(h),s.appendChild(o);c=document.createElement("div"),c.style="display: flex; gap: 5px; margin-right: 6px;",e=E(T.hide,18,18,20,20),e.setAttribute("class","btn"),u=document.createElementNS("http://www.w3.org/2000/svg","title");u.textContent="Hide Pinned message",e.insertBefore(u,e.firstChild),c.appendChild(e);let v=E(T.collapse,18,18,20,20),g=(v.setAttribute("class","btn"),document.createElementNS("http://www.w3.org/2000/svg","title")),b=(g.textContent="Collapse",document.createElementNS("http://www.w3.org/2000/svg","title"));function w(){l.style.display="none";let e=document.createElement("button");e.className="chat-header-btn btn",e.title="Show Pinned message",e.appendChild(E(T.h)),e.onclick=()=>{l.style.display="flex",e.remove(),R.Y=null},R.Y?R.Y.replaceWith(e):N.prepend(e),R.Y=e}function x(){v.innerHTML=E(T.expand,18,18,20,20).innerHTML,h.style="word-break: break-word; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",o.style.display="none",v.onclick=y,v.insertBefore(b,v.firstChild)}function y(){s.style.overflow="visible",h.style="font-size: 1.1rem;",o.style.display="",v.innerHTML=E(T.collapse,18,18,20,20).innerHTML,v.onclick=x,v.insertBefore(g,v.firstChild)}b.textContent="Expand",v.insertBefore(g,v.firstChild),c.appendChild(v),e.onclick=w,this.Y&&w(),v.onclick=x,l.appendChild(s),l.appendChild(c),J.innerHTML="",J.appendChild(l),this.h={id:t,$e:i,ae:a,duration:r,sender:n}}ze(e){this.h&&this.h.id===e&&(this.h=null,J.innerHTML="")}Le(){var n=V();for(let e=0,t=this.q.length;e<t;e++){var o=this.q[e];o.message.starts_at>n||n>o.message.ends_at||this.j.has(o.message.id)||this.Ce(o)}}Pe(){var n,o,i,e=O(),a=d.createdUnix+e;for(let[e,t]of this.j)t.$e>a||t.ae<a?this.Ae(e):(n=t.duration,o=((i=t.ae-a)<=0&&this.Ae(e),clearTimeout(t.Se),n-i),n=n/g,o=o/g,i=i/g*1e3,t.Ie.style.animation="none",ve(t.Ie),t.Ie.style.animation=`widthLeftToRight ${n}s linear both`,t.Ie.style.animationDelay=`-${o}s`,t.Ie.style.animationPlayState=v.paused?"paused":"running",t.Se=setTimeout(()=>{this.Ae(e)},i))}Ce(e){var t,n,o,i,a,r,l,s,c,d,u,h,p,m,e=e.message;let f=e.id;this.j.has(f)||(t=e.sender,u=V(),n=e.starts_at,(i=e.ends_at)<u)||(u=(o=i-n)-(i=i-u),d=o/g,u=u/g,i=i/g*1e3,a=e.metadata.bitsAmount,r=e.metadata.level,m=1e3<=a?Math.floor(a/1e3)+"K":a.toString(),h=t.display_name.slice(0,2),p=E(T.bits,20,20,20,20),(l=document.createElement("div")).className="pinned-cheer pinned-cheer-colors-level-"+r.toLowerCase(),(s=document.createElement("div")).className="pinned-cheer-inner",(c=document.createElement("div")).className="sweep",c.style.animation=`widthLeftToRight ${d}s linear both`,c.style.animationDelay=`-${u}s`,c.style.animationPlayState=v.paused?"paused":"running",l.appendChild(c),(d=document.createElement("span")).style="color: white; font-weight: 700; display: flex; vertical-align: middle; align-items: center; gap: 1px; position: relative; z-index: 1;",d.appendChild(document.createTextNode(h)),d.appendChild(p),d.appendChild(document.createTextNode(""+m)),s.appendChild(d),l.appendChild(s),j.prepend(l),u=Oe(e.content),h=H(e.content.text,u,!0),(p=document.createElement("div")).appendChild(h),m=p.innerHTML,t.badges=Ve(t.badges),t["display-name"]=t.display_name,l.onclick=()=>this.Te(f),l.title=t["display-name"]+" "+a,this.j.set(f,{element:l,Ie:c,Ee:a,level:r,$e:n,ae:e.ends_at,duration:o,Se:setTimeout(()=>{this.Ae(f)},i),Be:m,sender:t}))}Ae(e){var t=this.j.get(e);t&&(t.element.remove(),this.j.delete(e))}Te(e){let t=this.j.get(e);if(!t)return;if(this.J){if(this.J.id===e)return;this.J.close()}let n=document.createElement("div");n.className="pinned-bits-details pinned-cheer-colors-level-"+t.level.toLowerCase();var o=D(t.sender,t.sender.chat_color,t.sender.badges),i=document.createElement("div"),a=document.createElement("div");a.appendChild(o),a.style="display: flex; justify-content: space-between; align-items: center; gap: 10px;",a.appendChild(o);let r=document.createElement("span"),l=(r.style="font-size: 0.85rem; font-weight: 700; color: var(--text-color);",a.appendChild(r),fe(t.duration));function s(){var e=(t.ae-V())/g;e<=0?(r.textContent="00:00",clearInterval(c)):(e=fe(e),r.textContent=e,r.title=e+" / "+l)}s();let c=setInterval(s,1e3);i.appendChild(a),i.style="margin: 3px; display: flex; flex-direction: column; gap: 7px; background: var(--panel-bg); border-radius: 5px; padding: 10px;";o=document.createElement("span"),o.className="chat-text",o.innerHTML=t.Be,i.appendChild(o),n.appendChild(i),a=document.createElement("div"),a.style="margin-left: 6px; gap: 1px; display: flex; align-items: center; vertical-align: middle; margin-bottom: 3px; color: black",a.appendChild(E(T.bits,22,22,20,20)),o=document.createElement("span");o.style="font-weight: 700;",o.textContent=t.Ee.toString(),a.appendChild(o),n.appendChild(a),_.appendChild(n);let d=t.element.childNodes[1],u=(d.dataset.Fe=d.style.background,d.style.background="var(--cheer-clicked-bg)",()=>{d.style.background=d.dataset.Fe,n.remove(),R.J=null,t.element.onclick=()=>this.Te(e)});n.onclick=e=>{u()},this.J={Re:n,id:e,close:u},t.element.onclick=()=>u()}He(){if(P&&this.j)for(var[e,t]of this.j)t.Ie.style.animationPlayState="paused",clearTimeout(t.Se);A&&this.poll&&this.poll.se&&(this.poll.se.style.animationPlayState="paused")}De(){if(P&&this.j){this.Pe();for(var[e,t]of this.j)t.Ie.style.animationPlayState="running"}A&&this.ie()}Oe(){P&&(this.Pe(),this.Le()),this.Me(),A&&this.ie()}Ve(){P&&this.Pe(),A&&this.ie()}};function ze(e){te=e;var t=document.createElement("style");t.id="channel-color-style",t.textContent=`.chat-message.monet { border-left-color: ${e} !important; }`,t.parentNode||document.head.appendChild(t)}async function Le(t){try{var n=t.stream(),o=new DecompressionStream("gzip"),i=n.pipeThrough(o),a=await new Response(i).arrayBuffer(),r=new Uint8Array(a),l={};let e=0;for(;e+512<=r.byteLength;){var s=r.slice(e,e+512);if(s.every(e=>0===e))break;var c=s.slice(0,100);let t="";for(let e=0;e<c.length&&0!==c[e];e++)t+=String.fromCharCode(c[e]);var d=String.fromCharCode(s[156]),u=s.slice(124,136);let n="";for(let e=0;e<u.length&&0!==u[e];e++)n+=String.fromCharCode(u[e]);var h=parseInt(n.trim()||"0",8);if(console.log("TAR entry:",t,"type:",d,"size:",h),"0"!==d&&"\0"!==d||t.includes("PaxHeader")){var p=Math.ceil(h/512);e+=512+512*p}else{if(0<h&&(t.endsWith(".json")||t.endsWith("-metadata.json"))){var m=e+512,f=r.slice(m,m+h);try{var v=new TextDecoder("utf-8").decode(f),g=JSON.parse(v);l[t]=g,console.log("Extracted:",t,"size:",F.D(h))}catch(e){console.warn("Failed to parse JSON for",t,":",e)}}var b=Math.ceil(h/512);e+=512+512*b}}var w=y+"-metadata.json",x=y+".json";return(console.log("Available files:",Object.keys(l)),l[w]&&l[x])?(console.log("Successfully extracted both metadata and chat log"),[l[w],l[x]]):(console.warn("Target files not found"),null)}catch(e){return console.error("Failed to parse compressed chat log:",e),null}}async function Ce(){if(!l){console.log("Looking for cached chat for stream:",y);var t=async()=>{console.log("Falling back to uncompressed chat log...");var e=fetch(c).then(e=>e.json()).then(e=>{d=e,Y=e.owner,nt(),tt()}),[,e]=await Promise.all([e,fetch(r)]);b=await e.json()},e=await $e.get(y);if(e instanceof Blob)[d,b]=await Le(e),console.log("Chat loaded from IndexedDB cache");else{console.log("No cached chat found, trying compressed chat log first...");try{var n,o,i=await fetch(u);200===i.status&&(o=await Le(n=await i.blob()))instanceof Array?([d,b]=o,await $e.set(y,n),console.log("Chat cached in IndexedDB for future use")):await t()}catch(e){console.warn("Failed to fetch compressed chat log:",e),await t()}if(!Array.isArray(b))return void console.error("Failed to load chat log from any source")}l=!0,w=b.length,console.log("Chat loaded with",w,"messages"),Y=d.owner,nt(),tt(),d.accentColor&&ze(d.accentColor),K=d.videoOffset||0,R.W()}}function Pe(e){return`https://static-cdn.jtvnw.net/emoticons/v2/${e}/default/dark/${S}.0`}function Ae(t){if(t&&t.length){let e=t.length;for(;e--;)(e=>{var t;le.has(e)||(le.add(e),(t=new Image).src=Pe(e),t.onerror=()=>{console.warn("Failed to load emote:",e),le.delete(e)})})(t[e].id)}}function Se(t){if(t&&t.length){let e=t.length;for(;e--;){var n=t[e];(e=>{var t,n;se.has(e)||((t=ae.get(e)||ie.get(e))?((n=new Image).src=t[k],n.onerror=()=>{console.warn("Failed to load badge:",e)},n.onload=()=>{se.add(e)}):console.warn("Unknown badge ID:",e))})(""+n.name+n.value)}}}function Ie(){if(l){var t=b[s].offset+ne;let e=s;for(;e<w&&b[e].offset<t;){var n=b[e];Ae(n.data.emotes),Se(n.data.badges),n.data.user&&!n.data.color&&(n=n.data.user.login,ce.has(n)||Ue(n)),e++}}}function Te(e,t,n,o,i){let a={PREFIX:e.toLowerCase(),BACKGROUND:t,ANIMATION:n?"animated":"static",TIER:o,SCALE:i,EXTENSION:n?"gif":"png"};return Q.replace(/\b(PREFIX|BACKGROUND|ANIMATION|TIER|SCALE|EXTENSION)\b/g,e=>a[e])}function Ee(i=null){if(null===Q)console.warn("Bits template URL not set");else{let n=0,o=0;for(var[,e]of m.entries())n+=e.length;i&&i(o,n);for(var[a,r]of m.entries()){let t=r.length;for(;t--;){var l=r[t];let e=Te(a,"dark",!0,l,I);l=new Image;l.onload=()=>{o++,i&&i(o,n)},l.onerror=()=>{console.warn("Failed to preload bits image:",e),o++,i&&i(o,n)},l.src=e}}}}function Be(e=null){var n,t=Array.from(ie.values()),o=Array.from(ae.values());let i=t.length+o.length,a=0,r=(e&&e(a,i),()=>{a++,e&&e(a,i)});for(n of[t,o]){let t=n.length;for(;t--;){var l=n[t];let e=""+l.setID+l.version;var s=new Image;s.onload=r,s.onerror=()=>{console.warn("Failed to preload badge:",e),r()},s.src=l[k]}}}function Fe(){var t=new Set;let e=b.length;for(;e--;){var n=b[e].data.emotes;if(n){let e=n.length;for(;e--;)t.add(n[e].id)}}return t}function Re(t=null){var n=Fe();let o=n.size,i=0;t&&t(i,o);for(let e of n){var a=new Image;a.onload=()=>{i++,t&&t(i,o)},a.onerror=()=>{console.warn("Failed to preload emote:",e),i++,t&&t(i,o)},a.src=Pe(e)}}function He(t=null){let e,n,o=0,i=0,a=0,r=0;var l,s;e=Fe().size,n=ie.size+ae.size;for([l,s]of m.entries())o+=s.length;let c=e+n+o,d=()=>{var e=i+a+r;t&&t(e,c)};Re((e,t)=>{i=e,d()}),Be((e,t)=>{a=e,d()}),Ee((e,t)=>{r=e,d()})}function De(e,t,n){e.querySelector(t).addEventListener("click",function(){let r=this;var e;r.dataset.originalColor=r.style.color||"",r.style.color="#FFFFFF",(e=r).disabled=!0,e.dataset.originalText=e.textContent,e.dataset.originalBackground=e.style.backgroundColor||"",n((e,t)=>{var n,o,i,a;n=r,a=e,i=0<(o=t)?Math.round(a/o*100):0,n.textContent=a+`/${o} (${i}%)`,n.style.background=`linear-gradient(to right, var(--accent-color, #9147ff) ${i}%, var(--panel-border) ${i}%)`,t<=e&&((a=r).disabled=!1,a.style.backgroundImage="",a.textContent=a.dataset.originalText,a.style.backgroundColor=a.dataset.originalBackground||"var(--panel-border)",a.style.color=a.dataset.originalColor||"var(--text-color)")})})}function Oe(e){var n=new Map;let o=0;var t=e.text,i=e.fragments,a=Ne(t);for(let e=0,t=i.length;e<t;e++){var r=i[e],l=o;if(o+=r.text.length,r.emoticon){var s=r.emoticon.emoticonID;let e;n.has(s)?e=n.get(s):(e={id:s,len:r.text.length,pos:[]},n.set(s,e)),e.pos.push(a[l])}}return Array.from(n.values())}function Ve(t){if(!t||!t.length)return[];if(void 0!==t[0].name)return t;var n=t.length,o=new Array(n);for(let e=0;e<n;e++){var i=t[e];o[e]={name:i.id,value:i.version}}return o}function Ne(e){var t,n=[0];let o=0;for(t of e)o+=t.length,n.push(o);return n}function H(o,e,t=!1){if(!(e&&e.length||t))return document.createTextNode(o);var n,i=[];if(e){let n=Ne(o);i.push(...e.flatMap(t=>t.pos.map(e=>({Ne:!1,start:n[e],end:n[e+t.len],id:t.id}))))}if(t&&ee)for(ee.lastIndex=0;null!==(n=ee.exec(o));)i.push({Ne:!0,start:n.index,end:n.index+n[0].length,Ue:n[1],Ee:parseInt(n[2],10)});i.sort((e,t)=>e.start-t.start);var a=document.createDocumentFragment();let r=0;for(let e=0,t=i.length;e<t;e++){var l=i[e],s=(l.start>r&&(s=o.substring(r,l.start),a.appendChild(document.createTextNode(s))),document.createElement("img"));if(s.onerror=function(){this.replaceWith(document.createTextNode(this.alt))},l.Ne){var c=m.get(l.Ue.toLowerCase());let t=1;if(c){let e=c.length;for(;e--;)if(l.Ee>=c[e]){t=c[e];break}}var d=document.createElement("span"),u=(d.className="bits-container",d.style="display: inline-flex; align-items: center; vertical-align: middle; gap: 4px; margin-left: 2px; margin-right: 2px;",s.src=Te(l.Ue,"dark",!0,t,I),s.title=s.alt=""+l.Ue+l.Ee,s.style="height: 1.6rem; width: auto; vertical-align: middle;",document.createElement("span"));u.textContent=l.Ee.toString(),u.style=`font-weight: bold; color: ${Z.get(t)};`,d.appendChild(s),d.appendChild(u),a.appendChild(d)}else s.src=Pe(l.id),s.title=s.alt=o.substring(l.start,l.end),s.style.cssText="height: 1.6rem; width: auto; vertical-align: middle;",a.appendChild(s);r=l.end}return r<o.length&&(e=o.substring(r),a.appendChild(document.createTextNode(e))),a}function Ue(e){var t=e.toString().split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0),t=Math.abs(t)%de.length,t=de[t];return ce.set(e,t),t}function je(e){return ce.get(e)||Ue(e)}function _e(e){var t,n=document.createElement("span");n.style="margin-right: 4px;";for(t of e){var o,i=""+t.name+t.value,a=ae.get(i)||ie.get(i);a?((o=document.createElement("img")).src=a[k],o.style="height: 1.0rem; width: auto; vertical-align: middle; margin-right: 4px;",o.title=o.alt=a.title,n.appendChild(o)):console.warn("Badge not found: "+i)}return n}function D(t,e,n=null){var o=document.createElement("span"),i=(o.className="chat-username",t.login||t["display-name"]),e=e||je(i);return o.style=`color: ${e}; cursor: pointer;`,o.textContent=t["display-name"]||i,o.onclick=e=>at(t,e),oe&&n&&n.length?(e=document.createElement("span"),i=_e(n),e.appendChild(i),e.appendChild(o),e):o}function Je(e){var t,n=e.type,o=e.data,i=document.createElement("div");i.className="chat-message "+n,i.id=o.id||0,$&&((t=document.createElement("span")).className="timestamp",t.textContent=fe(e.offset-K),i.appendChild(t));let a,r;switch(n){case"msg":r=D(o.user,o.color,o.badges);var l=document.createElement("span");if(l.className="chat-text",l.textContent=": ","reply"===(a=o["msg-id"])){var s=E(T.reply,18,18,20,20),c=(s.style.color="var(--timestamp-color)",document.createElement("div")),s=(c.style="display: flex; gap: 5px; margin-bottom: 2px; align-items: center;",c.appendChild(s),o.reply["parent-msg-body"]),d=o.reply["parent-display-name"],s=`Replying to @${d}: `+s;let n=o.reply["parent-msg-id"];var u=document.createElement("a"),s=(u.onclick=e=>{e.preventDefault();let t=p.querySelector(`.chat-message[id="${n}"]`);t&&(t.scrollIntoView(),t.style.backgroundColor="rgba(255,255,0,0.3)",setTimeout(()=>t.style.backgroundColor="",200))},u.textContent=s,u.style="color: var(--timestamp-color);",c.appendChild(u),i.appendChild(c),H(o.text,o.emotes)),u=(l.appendChild(s),`@${d} `),c=l.childNodes[1];return c&&c.nodeType===Node.TEXT_NODE&&c.nodeValue.startsWith(u)&&(c.nodeValue=c.nodeValue.slice(u.length)),i.appendChild(r),i.appendChild(l),i}l.appendChild(H(o.text,o.emotes)),i.appendChild(r),i.appendChild(l);break;case"monet":if("bits"===(a=o["msg-id"])){i.className="chat-message msg";s=document.createElement("span"),d=(s.className="chat-text",s.textContent=": ",H(o.text,o.emotes,!0));s.appendChild(d),i.appendChild(D(o.user,o.color,o.badges)),i.appendChild(s)}else{if(!L)return;r=D(o.user,"var(--sub-color)",null);var c=o.user["display-name"]||o.user.login,u=document.createElement("span");u.className="chat-text",u.style.fontSize="0.9rem";let n=o["system-msg"];if(n.startsWith(c)&&(n=n.substring(c.length).trimStart()),"resub"===a||"sub"===a)return n.startsWith("subscribed")&&(n=n.charAt(0).toUpperCase()+n.slice(1)),u.textContent=" "+n,(l=document.createElement("div")).style="display: flex; flex-direction: column; gap: 2px;",d=document.createElement("div"),(c=E((s="Prime"===o["msg-params"]["sub-plan"])?T.l:T.sub,20,20)).style.color=s?"var(--sub-color)":"var(--game-name-color)",d.style="display: flex; align-items: center; gap: 4px; margin-top: 2px; margin-left: 2px;",u.style.marginLeft="24px",d.appendChild(c),d.appendChild(r),l.appendChild(d),l.appendChild(u),i.appendChild(l),o.text&&((s=document.createElement("div")).style.marginTop="8px",(c=document.createElement("span")).className="chat-text",c.textContent=": ",d=H(o.text,o.emotes),c.appendChild(d),s.appendChild(D(o.user,o.color,o.badges)),s.appendChild(c),i.appendChild(s)),i;if("submysterygift"===a||"subgift"===a){u.textContent=" "+n;var l=document.createElement("div"),d=(l.style="display: flex; align-items: center; gap: 3px; margin-left: 2px; margin-top: 2px;",r.style.fontWeight="bold",document.createElement("div")),c=document.createElement("span");c.className="chat-text";let e=o["system-msg"];s=o.user["display-name"]||o.user.login;e.startsWith(s)&&(e=e.substring(s.length).trimStart()),c.textContent=" "+e,c.style.fontSize="0.9rem";let t;return"submysterygift"===a?((t=document.createElement("img")).src=he.src,t.style="height: 45px; width: auto;",r.style.color=o.color||je(o.user.login),d.style="display: flex; flex-direction: column;"):((t=E(T.i)).style.color="var(--text-color)",r.style.color="var(--text-color)",d.style.marginLeft="4px"),d.appendChild(r),d.appendChild(c),l.appendChild(t),l.appendChild(d),i.appendChild(l),i}u.textContent=" "+n,i.appendChild(r),i.appendChild(u),o.text&&((s=document.createElement("div")).style.marginTop="4px",c=D(o.user,o.color,o.badges),(d=document.createElement("span")).className="chat-text",d.textContent=": ",l=H(o.text,o.emotes),d.appendChild(l),s.appendChild(c),s.appendChild(d),i.appendChild(s))}break;case"inraid":r=D(o.user,"#ff8b38",o.badges);u=document.createElement("span");u.className="chat-text",u.textContent=` is raiding with a party of ${o["msg-params"].viewerCount} viewers`,i.appendChild(r),i.appendChild(u);break;case"mod":if(!z)return;l=document.createElement("span");if(l.className="chat-text","ban"===o["msg-id"])r=D(o["target-user"],"var(--text-color)",null),i.appendChild(r),l.style.color="var(--text-color)",l.textContent=" was banned",o["ban-duration"]&&(l.textContent+=` for ${o["ban-duration"]} seconds`);else if("clear-msg"===o["msg-id"]){let t=p.querySelector(`.chat-message[id="${o["target-msg-id"]}"]`);if(!t)return;c=t.querySelector(".chat-text"),d=(c&&(c.style.opacity="0.7"),document.createElement("a"));d.href="#"+t.id,d.textContent="message deleted",d.style="cursor: pointer; margin-left: 5px; color: #999;",d.addEventListener("click",e=>{e.preventDefault(),t.scrollIntoView(),t.style.backgroundColor="rgba(255,255,0,0.3)",setTimeout(()=>t.style.backgroundColor="",200)}),l.appendChild(d)}else l.textContent="Moderation action";i.appendChild(l);break;case"poll":if(!A)return;switch(o.type){case"POLL_CREATE":R.ce(o.data.poll);break;case"POLL_UPDATE":R.we(o.data.poll);break;case"POLL_COMPLETE":R.de(o.data.poll);break;case"POLL_ARCHIVE":R.le(o.data.poll.poll_id)}return;case"prediction":s=document.createElement("div");s.style.fontWeight="bold",s.textContent=n.charAt(0).toUpperCase()+n.slice(1)+": ","poll"===n&&o.data&&o.data.poll?s.textContent+=o.data.poll.title||"":"prediction"===n&&o.data&&o.data.event&&(s.textContent+=o.data.event.title||""),i.appendChild(s);break;case"pin":return P&&"pin-message"===o.type&&"CHEER"===o.data.message.type?void R.Ce(o.data):void 0;default:u=document.createElement("span");u.className="chat-text",u.textContent=`[${n}] Event`,i.appendChild(u)}return i}function qe(){if(l&&w){var e=O();let t=s;for(;t<b.length&&b[t].offset<=e;)t++;if(t>s){var n=document.createDocumentFragment();for(let e=s;e<t;e++){var o=Je(b[e]);o&&n.appendChild(o)}var i,a=p.scrollHeight-p.clientHeight<=p.scrollTop+100,r=(p.appendChild(n),s=t,p.children);r.length>x&&((i=document.createRange()).setStart(p,0),i.setEnd(p,r.length-x),i.deleteContents()),(a?dt:ut)()}}}function Ge(){s=s>=x?s-x:0,p.innerHTML="",qe()}function Xe(){let n=document.querySelector(".container"),o=document.getElementById("resize-handle"),i,a,r,l=!1;var e;function t(e){l=!0;var t=e.touches[0];i=t.clientX,a=h.offsetWidth,r=n.offsetWidth,document.addEventListener("touchmove",c,{passive:!1}),document.addEventListener("touchend",u),document.addEventListener("touchcancel",u),o.classList.add("active"),document.body.style.userSelect="none",e.preventDefault()}function s(e){l&&(e=e.clientX-i,e=Math.max(200,Math.min(r-200,a-e)),h.style.width=e+"px")}function c(e){var t;l&&(t=e.touches[0].clientX-i,t=Math.max(200,Math.min(r-200,a-t)),h.style.width=t+"px",e.preventDefault())}function d(){l&&(l=!1,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",d),o.classList.remove("active"),document.body.style.userSelect="",dt())}function u(){l&&(l=!1,document.removeEventListener("touchmove",c),document.removeEventListener("touchend",u),document.removeEventListener("touchcancel",u),o.classList.remove("active"),document.body.style.userSelect="",dt())}G&&((e=document.createElement("div")).style.cssText=` position: absolute; top: -15px; bottom: -15px; left: -15px; right: -15px; z-index: 1; touch-action: none; `,o.style.position="relative",o.appendChild(e),e.addEventListener("touchstart",t,{passive:!1})),o.addEventListener("mousedown",function(e){l=!0,i=e.clientX,a=h.offsetWidth,r=n.offsetWidth,document.addEventListener("mousemove",s),document.addEventListener("mouseup",d),o.classList.add("active"),document.body.style.userSelect="none",e.preventDefault()}),o.addEventListener("touchstart",t,{passive:!1})}function O(){return K+v.currentTime}function V(){return d.createdUnix+O()}function Ke(){var e,t;v.paused||(t=(t=>{let n=1/0;var o=d.titles,i=d.games;if(o&&o.length)for(let e=0;e<o.length;e++){var[a,,]=o[e];t<a&&a<n&&(n=a)}if(i&&i.length)for(let e=0;e<i.length;e++){var[r,,]=i[e];t<r&&r<n&&(n=r)}return n===1/0?null:n})(e=O()),a.t&&(clearTimeout(a.t),a.t=null),t&&(t=1e3*(t-e)/v.playbackRate+50,a.t=setTimeout(()=>{nt(),setTimeout(Ke,200)},t)))}function Ye(){if(!v.paused){var n,o,i=O();o=i;let[e,t]=(n=d.viewers)&&n.length?0<=(o=et(o))&&o<n.length-1?[o+1,n[o+1][0]]:[0,n[0][0]]:null;a.viewers&&(clearTimeout(a.viewers),a.viewers=null),t&&(o=1e3*(t-i)/v.playbackRate,a.viewers=setTimeout(()=>{tt(index=e),setTimeout(Ye,200)},o))}}function Qe(){v.paused||(a.o&&(clearTimeout(a.o),a.o=null),a.o=setTimeout(()=>{Ie(),setTimeout(Qe,200)},800*ne))}function We(){Ke(),Ye(),Qe()}function Ze(){for(var e in a)a[e]&&(clearTimeout(a[e]),a[e]=null)}function et(n){var o=d.viewers;if(!o.length||n<o[0][0])return-1;var i,a,e=Math.floor(n/30),r=Math.max(0,e-3),l=Math.min(o.length-1,e+3);let s=-1,c=-1;for(let e=r;e<=l;e++){var[t,,]=o[e];t<=n&&t>c&&(c=t,s=e)}if(-1===s)for(let e=0,t=o.length;e<t;e++)e>=r&&e<=l||([i,a]=o[e],i<=n&&i>c&&(c=i,s=e));return s}function tt(e=null){e=e||et(O()),e=0<=e?d.viewers[e][1]:0;U.textContent=e.toLocaleString()}function nt(){var n=Math.ceil(O()),o=d.titles,i=d.games;if(o&&o.length){let t=o[0][1];for(let e=o.length-1;0<=e;e--){var[a,r]=o[e];if(a<=n){t=r;break}}document.querySelector(".stream-title").textContent=t,document.title=t+" - "+Y.displayName}if(i&&i.length){let t=i[0][1]||"";for(let e=i.length-1;0<=e;e--){var[l,s]=i[e];if(l<=n){t="object"==typeof s?s.name:s;break}}document.getElementById("game-name").textContent=t}}function ot(e){document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),document.getElementById("moon-icon").style.display="light"===e?"none":"block",document.getElementById("sun-icon").style.display="light"===e?"block":"none"}function it(){ot("light"===(localStorage.getItem("theme")||"light")?"dark":"light")}function at(e,c=null){let d=e.id.toString();var e=e["display-name"]||e.login,u=document.getElementById("user-chat-window-"+d);if(!u){let a=document.createElement("div");a.id="user-chat-window-"+d,a.className="popout";u=document.createElement("div"),e=(u.style.cssText=` padding: 5px; cursor: move; background-color: var(--panel-border); color: var(--text-color); border-bottom: 1px solid var(--panel-border); display: flex; justify-content: space-between; align-items: center; z-index: 11; `,u.textContent="Chat History for "+e,document.createElement("button"));e.textContent="X",e.style.cssText=` background: none; border: none; color: var(--text-color); cursor: pointer; padding: 0 5px; `,e.onmousedown=e=>e.stopPropagation(),e.ontouchstart=e=>e.stopPropagation(),e.onclick=()=>a.remove(),e.ontouchend=()=>a.remove(),u.appendChild(e),a.appendChild(u);let n=document.createElement("div"),o=(n.style.cssText=` flex-grow: 1; overflow-y: auto; padding: 5px; background-color: var(--panel-bg); `,a.appendChild(n),document.createElement("button"));o.textContent="Load All Messages",o.style.cssText=` width: 100%; padding: 8px; background-color: var(--panel-border); color: var(--text-color); border: none; cursor: pointer; `,a.appendChild(o),document.body.appendChild(a);e=(()=>{var e=a.getBoundingClientRect(),t=window.innerWidth,n=window.innerHeight;let o,i;return i=c?(o=c.clientX+20,i=c.clientY+20,o+e.width>t&&(o=c.clientX-e.width-20),i+e.height>n&&(i=c.clientY-e.height-20),o=Math.max(0,Math.min(o,t-e.width)),Math.max(0,Math.min(i,n-e.height))):(t=t-e.width-50,n=n-e.height-50,o=Math.random()*Math.max(0,t)+50,Math.random()*Math.max(0,n)+50),{x:o,y:i}})();a.style.left=e.x+"px",a.style.top=e.y+"px";let r=u.offsetHeight,t=!1,i,l,s=(u.onmousedown=e=>{t=!0,i=e.clientX-a.offsetLeft,l=e.clientY-a.offsetTop,e.preventDefault(),document.onmousemove=e=>{t&&(e=f(e.clientX-i,e.clientY-l),a.style.left=e.x+"px",a.style.top=e.y+"px")},document.onmouseup=()=>{t=!1,document.onmousemove=null,document.onmouseup=null}},u.addEventListener("touchstart",e=>{e.preventDefault(),t=!0;e=e.touches[0];i=e.clientX-a.offsetLeft,l=e.clientY-a.offsetTop},{passive:!1}),document.addEventListener("touchmove",e=>{t&&(e.preventDefault(),e=f((e=e.touches[0]).clientX-i,e.clientY-l),a.style.left=e.x+"px",a.style.top=e.y+"px")},{passive:!1}),document.addEventListener("touchend",()=>{t=!1},{passive:!1}),window.addEventListener("resize",()=>{var e=a.getBoundingClientRect(),e=f(e.left,e.top);a.style.left=e.x+"px",a.style.top=e.y+"px"}),0);o.onclick=function(){for(var e=document.createDocumentFragment();s<w;){var t=v();t&&e.appendChild(t),s++}o.remove(),n.appendChild(e)};for(var h=O(),p=document.createDocumentFragment();s<w&&b[s].offset<=h;){var m=v();m&&p.appendChild(m),s++}function f(e,t){var n=a.getBoundingClientRect(),o=window.innerWidth,i=window.innerHeight,o=o-n.width,n=Math.max(0,Math.min(o,e)),o=i-r;return{x:n,y:Math.max(0,Math.min(o,t))}}function v(){var e=b[s],t=e.data.user||e.data["target-user"];if(t&&t.id==d)return Je(e)}n.appendChild(p),n.scrollTop=n.scrollHeight}}function rt(){var t=prompt("Enter username for chatlog history:");if(t){var n=t.toLowerCase();for(let e=0;e<w;e++){var o=b[e];if(o.data.user&&(o.data.user.login===n||o.data.user["display-name"]===t))return void at(o.data.user)}}}function lt(){var e=document.getElementById("message-borders-style")||document.createElement("style");e.id="message-borders-style",C?e.textContent="":e.textContent=".chat-message { border-bottom: none !important; }",e.parentNode||document.head.appendChild(e)}function st(){var e=document.getElementById("pinned-bits-style")||document.createElement("style");if(e.id="pinned-bits-style",P){if(e.textContent="",!l)return;R.Le(),R.Pe()}else e.textContent=".pinned-cheer { display: none !important; }";e.parentNode||document.head.appendChild(e)}function ct(){let t=document.createElement("div"),a=(t.className="modal",document.createElement("div")),r=(a.className="settings-panel",a.innerHTML=` <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;"><h2 style="margin: 0; color: var(--text-color);">Settings</h2><button id="settings-close" style="background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-color);">&times;</button></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Emoji Resolution (1-3): <span id="emote-res-value">${S}</span></label><input type="range" id="emote-res" min="1" max="3" value="${S}" style="width: 100%;"><button id="preload-emotes" style="margin-top: 5px; padding: 5px 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Preload Emotes</button></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Bits Resolution (1-4): <span id="bits-res-value">${I}</span></label><input type="range" id="bits-res" min="1" max="4" value="${I}" style="width: 100%;"><button id="preload-bits" style="margin-top: 5px; padding: 5px 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Preload Bits</button></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Badges Resolution: <span id="badges-res-value">${M}</span></label><select id="badges-res" style="width: 100%; padding: 5px; background-color: var(--bg-color); border: 1px solid var(--panel-border); color: var(--text-color); border-radius: 4px;"><option value="1" ${1===M?"selected":""}>1x</option><option value="2" ${2===M?"selected":""}>2x</option><option value="4" ${4===M?"selected":""}>4x</option></select><button id="preload-badges" style="margin-top: 5px; padding: 5px 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Preload Badges</button></div><div style="margin-bottom: 15px;"><button id="preload-all" style="width: 100%; padding: 10px; background-color: var(--accent-color); border: none; border-radius: 4px; color: white; cursor: pointer; font-weight: bold;">Preload All Assets</button></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Chat History Buffer (50-1000): <span id="history-value">${x}</span></label><input type="range" id="chat-history" min="50" max="1000" step="10" value="${x}" style="width: 100%;"></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Chat Update Speed (10-1000ms): <span id="update-speed-value">${f}</span>ms</label><input type="range" id="chat-update-speed" min="10" max="1000" step="10" value="${f}" style="width: 100%;"></div><div style="margin-bottom: 15px;"><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-timestamps" ${$?"checked":""} style="margin-right: 8px;"> Show message timestamps </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-badges" ${oe?"checked":""} style="margin-right: 8px;"> Show user badges </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-sub-messages" ${L?"checked":""} style="margin-right: 8px;"> Show gifted subscriptions, subscription messages </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-ban-messages" ${z?"checked":""} style="margin-right: 8px;"> Show moderation messages </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-message-borders" ${C?"checked":""} style="margin-right: 8px;"> Show message borders </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-pinned-bits" ${P?"checked":""} style="margin-right: 8px;"> Show pinned bits </label><label style="display: flex; align-items: center; margin-bottom: 10px;"><input type="checkbox" id="show-polls" ${A?"checked":""} style="margin-right: 8px;"> Show polls </label></div><div style="display: flex; gap: 10px; margin-top: 20px;"><button id="settings-save" style="flex: 1; padding: 10px; background-color: var(--accent-color); border: none; border-radius: 4px; color: white; cursor: pointer; font-weight: bold;">Save & Close</button><button id="settings-cancel" style="flex: 1; padding: 10px; background-color: var(--panel-border); border: none; border-radius: 4px; color: var(--text-color); cursor: pointer;">Cancel</button></div> `,t.appendChild(a),document.body.appendChild(t),a.querySelector("#emote-res")),e=a.querySelector("#emote-res-value"),l=(r.addEventListener("input",()=>{e.textContent=r.value}),a.querySelector("#bits-res")),n=a.querySelector("#bits-res-value"),s=(l.addEventListener("input",()=>{n.textContent=l.value}),a.querySelector("#badges-res")),o=a.querySelector("#badges-res-value"),c=(s.addEventListener("change",()=>{o.textContent=s.value}),a.querySelector("#chat-history")),i=a.querySelector("#history-value"),d=(c.addEventListener("input",()=>{i.textContent=c.value}),a.querySelector("#chat-update-speed")),u=a.querySelector("#update-speed-value"),h=(d.addEventListener("input",()=>{u.textContent=d.value}),De(a,"#preload-emotes",Re),De(a,"#preload-bits",Ee),De(a,"#preload-badges",Be),De(a,"#preload-all",He),()=>t.remove());a.querySelector("#settings-close").addEventListener("click",h),a.querySelector("#settings-cancel").addEventListener("click",h),t.addEventListener("click",e=>{e.target===t&&h()}),a.querySelector("#settings-save").addEventListener("click",()=>{S=parseInt(r.value),I=parseInt(l.value);var e=parseInt(s.value),t=(x=parseInt(c.value),parseInt(d.value)),n=($=a.querySelector("#show-timestamps").checked,oe=a.querySelector("#show-badges").checked,L=a.querySelector("#show-sub-messages").checked,z=a.querySelector("#show-ban-messages").checked,a.querySelector("#show-message-borders").checked),o=a.querySelector("#show-pinned-bits").checked,i=a.querySelector("#show-polls").checked;M!==e&&(M=e,k=`image${M}x`),t!==f&&(f=t,clearInterval(X),X=setInterval(()=>{v.paused||qe()},f)),n!==C&&(C=n,lt()),o!==P&&(P=o,st()),i!==A&&((A=i)?R.ie():R.poll&&R.le(R.poll.id)),e={emoteRes:S,bitsRes:I,badgesRes:M,chatHistoryLength:x,chatUpdateInterval:f,showMessageTimestamp:$,showUserBadges:oe,showSubMessages:L,showBanMessages:z,showMessageBorders:C,showPinnedBits:P},localStorage.setItem("settings",JSON.stringify(e)),h(),Ge()})}function dt(){n&&n.disconnect(),(n=new MutationObserver(()=>{p.scrollTop=p.scrollHeight,n.disconnect(),n=null})).observe(p,{childList:!0,subtree:!0}),p.scrollTop=p.scrollHeight,setTimeout(()=>{n&&(n.disconnect(),n=null),p.scrollTop=p.scrollHeight},f)}function ut(){var e=p.scrollHeight-p.clientHeight<=p.scrollTop+100;me.style.display=e?"none":"block"}function ht(){var e=Math.floor(v.currentTime),t=new URL(window.location);t.searchParams.set("t",(e=>{var t=3600<e?Math.floor(e/3600):0,n=60<e?Math.floor(e%3600/60):0;let o="";return 0<t&&(o+=t+"h"),(0<n||0<t)&&(o+=n+"m"),o+=e%60+"s"})(e)),window.history.replaceState({},"",t.toString())}function pt(){var e=new URL(window.location).searchParams.get("t");e&&(v.currentTime=/^\d+$/.test(e=e)?parseInt(e):3600*((e=e.match(/(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s)?/))[1]?parseInt(e[1]):0)+60*(e[2]?parseInt(e[2]):0)+(e[3]?parseInt(e[3]):0))}window.addEventListener("keydown",e=>{var t;!v||e.defaultPrevented||(t=e.target)&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable)||e.altKey||e.ctrlKey||e.metaKey||"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||(e.preventDefault(),t="ArrowLeft"===e.key?-1:1,e=Number.isFinite(v.duration)?v.duration:1/0,e=Math.min(e,Math.max(0,(v.currentTime||0)+5*t)),v.currentTime=e)},{capture:!0}),document.addEventListener("DOMContentLoaded",async()=>{document.getElementById("settings-btn").addEventListener("click",ct),document.getElementById("theme-toggle-btn").addEventListener("click",it),document.getElementById("report-btn").addEventListener("click",()=>{window.open("https://github.com/sputchik/sputchik.github.io/issues/new","_blank")}),Xe();var e=localStorage.getItem("settings");if(e)try{"emoteRes"in(e=JSON.parse(e))&&(S=e.emoteRes),"bitsRes"in e&&(I=e.bitsRes),"badgesRes"in e&&(M=e.badgesRes),"chatHistoryLength"in e&&(x=e.chatHistoryLength),"chatUpdateInterval"in e&&(f=e.chatUpdateInterval),"showMessageTimestamp"in e&&($=e.showMessageTimestamp),"showUserBadges"in e&&(oe=e.showUserBadges),"showSubMessages"in e&&(L=e.showSubMessages),"showBanMessages"in e&&(z=e.showBanMessages),"showMessageBorders"in e&&(C=e.showMessageBorders),"showPinnedBits"in e&&(P=e.showPinnedBits),"showPolls"in e&&(A=e.showPolls),k=`image${M}x`,lt(),st()}catch(e){console.error("Failed to load settings:",e)}await Promise.all([Ce(),(async()=>{var e=await F.add(ke.$.g());if(e.errors)throw new B(e.errors);var t=e.badges;let n=t.length;for(;n--;){var o=t[n];ie.set(""+o.setID+o.version,o)}})(),(async()=>{var e=await F.add(ke.k.g({channelLogin:i}));if(e.errors)throw new B(e.errors);var t=e.user.broadcastBadges;let n=t.length;for(;n--;){var o=t[n];ae.set(""+o.setID+o.version,o)}})(),(async()=>{var e=await F.add(ke.M.g());if(e.errors)throw new B(e.errors);var t=e.cheerConfig.groups[0],n=e.cheerConfig.displayConfig.colors;Q=t.templateURL;for(let e=0;e<n.length;e++){var o=n[e];Z.set(o.bits,o.color)}for(let e=0;e<t.nodes.length;e++){var i=t.nodes[e];if("DISPLAY_ONLY"!==i.type){W.add(i.prefix);var a=new Array;for(let e=0;e<i.tiers.length;e++)a.push(i.tiers[e].bits);var r=i.prefix.toLowerCase();m.set(r,a)}}e=Array.from(W).join("|"),ee=new RegExp(`(?:^|\\s)(${e})(\\d+)(?=\\s|$)`,"gi")})(),(async()=>{if(!te){var e=await F.add(ke.L.g({channelLogin:i,includeIsDJ:!1}));if(!te){if(e.errors)throw new B(e.errors);e=e.user.primaryColorHex;e&&ze("#"+e)}}})()]),document.getElementById("chatlog-btn").addEventListener("click",rt),X=setInterval(()=>{v.paused||qe()},f),v.addEventListener("play",()=>{Ze(),We(),p.scrollHeight-p.clientHeight>=p.scrollTop+100&&dt(),R.De()}),v.addEventListener("pause",()=>{ht(),Ze(),R.He()}),v.addEventListener("ratechange",()=>{g=v.playbackRate||1,v.paused||(Ze(),We()),R.Ve()}),v.addEventListener("seeking",()=>{Ze(),nt(),tt(),R.Pe()}),v.addEventListener("seeked",()=>{Ze(),ht(),s=(e=>{if(!w)return 0;let t=0,n=w-1,o=-1;for(;t<=n;){var i=t+n>>1;b[i].offset<=e?(o=i,t=1+i):n=i-1}return Math.max(0,o)})(O()),tt(),nt(),Ge(),R.Oe(),We()}),v.addEventListener("loadedmetadata",()=>{pt(),Ie(),R.Oe(),g=v.playbackRate||1})});</script>